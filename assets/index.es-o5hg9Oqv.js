import{aa as Mc,c8 as Po,c9 as ne,ca as H0,cb as cf,cc as uf,cd as zc,ce as So,cf as k0,ab as Mr,cg as xi,ch as K0,ci as B0,cj as Z,ck as F0,cl as wc,cm as V0,cn as G0,co as W0,cp as Yh,cq as J0,cr as Q0,cs as Y0,ct as Xh,cu as X0,cv as Z0,cw as Xn,cx as Zh,cy as e_,cz as t_,cA as hf,cB as jr,cC as r_,cD as i_,cE as gn,cF as Lt,cG as rr,cH as Ii,cI as lr,cJ as n_,cK as yn,cL as lf,cM as s_,cN as o_,cO as a_,cP as ff,cQ as c_,cR as pf,cS as df,cT as vn,cU as bc,cV as yo,cW as wn,cX as u_,cY as vo,cZ as h_,c_ as l_,c$ as f_,d0 as uo,d1 as p_,d2 as d_,d3 as ic,d4 as el,d5 as g_,d6 as y_,d7 as v_,d8 as tl,d9 as m_,da as __,db as w_,dc as b_,dd as E_,de as I_,df as x_,dg as Wn,dh as gf,di as nc,dj as P_,dk as S_,af as O_}from"./index-NjjTOskW.js";var Uc={exports:{}},mn=typeof Reflect=="object"?Reflect:null,rl=mn&&typeof mn.apply=="function"?mn.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},mo;mn&&typeof mn.ownKeys=="function"?mo=mn.ownKeys:Object.getOwnPropertySymbols?mo=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:mo=function(t){return Object.getOwnPropertyNames(t)};function R_(o){console&&console.warn&&console.warn(o)}var yf=Number.isNaN||function(t){return t!==t};function Ke(){Ke.init.call(this)}Uc.exports=Ke;Uc.exports.once=N_;Ke.EventEmitter=Ke;Ke.prototype._events=void 0;Ke.prototype._eventsCount=0;Ke.prototype._maxListeners=void 0;var il=10;function Oo(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(Ke,"defaultMaxListeners",{enumerable:!0,get:function(){return il},set:function(o){if(typeof o!="number"||o<0||yf(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");il=o}});Ke.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ke.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||yf(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function vf(o){return o._maxListeners===void 0?Ke.defaultMaxListeners:o._maxListeners}Ke.prototype.getMaxListeners=function(){return vf(this)};Ke.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var s=t==="error",c=this._events;if(c!==void 0)s=s&&c.error===void 0;else if(!s)return!1;if(s){var l;if(r.length>0&&(l=r[0]),l instanceof Error)throw l;var d=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw d.context=l,d}var _=c[t];if(_===void 0)return!1;if(typeof _=="function")rl(_,this,r);else for(var p=_.length,b=Ef(_,p),n=0;n<p;++n)rl(b[n],this,r);return!0};function mf(o,t,r,n){var s,c,l;if(Oo(r),c=o._events,c===void 0?(c=o._events=Object.create(null),o._eventsCount=0):(c.newListener!==void 0&&(o.emit("newListener",t,r.listener?r.listener:r),c=o._events),l=c[t]),l===void 0)l=c[t]=r,++o._eventsCount;else if(typeof l=="function"?l=c[t]=n?[r,l]:[l,r]:n?l.unshift(r):l.push(r),s=vf(o),s>0&&l.length>s&&!l.warned){l.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=o,d.type=t,d.count=l.length,R_(d)}return o}Ke.prototype.addListener=function(t,r){return mf(this,t,r,!1)};Ke.prototype.on=Ke.prototype.addListener;Ke.prototype.prependListener=function(t,r){return mf(this,t,r,!0)};function T_(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _f(o,t,r){var n={fired:!1,wrapFn:void 0,target:o,type:t,listener:r},s=T_.bind(n);return s.listener=r,n.wrapFn=s,s}Ke.prototype.once=function(t,r){return Oo(r),this.on(t,_f(this,t,r)),this};Ke.prototype.prependOnceListener=function(t,r){return Oo(r),this.prependListener(t,_f(this,t,r)),this};Ke.prototype.removeListener=function(t,r){var n,s,c,l,d;if(Oo(r),s=this._events,s===void 0)return this;if(n=s[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(c=-1,l=n.length-1;l>=0;l--)if(n[l]===r||n[l].listener===r){d=n[l].listener,c=l;break}if(c<0)return this;c===0?n.shift():A_(n,c),n.length===1&&(s[t]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",t,d||r)}return this};Ke.prototype.off=Ke.prototype.removeListener;Ke.prototype.removeAllListeners=function(t){var r,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var c=Object.keys(n),l;for(s=0;s<c.length;++s)l=c[s],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(t,r[s]);return this};function wf(o,t,r){var n=o._events;if(n===void 0)return[];var s=n[t];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?C_(s):Ef(s,s.length)}Ke.prototype.listeners=function(t){return wf(this,t,!0)};Ke.prototype.rawListeners=function(t){return wf(this,t,!1)};Ke.listenerCount=function(o,t){return typeof o.listenerCount=="function"?o.listenerCount(t):bf.call(o,t)};Ke.prototype.listenerCount=bf;function bf(o){var t=this._events;if(t!==void 0){var r=t[o];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Ke.prototype.eventNames=function(){return this._eventsCount>0?mo(this._events):[]};function Ef(o,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=o[n];return r}function A_(o,t){for(;t+1<o.length;t++)o[t]=o[t+1];o.pop()}function C_(o){for(var t=new Array(o.length),r=0;r<t.length;++r)t[r]=o[r].listener||o[r];return t}function N_(o,t){return new Promise(function(r,n){function s(l){o.removeListener(t,c),n(l)}function c(){typeof o.removeListener=="function"&&o.removeListener("error",s),r([].slice.call(arguments))}If(o,t,c,{once:!0}),t!=="error"&&$_(o,s,{once:!0})})}function $_(o,t,r){typeof o.on=="function"&&If(o,"error",t,r)}function If(o,t,r,n){if(typeof o.on=="function")n.once?o.once(t,r):o.on(t,r);else if(typeof o.addEventListener=="function")o.addEventListener(t,function s(c){n.once&&o.removeEventListener(t,s),r(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var mr=Uc.exports;const Hc=Mc(mr),L_=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,D_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,j_=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function q_(o,t){if(o==="__proto__"||o==="constructor"&&t&&typeof t=="object"&&"prototype"in t){M_(o);return}return t}function M_(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function ho(o,t={}){if(typeof o!="string")return o;const r=o.trim();if(o[0]==='"'&&o.at(-1)==='"'&&!o.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!j_.test(o)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(L_.test(o)||D_.test(o)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,q_)}return JSON.parse(o)}catch(n){if(t.strict)throw n;return o}}function z_(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function Ht(o,...t){try{return z_(o(...t))}catch(r){return Promise.reject(r)}}function U_(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function H_(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function _o(o){if(U_(o))return String(o);if(H_(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return _o(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function xf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Ec="base64:";function k_(o){if(typeof o=="string")return o;xf();const t=Buffer.from(o).toString("base64");return Ec+t}function K_(o){return typeof o!="string"||!o.startsWith(Ec)?o:(xf(),Buffer.from(o.slice(Ec.length),"base64"))}function hr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function B_(...o){return hr(o.join(":"))}function lo(o){return o=hr(o),o?o+":":""}const F_="memory",V_=()=>{const o=new Map;return{name:F_,options:{},hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,r){o.set(t,r)},setItemRaw(t,r){o.set(t,r)},removeItem(t){o.delete(t)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function G_(o={}){const t={mounts:{"":o.driver||V_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=p=>{for(const b of t.mountpoints)if(p.startsWith(b))return{base:b,relativeKey:p.slice(b.length),driver:t.mounts[b]};return{base:"",relativeKey:p,driver:t.mounts[""]}},n=(p,b)=>t.mountpoints.filter(T=>T.startsWith(p)||b&&p.startsWith(T)).map(T=>({relativeBase:p.length>T.length?p.slice(T.length):void 0,mountpoint:T,driver:t.mounts[T]})),s=(p,b)=>{if(t.watching){b=hr(b);for(const T of t.watchListeners)T(p,b)}},c=async()=>{if(!t.watching){t.watching=!0;for(const p in t.mounts)t.unwatch[p]=await nl(t.mounts[p],s,p)}},l=async()=>{if(t.watching){for(const p in t.unwatch)await t.unwatch[p]();t.unwatch={},t.watching=!1}},d=(p,b,T)=>{const x=new Map,L=C=>{let F=x.get(C.base);return F||(F={driver:C.driver,base:C.base,items:[]},x.set(C.base,F)),F};for(const C of p){const F=typeof C=="string",re=hr(F?C:C.key),he=F?void 0:C.value,le=F||!C.options?b:{...b,...C.options},fe=r(re);L(fe).items.push({key:re,value:he,relativeKey:fe.relativeKey,options:le})}return Promise.all([...x.values()].map(C=>T(C))).then(C=>C.flat())},_={hasItem(p,b={}){p=hr(p);const{relativeKey:T,driver:x}=r(p);return Ht(x.hasItem,T,b)},getItem(p,b={}){p=hr(p);const{relativeKey:T,driver:x}=r(p);return Ht(x.getItem,T,b).then(L=>ho(L))},getItems(p,b){return d(p,b,T=>T.driver.getItems?Ht(T.driver.getItems,T.items.map(x=>({key:x.relativeKey,options:x.options})),b).then(x=>x.map(L=>({key:B_(T.base,L.key),value:ho(L.value)}))):Promise.all(T.items.map(x=>Ht(T.driver.getItem,x.relativeKey,x.options).then(L=>({key:x.key,value:ho(L)})))))},getItemRaw(p,b={}){p=hr(p);const{relativeKey:T,driver:x}=r(p);return x.getItemRaw?Ht(x.getItemRaw,T,b):Ht(x.getItem,T,b).then(L=>K_(L))},async setItem(p,b,T={}){if(b===void 0)return _.removeItem(p);p=hr(p);const{relativeKey:x,driver:L}=r(p);L.setItem&&(await Ht(L.setItem,x,_o(b),T),L.watch||s("update",p))},async setItems(p,b){await d(p,b,async T=>{T.driver.setItems&&await Ht(T.driver.setItems,T.items.map(x=>({key:x.relativeKey,value:_o(x.value),options:x.options})),b),T.driver.setItem&&await Promise.all(T.items.map(x=>Ht(T.driver.setItem,x.relativeKey,_o(x.value),x.options)))})},async setItemRaw(p,b,T={}){if(b===void 0)return _.removeItem(p,T);p=hr(p);const{relativeKey:x,driver:L}=r(p);if(L.setItemRaw)await Ht(L.setItemRaw,x,b,T);else if(L.setItem)await Ht(L.setItem,x,k_(b),T);else return;L.watch||s("update",p)},async removeItem(p,b={}){typeof b=="boolean"&&(b={removeMeta:b}),p=hr(p);const{relativeKey:T,driver:x}=r(p);x.removeItem&&(await Ht(x.removeItem,T,b),(b.removeMeta||b.removeMata)&&await Ht(x.removeItem,T+"$",b),x.watch||s("remove",p))},async getMeta(p,b={}){typeof b=="boolean"&&(b={nativeOnly:b}),p=hr(p);const{relativeKey:T,driver:x}=r(p),L=Object.create(null);if(x.getMeta&&Object.assign(L,await Ht(x.getMeta,T,b)),!b.nativeOnly){const C=await Ht(x.getItem,T+"$",b).then(F=>ho(F));C&&typeof C=="object"&&(typeof C.atime=="string"&&(C.atime=new Date(C.atime)),typeof C.mtime=="string"&&(C.mtime=new Date(C.mtime)),Object.assign(L,C))}return L},setMeta(p,b,T={}){return this.setItem(p+"$",b,T)},removeMeta(p,b={}){return this.removeItem(p+"$",b)},async getKeys(p,b={}){p=lo(p);const T=n(p,!0);let x=[];const L=[];for(const C of T){const re=(await Ht(C.driver.getKeys,C.relativeBase,b)).map(he=>C.mountpoint+hr(he)).filter(he=>!x.some(le=>he.startsWith(le)));L.push(...re),x=[C.mountpoint,...x.filter(he=>!he.startsWith(C.mountpoint))]}return p?L.filter(C=>C.startsWith(p)&&!C.endsWith("$")):L.filter(C=>!C.endsWith("$"))},async clear(p,b={}){p=lo(p),await Promise.all(n(p,!1).map(async T=>{if(T.driver.clear)return Ht(T.driver.clear,T.relativeBase,b);if(T.driver.removeItem){const x=await T.driver.getKeys(T.relativeBase||"",b);return Promise.all(x.map(L=>T.driver.removeItem(L,b)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(p=>sl(p)))},async watch(p){return await c(),t.watchListeners.push(p),async()=>{t.watchListeners=t.watchListeners.filter(b=>b!==p),t.watchListeners.length===0&&await l()}},async unwatch(){t.watchListeners=[],await l()},mount(p,b){if(p=lo(p),p&&t.mounts[p])throw new Error(`already mounted at ${p}`);return p&&(t.mountpoints.push(p),t.mountpoints.sort((T,x)=>x.length-T.length)),t.mounts[p]=b,t.watching&&Promise.resolve(nl(b,s,p)).then(T=>{t.unwatch[p]=T}).catch(console.error),_},async unmount(p,b=!0){p=lo(p),!(!p||!t.mounts[p])&&(t.watching&&p in t.unwatch&&(t.unwatch[p](),delete t.unwatch[p]),b&&await sl(t.mounts[p]),t.mountpoints=t.mountpoints.filter(T=>T!==p),delete t.mounts[p])},getMount(p=""){p=hr(p)+":";const b=r(p);return{driver:b.driver,base:b.base}},getMounts(p="",b={}){return p=hr(p),n(p,b.parents).map(x=>({driver:x.driver,base:x.mountpoint}))}};return _}function nl(o,t,r){return o.watch?o.watch((n,s)=>t(n,r+s)):()=>{}}async function sl(o){typeof o.dispose=="function"&&await Ht(o.dispose)}function Fi(o){return new Promise((t,r)=>{o.oncomplete=o.onsuccess=()=>t(o.result),o.onabort=o.onerror=()=>r(o.error)})}function Pf(o,t){const r=indexedDB.open(o);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Fi(r);return(s,c)=>n.then(l=>c(l.transaction(t,s).objectStore(t)))}let sc;function rs(){return sc||(sc=Pf("keyval-store","keyval")),sc}function ol(o,t=rs()){return t("readonly",r=>Fi(r.get(o)))}function W_(o,t,r=rs()){return r("readwrite",n=>(n.put(t,o),Fi(n.transaction)))}function J_(o,t=rs()){return t("readwrite",r=>(r.delete(o),Fi(r.transaction)))}function Q_(o=rs()){return o("readwrite",t=>(t.clear(),Fi(t.transaction)))}function Y_(o,t){return o.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Fi(o.transaction)}function X_(o=rs()){return o("readonly",t=>{if(t.getAllKeys)return Fi(t.getAllKeys());const r=[];return Y_(t,n=>r.push(n.key)).then(()=>r)})}const Z_=o=>JSON.stringify(o,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),ew=o=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(t,'$1"$2n"$3');return JSON.parse(r,(n,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function is(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return ew(o)}catch{return o}}function Bi(o){return typeof o=="string"?o:Z_(o)||""}const tw="idb-keyval";var rw=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=s=>t+s;let n;return o.dbName&&o.storeName&&(n=Pf(o.dbName,o.storeName)),{name:tw,options:o,async hasItem(s){return!(typeof await ol(r(s),n)>"u")},async getItem(s){return await ol(r(s),n)??null},setItem(s,c){return W_(r(s),c,n)},removeItem(s){return J_(r(s),n)},getKeys(){return X_(n)},clear(){return Q_(n)}}};const iw="WALLET_CONNECT_V2_INDEXED_DB",nw="keyvaluestorage";let sw=class{constructor(){this.indexedDb=G_({driver:rw({dbName:iw,storeName:nw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Bi(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wo={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,n){this[r]=String(n)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof oc<"u"&&oc.localStorage?wo.exports=oc.localStorage:typeof window<"u"&&window.localStorage?wo.exports=window.localStorage:wo.exports=new t})();function ow(o){var t;return[o[0],is((t=o[1])!=null?t:"")]}let aw=class{constructor(){this.localStorage=wo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(ow)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return is(r)}async setItem(t,r){this.localStorage.setItem(t,Bi(r))}async removeItem(t){this.localStorage.removeItem(t)}};const cw="wc_storage_version",al=1,uw=async(o,t,r)=>{const n=cw,s=await t.getItem(n);if(s&&s>=al){r(t);return}const c=await o.getKeys();if(!c.length){r(t);return}const l=[];for(;c.length;){const d=c.shift();if(!d)continue;const _=d.toLowerCase();if(_.includes("wc@")||_.includes("walletconnect")||_.includes("wc_")||_.includes("wallet_connect")){const p=await o.getItem(d);await t.setItem(d,p),l.push(d)}}await t.setItem(n,al),r(t),hw(o,l)},hw=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let lw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new aw;this.storage=t;try{const r=new sw;uw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var bn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ic=function(o,t){return Ic=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Ic(o,t)};function fw(o,t){Ic(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var xc=function(){return xc=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},xc.apply(this,arguments)};function pw(o,t){var r={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&t.indexOf(n)<0&&(r[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(r[n[s]]=o[n[s]]);return r}function dw(o,t,r,n){var s=arguments.length,c=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,t,r,n);else for(var d=o.length-1;d>=0;d--)(l=o[d])&&(c=(s<3?l(c):s>3?l(t,r,c):l(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c}function gw(o,t){return function(r,n){t(r,n,o)}}function yw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function vw(o,t,r,n){function s(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function d(b){try{p(n.next(b))}catch(T){l(T)}}function _(b){try{p(n.throw(b))}catch(T){l(T)}}function p(b){b.done?c(b.value):s(b.value).then(d,_)}p((n=n.apply(o,t||[])).next())})}function mw(o,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(p){return function(b){return _([p,b])}}function _(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,s=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(o,r)}catch(b){p=[6,b],s=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function _w(o,t,r,n){n===void 0&&(n=r),o[n]=t[r]}function ww(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Pc(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],n=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sf(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var n=r.call(o),s,c=[],l;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(d){l={error:d}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(l)throw l.error}}return c}function bw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(Sf(arguments[t]));return o}function Ew(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var n=Array(o),s=0,t=0;t<r;t++)for(var c=arguments[t],l=0,d=c.length;l<d;l++,s++)n[s]=c[l];return n}function Zn(o){return this instanceof Zn?(this.v=o,this):new Zn(o)}function Iw(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(o,t||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(x){n[x]&&(s[x]=function(L){return new Promise(function(C,F){c.push([x,L,C,F])>1||d(x,L)})})}function d(x,L){try{_(n[x](L))}catch(C){T(c[0][3],C)}}function _(x){x.value instanceof Zn?Promise.resolve(x.value.v).then(p,b):T(c[0][2],x)}function p(x){d("next",x)}function b(x){d("throw",x)}function T(x,L){x(L),c.shift(),c.length&&d(c[0][0],c[0][1])}}function xw(o){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,c){t[s]=o[s]?function(l){return(r=!r)?{value:Zn(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function Pw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Pc=="function"?Pc(o):o[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=o[c]&&function(l){return new Promise(function(d,_){l=o[c](l),s(d,_,l.done,l.value)})}}function s(c,l,d,_){Promise.resolve(_).then(function(p){c({value:p,done:d})},l)}}function Sw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Ow(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function Rw(o){return o&&o.__esModule?o:{default:o}}function Tw(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function Aw(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const Cw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return xc},__asyncDelegator:xw,__asyncGenerator:Iw,__asyncValues:Pw,__await:Zn,__awaiter:vw,__classPrivateFieldGet:Tw,__classPrivateFieldSet:Aw,__createBinding:_w,__decorate:dw,__exportStar:ww,__extends:fw,__generator:mw,__importDefault:Rw,__importStar:Ow,__makeTemplateObject:Sw,__metadata:yw,__param:gw,__read:Sf,__rest:pw,__spread:bw,__spreadArrays:Ew,__values:Pc},Symbol.toStringTag,{value:"Module"})),Ro=Po(Cw);var Hn={},ac={},kn={};let Vi=class{};const Nw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Vi},Symbol.toStringTag,{value:"Module"})),$w=Po(Nw);var cl;function Lw(){if(cl)return kn;cl=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.IHeartBeat=void 0;const o=$w;class t extends o.IEvents{constructor(n){super()}}return kn.IHeartBeat=t,kn}var ul;function Of(){return ul||(ul=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Ro.__exportStar(Lw(),o)}(ac)),ac}var cc={},ki={},hl;function Dw(){if(hl)return ki;hl=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.HEARTBEAT_EVENTS=ki.HEARTBEAT_INTERVAL=void 0;const o=ne;return ki.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,ki.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ki}var ll;function Rf(){return ll||(ll=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Ro.__exportStar(Dw(),o)}(cc)),cc}var fl;function jw(){if(fl)return Hn;fl=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.HeartBeat=void 0;const o=Ro,t=mr,r=ne,n=Of(),s=Rf();class c extends n.IHeartBeat{constructor(d){super(d),this.events=new t.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(d==null?void 0:d.interval)||s.HEARTBEAT_INTERVAL}static init(d){return o.__awaiter(this,void 0,void 0,function*(){const _=new c(d);return yield _.init(),_})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(d,_){this.events.on(d,_)}once(d,_){this.events.once(d,_)}off(d,_){this.events.off(d,_)}removeListener(d,_){this.events.removeListener(d,_)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return Hn.HeartBeat=c,Hn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Ro;t.__exportStar(jw(),o),t.__exportStar(Of(),o),t.__exportStar(Rf(),o)})(bn);var Ae={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Sc=function(o,t){return Sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Sc(o,t)};function qw(o,t){Sc(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Oc=function(){return Oc=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Oc.apply(this,arguments)};function Mw(o,t){var r={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&t.indexOf(n)<0&&(r[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(r[n[s]]=o[n[s]]);return r}function zw(o,t,r,n){var s=arguments.length,c=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,t,r,n);else for(var d=o.length-1;d>=0;d--)(l=o[d])&&(c=(s<3?l(c):s>3?l(t,r,c):l(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c}function Uw(o,t){return function(r,n){t(r,n,o)}}function Hw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function kw(o,t,r,n){function s(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function d(b){try{p(n.next(b))}catch(T){l(T)}}function _(b){try{p(n.throw(b))}catch(T){l(T)}}function p(b){b.done?c(b.value):s(b.value).then(d,_)}p((n=n.apply(o,t||[])).next())})}function Kw(o,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(p){return function(b){return _([p,b])}}function _(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,s=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(o,r)}catch(b){p=[6,b],s=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function Bw(o,t,r,n){n===void 0&&(n=r),o[n]=t[r]}function Fw(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Rc(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],n=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tf(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var n=r.call(o),s,c=[],l;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(d){l={error:d}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(l)throw l.error}}return c}function Vw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(Tf(arguments[t]));return o}function Gw(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var n=Array(o),s=0,t=0;t<r;t++)for(var c=arguments[t],l=0,d=c.length;l<d;l++,s++)n[s]=c[l];return n}function es(o){return this instanceof es?(this.v=o,this):new es(o)}function Ww(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(o,t||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(x){n[x]&&(s[x]=function(L){return new Promise(function(C,F){c.push([x,L,C,F])>1||d(x,L)})})}function d(x,L){try{_(n[x](L))}catch(C){T(c[0][3],C)}}function _(x){x.value instanceof es?Promise.resolve(x.value.v).then(p,b):T(c[0][2],x)}function p(x){d("next",x)}function b(x){d("throw",x)}function T(x,L){x(L),c.shift(),c.length&&d(c[0][0],c[0][1])}}function Jw(o){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,c){t[s]=o[s]?function(l){return(r=!r)?{value:es(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function Qw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Rc=="function"?Rc(o):o[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=o[c]&&function(l){return new Promise(function(d,_){l=o[c](l),s(d,_,l.done,l.value)})}}function s(c,l,d,_){Promise.resolve(_).then(function(p){c({value:p,done:d})},l)}}function Yw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Xw(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function Zw(o){return o&&o.__esModule?o:{default:o}}function eb(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function tb(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const rb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Oc},__asyncDelegator:Jw,__asyncGenerator:Ww,__asyncValues:Qw,__await:es,__awaiter:kw,__classPrivateFieldGet:eb,__classPrivateFieldSet:tb,__createBinding:Bw,__decorate:zw,__exportStar:Fw,__extends:qw,__generator:Kw,__importDefault:Zw,__importStar:Xw,__makeTemplateObject:Yw,__metadata:Hw,__param:Uw,__read:Tf,__rest:Mw,__spread:Vw,__spreadArrays:Gw,__values:Rc},Symbol.toStringTag,{value:"Module"})),ib=Po(rb);var uc,pl;function nb(){if(pl)return uc;pl=1;function o(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}uc=t;function t(r,n,s){var c=s&&s.stringify||o,l=1;if(typeof r=="object"&&r!==null){var d=n.length+l;if(d===1)return r;var _=new Array(d);_[0]=c(r);for(var p=1;p<d;p++)_[p]=c(n[p]);return _.join(" ")}if(typeof r!="string")return r;var b=n.length;if(b===0)return r;for(var T="",x=1-l,L=-1,C=r&&r.length||0,F=0;F<C;){if(r.charCodeAt(F)===37&&F+1<C){switch(L=L>-1?L:0,r.charCodeAt(F+1)){case 100:case 102:if(x>=b||n[x]==null)break;L<F&&(T+=r.slice(L,F)),T+=Number(n[x]),L=F+2,F++;break;case 105:if(x>=b||n[x]==null)break;L<F&&(T+=r.slice(L,F)),T+=Math.floor(Number(n[x])),L=F+2,F++;break;case 79:case 111:case 106:if(x>=b||n[x]===void 0)break;L<F&&(T+=r.slice(L,F));var re=typeof n[x];if(re==="string"){T+="'"+n[x]+"'",L=F+2,F++;break}if(re==="function"){T+=n[x].name||"<anonymous>",L=F+2,F++;break}T+=c(n[x]),L=F+2,F++;break;case 115:if(x>=b)break;L<F&&(T+=r.slice(L,F)),T+=String(n[x]),L=F+2,F++;break;case 37:L<F&&(T+=r.slice(L,F)),T+="%",L=F+2,F++,x--;break}++x}++F}return L===-1?r:(L<C&&(T+=r.slice(L)),T)}return uc}var hc,dl;function sb(){if(dl)return hc;dl=1;const o=nb();hc=s;const t=de().console||{},r={mapHttpRequest:C,mapHttpResponse:C,wrapRequestSerializer:F,wrapResponseSerializer:F,wrapErrorSerializer:F,req:C,res:C,err:x};function n(j,H){return Array.isArray(j)?j.filter(function(ve){return ve!=="!stdSerializers.err"}):j===!0?Object.keys(H):!1}function s(j){j=j||{},j.browser=j.browser||{};const H=j.browser.transmit;if(H&&typeof H.send!="function")throw Error("pino: transmit option must have a send function");const W=j.browser.write||t;j.browser.write&&(j.browser.asObject=!0);const ve=j.serializers||{},ie=n(j.browser.serialize,ve);let ue=j.browser.serialize;Array.isArray(j.browser.serialize)&&j.browser.serialize.indexOf("!stdSerializers.err")>-1&&(ue=!1);const Ce=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),j.enabled===!1&&(j.level="silent");const Ue=j.level||"info",m=Object.create(W);m.log||(m.log=re),Object.defineProperty(m,"levelVal",{get:Y}),Object.defineProperty(m,"level",{get:ce,set:V});const P={transmit:H,serialize:ie,asObject:j.browser.asObject,levels:Ce,timestamp:L(j)};m.levels=s.levels,m.level=Ue,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=re,m.serializers=ve,m._serialize=ie,m._stdErrSerialize=ue,m.child=k,H&&(m._logEvent=T());function Y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function ce(){return this._level}function V(B){if(B!=="silent"&&!this.levels.values[B])throw Error("unknown level "+B);this._level=B,c(P,m,"error","log"),c(P,m,"fatal","error"),c(P,m,"warn","error"),c(P,m,"info","log"),c(P,m,"debug","log"),c(P,m,"trace","log")}function k(B,G){if(!B)throw new Error("missing bindings for child Pino");G=G||{},ie&&B.serializers&&(G.serializers=B.serializers);const Qe=G.serializers;if(ie&&Qe){var Be=Object.assign({},ve,Qe),zr=j.browser.serialize===!0?Object.keys(Be):ie;delete B.serializers,_([B],zr,Be,this._stdErrSerialize)}function Ie(xt){this._childLevel=(xt._childLevel|0)+1,this.error=p(xt,B,"error"),this.fatal=p(xt,B,"fatal"),this.warn=p(xt,B,"warn"),this.info=p(xt,B,"info"),this.debug=p(xt,B,"debug"),this.trace=p(xt,B,"trace"),Be&&(this.serializers=Be,this._serialize=zr),H&&(this._logEvent=T([].concat(xt._logEvent.bindings,B)))}return Ie.prototype=this,new Ie(this)}return m}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:he,epochTime:le,unixTime:fe,isoTime:pe});function c(j,H,W,ve){const ie=Object.getPrototypeOf(H);H[W]=H.levelVal>H.levels.values[W]?re:ie[W]?ie[W]:t[W]||t[ve]||re,l(j,H,W)}function l(j,H,W){!j.transmit&&H[W]===re||(H[W]=function(ve){return function(){const ue=j.timestamp(),Ce=new Array(arguments.length),Ue=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var m=0;m<Ce.length;m++)Ce[m]=arguments[m];if(j.serialize&&!j.asObject&&_(Ce,this._serialize,this.serializers,this._stdErrSerialize),j.asObject?ve.call(Ue,d(this,W,Ce,ue)):ve.apply(Ue,Ce),j.transmit){const P=j.transmit.level||H.level,Y=s.levels.values[P],ce=s.levels.values[W];if(ce<Y)return;b(this,{ts:ue,methodLevel:W,methodValue:ce,transmitLevel:P,transmitValue:s.levels.values[j.transmit.level||H.level],send:j.transmit.send,val:H.levelVal},Ce)}}}(H[W]))}function d(j,H,W,ve){j._serialize&&_(W,j._serialize,j.serializers,j._stdErrSerialize);const ie=W.slice();let ue=ie[0];const Ce={};ve&&(Ce.time=ve),Ce.level=s.levels.values[H];let Ue=(j._childLevel|0)+1;if(Ue<1&&(Ue=1),ue!==null&&typeof ue=="object"){for(;Ue--&&typeof ie[0]=="object";)Object.assign(Ce,ie.shift());ue=ie.length?o(ie.shift(),ie):void 0}else typeof ue=="string"&&(ue=o(ie.shift(),ie));return ue!==void 0&&(Ce.msg=ue),Ce}function _(j,H,W,ve){for(const ie in j)if(ve&&j[ie]instanceof Error)j[ie]=s.stdSerializers.err(j[ie]);else if(typeof j[ie]=="object"&&!Array.isArray(j[ie]))for(const ue in j[ie])H&&H.indexOf(ue)>-1&&ue in W&&(j[ie][ue]=W[ue](j[ie][ue]))}function p(j,H,W){return function(){const ve=new Array(1+arguments.length);ve[0]=H;for(var ie=1;ie<ve.length;ie++)ve[ie]=arguments[ie-1];return j[W].apply(this,ve)}}function b(j,H,W){const ve=H.send,ie=H.ts,ue=H.methodLevel,Ce=H.methodValue,Ue=H.val,m=j._logEvent.bindings;_(W,j._serialize||Object.keys(j.serializers),j.serializers,j._stdErrSerialize===void 0?!0:j._stdErrSerialize),j._logEvent.ts=ie,j._logEvent.messages=W.filter(function(P){return m.indexOf(P)===-1}),j._logEvent.level.label=ue,j._logEvent.level.value=Ce,ve(ue,j._logEvent,Ue),j._logEvent=T(m)}function T(j){return{ts:0,messages:[],bindings:j||[],level:{label:"",value:0}}}function x(j){const H={type:j.constructor.name,msg:j.message,stack:j.stack};for(const W in j)H[W]===void 0&&(H[W]=j[W]);return H}function L(j){return typeof j.timestamp=="function"?j.timestamp:j.timestamp===!1?he:le}function C(){return{}}function F(j){return j}function re(){}function he(){return!1}function le(){return Date.now()}function fe(){return Math.round(Date.now()/1e3)}function pe(){return new Date(Date.now()).toISOString()}function de(){function j(H){return typeof H<"u"&&H}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return j(self)||j(window)||j(this)||{}}}return hc}var Ki={},gl;function Af(){return gl||(gl=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.PINO_CUSTOM_CONTEXT_KEY=Ki.PINO_LOGGER_DEFAULTS=void 0,Ki.PINO_LOGGER_DEFAULTS={level:"info"},Ki.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ki}var tr={},yl;function ob(){if(yl)return tr;yl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.generateChildLogger=tr.formatChildLoggerContext=tr.getLoggerContext=tr.setBrowserLoggerContext=tr.getBrowserLoggerContext=tr.getDefaultLoggerOptions=void 0;const o=Af();function t(d){return Object.assign(Object.assign({},d),{level:(d==null?void 0:d.level)||o.PINO_LOGGER_DEFAULTS.level})}tr.getDefaultLoggerOptions=t;function r(d,_=o.PINO_CUSTOM_CONTEXT_KEY){return d[_]||""}tr.getBrowserLoggerContext=r;function n(d,_,p=o.PINO_CUSTOM_CONTEXT_KEY){return d[p]=_,d}tr.setBrowserLoggerContext=n;function s(d,_=o.PINO_CUSTOM_CONTEXT_KEY){let p="";return typeof d.bindings>"u"?p=r(d,_):p=d.bindings().context||"",p}tr.getLoggerContext=s;function c(d,_,p=o.PINO_CUSTOM_CONTEXT_KEY){const b=s(d,p);return b.trim()?`${b}/${_}`:_}tr.formatChildLoggerContext=c;function l(d,_,p=o.PINO_CUSTOM_CONTEXT_KEY){const b=c(d,_,p),T=d.child({context:b});return n(T,b,p)}return tr.generateChildLogger=l,tr}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const t=ib,r=t.__importDefault(sb());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(Af(),o),t.__exportStar(ob(),o)})(Ae);class ab extends Vi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}class cb extends Vi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}}class ub{constructor(t,r){this.logger=t,this.core=r}}let hb=class extends Vi{constructor(t,r){super(),this.relayer=t,this.logger=r}},lb=class extends Vi{constructor(t){super()}},fb=class{constructor(t,r,n,s){this.core=t,this.logger=r,this.name=n}};class pb extends Vi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let db=class extends Vi{constructor(t,r){super(),this.core=t,this.logger=r}},gb=class{constructor(t,r){this.projectId=t,this.logger=r}},yb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},vb=class{constructor(t){this.client=t}};var kc={},Cf={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var t=H0,r=cf;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var n=function(){function d(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return d.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},d.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},d.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},d.prototype.update=function(_,p){if(p===void 0&&(p=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&p>0;)this._buffer[this._bufferLength++]=_[b++],p--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(b=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,b,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=_[b++],p--;return this},d.prototype.finish=function(_){if(!this._finished){var p=this._bytesHashed,b=this._bufferLength,T=p/536870912|0,x=p<<3,L=p%128<112?128:256;this._buffer[b]=128;for(var C=b+1;C<L-8;C++)this._buffer[C]=0;t.writeUint32BE(T,this._buffer,L-8),t.writeUint32BE(x,this._buffer,L-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,L),this._finished=!0}for(var C=0;C<this.digestLength/8;C++)t.writeUint32BE(this._stateHi[C],_,C*8),t.writeUint32BE(this._stateLo[C],_,C*8+4);return this},d.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},d.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},d.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},d.prototype.cleanSavedState=function(_){r.wipe(_.stateHi),r.wipe(_.stateLo),_.buffer&&r.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},d}();o.SHA512=n;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(d,_,p,b,T,x,L){for(var C=p[0],F=p[1],re=p[2],he=p[3],le=p[4],fe=p[5],pe=p[6],de=p[7],j=b[0],H=b[1],W=b[2],ve=b[3],ie=b[4],ue=b[5],Ce=b[6],Ue=b[7],m,P,Y,ce,V,k,B,G;L>=128;){for(var Qe=0;Qe<16;Qe++){var Be=8*Qe+x;d[Qe]=t.readUint32BE(T,Be),_[Qe]=t.readUint32BE(T,Be+4)}for(var Qe=0;Qe<80;Qe++){var zr=C,Ie=F,xt=re,D=he,$=le,A=fe,h=pe,I=de,ee=j,ge=H,be=W,Ne=ve,Le=ie,Se=ue,Pt=Ce,_t=Ue;if(m=de,P=Ue,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=(le>>>14|ie<<18)^(le>>>18|ie<<14)^(ie>>>9|le<<23),P=(ie>>>14|le<<18)^(ie>>>18|le<<14)^(le>>>9|ie<<23),V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,m=le&fe^~le&pe,P=ie&ue^~ie&Ce,V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,m=s[Qe*2],P=s[Qe*2+1],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,m=d[Qe%16],P=_[Qe%16],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,Y=B&65535|G<<16,ce=V&65535|k<<16,m=Y,P=ce,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=(C>>>28|j<<4)^(j>>>2|C<<30)^(j>>>7|C<<25),P=(j>>>28|C<<4)^(C>>>2|j<<30)^(C>>>7|j<<25),V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,m=C&F^C&re^F&re,P=j&H^j&W^H&W,V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,I=B&65535|G<<16,_t=V&65535|k<<16,m=D,P=Ne,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=Y,P=ce,V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,D=B&65535|G<<16,Ne=V&65535|k<<16,F=zr,re=Ie,he=xt,le=D,fe=$,pe=A,de=h,C=I,H=ee,W=ge,ve=be,ie=Ne,ue=Le,Ce=Se,Ue=Pt,j=_t,Qe%16===15)for(var Be=0;Be<16;Be++)m=d[Be],P=_[Be],V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=d[(Be+9)%16],P=_[(Be+9)%16],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,Y=d[(Be+1)%16],ce=_[(Be+1)%16],m=(Y>>>1|ce<<31)^(Y>>>8|ce<<24)^Y>>>7,P=(ce>>>1|Y<<31)^(ce>>>8|Y<<24)^(ce>>>7|Y<<25),V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,Y=d[(Be+14)%16],ce=_[(Be+14)%16],m=(Y>>>19|ce<<13)^(ce>>>29|Y<<3)^Y>>>6,P=(ce>>>19|Y<<13)^(Y>>>29|ce<<3)^(ce>>>6|Y<<26),V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,d[Be]=B&65535|G<<16,_[Be]=V&65535|k<<16}m=C,P=j,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[0],P=b[0],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[0]=C=B&65535|G<<16,b[0]=j=V&65535|k<<16,m=F,P=H,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[1],P=b[1],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[1]=F=B&65535|G<<16,b[1]=H=V&65535|k<<16,m=re,P=W,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[2],P=b[2],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[2]=re=B&65535|G<<16,b[2]=W=V&65535|k<<16,m=he,P=ve,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[3],P=b[3],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[3]=he=B&65535|G<<16,b[3]=ve=V&65535|k<<16,m=le,P=ie,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[4],P=b[4],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[4]=le=B&65535|G<<16,b[4]=ie=V&65535|k<<16,m=fe,P=ue,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[5],P=b[5],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[5]=fe=B&65535|G<<16,b[5]=ue=V&65535|k<<16,m=pe,P=Ce,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[6],P=b[6],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[6]=pe=B&65535|G<<16,b[6]=Ce=V&65535|k<<16,m=de,P=Ue,V=P&65535,k=P>>>16,B=m&65535,G=m>>>16,m=p[7],P=b[7],V+=P&65535,k+=P>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[7]=de=B&65535|G<<16,b[7]=Ue=V&65535|k<<16,x+=128,L-=128}return x}function l(d){var _=new n;_.update(d);var p=_.digest();return _.clean(),p}o.hash=l})(Cf);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const t=uf,r=Cf,n=cf;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function s(D){const $=new Float64Array(16);if(D)for(let A=0;A<D.length;A++)$[A]=D[A];return $}const c=new Uint8Array(32);c[0]=9;const l=s(),d=s([1]),_=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),p=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),T=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),x=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function L(D,$){for(let A=0;A<16;A++)D[A]=$[A]|0}function C(D){let $=1;for(let A=0;A<16;A++){let h=D[A]+$+65535;$=Math.floor(h/65536),D[A]=h-$*65536}D[0]+=$-1+37*($-1)}function F(D,$,A){const h=~(A-1);for(let I=0;I<16;I++){const ee=h&(D[I]^$[I]);D[I]^=ee,$[I]^=ee}}function re(D,$){const A=s(),h=s();for(let I=0;I<16;I++)h[I]=$[I];C(h),C(h),C(h);for(let I=0;I<2;I++){A[0]=h[0]-65517;for(let ge=1;ge<15;ge++)A[ge]=h[ge]-65535-(A[ge-1]>>16&1),A[ge-1]&=65535;A[15]=h[15]-32767-(A[14]>>16&1);const ee=A[15]>>16&1;A[14]&=65535,F(h,A,1-ee)}for(let I=0;I<16;I++)D[2*I]=h[I]&255,D[2*I+1]=h[I]>>8}function he(D,$){let A=0;for(let h=0;h<32;h++)A|=D[h]^$[h];return(1&A-1>>>8)-1}function le(D,$){const A=new Uint8Array(32),h=new Uint8Array(32);return re(A,D),re(h,$),he(A,h)}function fe(D){const $=new Uint8Array(32);return re($,D),$[0]&1}function pe(D,$){for(let A=0;A<16;A++)D[A]=$[2*A]+($[2*A+1]<<8);D[15]&=32767}function de(D,$,A){for(let h=0;h<16;h++)D[h]=$[h]+A[h]}function j(D,$,A){for(let h=0;h<16;h++)D[h]=$[h]-A[h]}function H(D,$,A){let h,I,ee=0,ge=0,be=0,Ne=0,Le=0,Se=0,Pt=0,_t=0,at=0,je=0,Xe=0,Ze=0,ct=0,He=0,et=0,$e=0,Fe=0,lt=0,Me=0,St=0,Dt=0,kt=0,Kt=0,Mt=0,Jt=0,ir=0,Ur=0,Qt=0,Gr=0,fi=0,Ri=0,ft=A[0],it=A[1],pt=A[2],dt=A[3],ut=A[4],nt=A[5],Ot=A[6],Rt=A[7],gt=A[8],Tt=A[9],yt=A[10],wt=A[11],vt=A[12],Ye=A[13],At=A[14],Ct=A[15];h=$[0],ee+=h*ft,ge+=h*it,be+=h*pt,Ne+=h*dt,Le+=h*ut,Se+=h*nt,Pt+=h*Ot,_t+=h*Rt,at+=h*gt,je+=h*Tt,Xe+=h*yt,Ze+=h*wt,ct+=h*vt,He+=h*Ye,et+=h*At,$e+=h*Ct,h=$[1],ge+=h*ft,be+=h*it,Ne+=h*pt,Le+=h*dt,Se+=h*ut,Pt+=h*nt,_t+=h*Ot,at+=h*Rt,je+=h*gt,Xe+=h*Tt,Ze+=h*yt,ct+=h*wt,He+=h*vt,et+=h*Ye,$e+=h*At,Fe+=h*Ct,h=$[2],be+=h*ft,Ne+=h*it,Le+=h*pt,Se+=h*dt,Pt+=h*ut,_t+=h*nt,at+=h*Ot,je+=h*Rt,Xe+=h*gt,Ze+=h*Tt,ct+=h*yt,He+=h*wt,et+=h*vt,$e+=h*Ye,Fe+=h*At,lt+=h*Ct,h=$[3],Ne+=h*ft,Le+=h*it,Se+=h*pt,Pt+=h*dt,_t+=h*ut,at+=h*nt,je+=h*Ot,Xe+=h*Rt,Ze+=h*gt,ct+=h*Tt,He+=h*yt,et+=h*wt,$e+=h*vt,Fe+=h*Ye,lt+=h*At,Me+=h*Ct,h=$[4],Le+=h*ft,Se+=h*it,Pt+=h*pt,_t+=h*dt,at+=h*ut,je+=h*nt,Xe+=h*Ot,Ze+=h*Rt,ct+=h*gt,He+=h*Tt,et+=h*yt,$e+=h*wt,Fe+=h*vt,lt+=h*Ye,Me+=h*At,St+=h*Ct,h=$[5],Se+=h*ft,Pt+=h*it,_t+=h*pt,at+=h*dt,je+=h*ut,Xe+=h*nt,Ze+=h*Ot,ct+=h*Rt,He+=h*gt,et+=h*Tt,$e+=h*yt,Fe+=h*wt,lt+=h*vt,Me+=h*Ye,St+=h*At,Dt+=h*Ct,h=$[6],Pt+=h*ft,_t+=h*it,at+=h*pt,je+=h*dt,Xe+=h*ut,Ze+=h*nt,ct+=h*Ot,He+=h*Rt,et+=h*gt,$e+=h*Tt,Fe+=h*yt,lt+=h*wt,Me+=h*vt,St+=h*Ye,Dt+=h*At,kt+=h*Ct,h=$[7],_t+=h*ft,at+=h*it,je+=h*pt,Xe+=h*dt,Ze+=h*ut,ct+=h*nt,He+=h*Ot,et+=h*Rt,$e+=h*gt,Fe+=h*Tt,lt+=h*yt,Me+=h*wt,St+=h*vt,Dt+=h*Ye,kt+=h*At,Kt+=h*Ct,h=$[8],at+=h*ft,je+=h*it,Xe+=h*pt,Ze+=h*dt,ct+=h*ut,He+=h*nt,et+=h*Ot,$e+=h*Rt,Fe+=h*gt,lt+=h*Tt,Me+=h*yt,St+=h*wt,Dt+=h*vt,kt+=h*Ye,Kt+=h*At,Mt+=h*Ct,h=$[9],je+=h*ft,Xe+=h*it,Ze+=h*pt,ct+=h*dt,He+=h*ut,et+=h*nt,$e+=h*Ot,Fe+=h*Rt,lt+=h*gt,Me+=h*Tt,St+=h*yt,Dt+=h*wt,kt+=h*vt,Kt+=h*Ye,Mt+=h*At,Jt+=h*Ct,h=$[10],Xe+=h*ft,Ze+=h*it,ct+=h*pt,He+=h*dt,et+=h*ut,$e+=h*nt,Fe+=h*Ot,lt+=h*Rt,Me+=h*gt,St+=h*Tt,Dt+=h*yt,kt+=h*wt,Kt+=h*vt,Mt+=h*Ye,Jt+=h*At,ir+=h*Ct,h=$[11],Ze+=h*ft,ct+=h*it,He+=h*pt,et+=h*dt,$e+=h*ut,Fe+=h*nt,lt+=h*Ot,Me+=h*Rt,St+=h*gt,Dt+=h*Tt,kt+=h*yt,Kt+=h*wt,Mt+=h*vt,Jt+=h*Ye,ir+=h*At,Ur+=h*Ct,h=$[12],ct+=h*ft,He+=h*it,et+=h*pt,$e+=h*dt,Fe+=h*ut,lt+=h*nt,Me+=h*Ot,St+=h*Rt,Dt+=h*gt,kt+=h*Tt,Kt+=h*yt,Mt+=h*wt,Jt+=h*vt,ir+=h*Ye,Ur+=h*At,Qt+=h*Ct,h=$[13],He+=h*ft,et+=h*it,$e+=h*pt,Fe+=h*dt,lt+=h*ut,Me+=h*nt,St+=h*Ot,Dt+=h*Rt,kt+=h*gt,Kt+=h*Tt,Mt+=h*yt,Jt+=h*wt,ir+=h*vt,Ur+=h*Ye,Qt+=h*At,Gr+=h*Ct,h=$[14],et+=h*ft,$e+=h*it,Fe+=h*pt,lt+=h*dt,Me+=h*ut,St+=h*nt,Dt+=h*Ot,kt+=h*Rt,Kt+=h*gt,Mt+=h*Tt,Jt+=h*yt,ir+=h*wt,Ur+=h*vt,Qt+=h*Ye,Gr+=h*At,fi+=h*Ct,h=$[15],$e+=h*ft,Fe+=h*it,lt+=h*pt,Me+=h*dt,St+=h*ut,Dt+=h*nt,kt+=h*Ot,Kt+=h*Rt,Mt+=h*gt,Jt+=h*Tt,ir+=h*yt,Ur+=h*wt,Qt+=h*vt,Gr+=h*Ye,fi+=h*At,Ri+=h*Ct,ee+=38*Fe,ge+=38*lt,be+=38*Me,Ne+=38*St,Le+=38*Dt,Se+=38*kt,Pt+=38*Kt,_t+=38*Mt,at+=38*Jt,je+=38*ir,Xe+=38*Ur,Ze+=38*Qt,ct+=38*Gr,He+=38*fi,et+=38*Ri,I=1,h=ee+I+65535,I=Math.floor(h/65536),ee=h-I*65536,h=ge+I+65535,I=Math.floor(h/65536),ge=h-I*65536,h=be+I+65535,I=Math.floor(h/65536),be=h-I*65536,h=Ne+I+65535,I=Math.floor(h/65536),Ne=h-I*65536,h=Le+I+65535,I=Math.floor(h/65536),Le=h-I*65536,h=Se+I+65535,I=Math.floor(h/65536),Se=h-I*65536,h=Pt+I+65535,I=Math.floor(h/65536),Pt=h-I*65536,h=_t+I+65535,I=Math.floor(h/65536),_t=h-I*65536,h=at+I+65535,I=Math.floor(h/65536),at=h-I*65536,h=je+I+65535,I=Math.floor(h/65536),je=h-I*65536,h=Xe+I+65535,I=Math.floor(h/65536),Xe=h-I*65536,h=Ze+I+65535,I=Math.floor(h/65536),Ze=h-I*65536,h=ct+I+65535,I=Math.floor(h/65536),ct=h-I*65536,h=He+I+65535,I=Math.floor(h/65536),He=h-I*65536,h=et+I+65535,I=Math.floor(h/65536),et=h-I*65536,h=$e+I+65535,I=Math.floor(h/65536),$e=h-I*65536,ee+=I-1+37*(I-1),I=1,h=ee+I+65535,I=Math.floor(h/65536),ee=h-I*65536,h=ge+I+65535,I=Math.floor(h/65536),ge=h-I*65536,h=be+I+65535,I=Math.floor(h/65536),be=h-I*65536,h=Ne+I+65535,I=Math.floor(h/65536),Ne=h-I*65536,h=Le+I+65535,I=Math.floor(h/65536),Le=h-I*65536,h=Se+I+65535,I=Math.floor(h/65536),Se=h-I*65536,h=Pt+I+65535,I=Math.floor(h/65536),Pt=h-I*65536,h=_t+I+65535,I=Math.floor(h/65536),_t=h-I*65536,h=at+I+65535,I=Math.floor(h/65536),at=h-I*65536,h=je+I+65535,I=Math.floor(h/65536),je=h-I*65536,h=Xe+I+65535,I=Math.floor(h/65536),Xe=h-I*65536,h=Ze+I+65535,I=Math.floor(h/65536),Ze=h-I*65536,h=ct+I+65535,I=Math.floor(h/65536),ct=h-I*65536,h=He+I+65535,I=Math.floor(h/65536),He=h-I*65536,h=et+I+65535,I=Math.floor(h/65536),et=h-I*65536,h=$e+I+65535,I=Math.floor(h/65536),$e=h-I*65536,ee+=I-1+37*(I-1),D[0]=ee,D[1]=ge,D[2]=be,D[3]=Ne,D[4]=Le,D[5]=Se,D[6]=Pt,D[7]=_t,D[8]=at,D[9]=je,D[10]=Xe,D[11]=Ze,D[12]=ct,D[13]=He,D[14]=et,D[15]=$e}function W(D,$){H(D,$,$)}function ve(D,$){const A=s();let h;for(h=0;h<16;h++)A[h]=$[h];for(h=253;h>=0;h--)W(A,A),h!==2&&h!==4&&H(A,A,$);for(h=0;h<16;h++)D[h]=A[h]}function ie(D,$){const A=s();let h;for(h=0;h<16;h++)A[h]=$[h];for(h=250;h>=0;h--)W(A,A),h!==1&&H(A,A,$);for(h=0;h<16;h++)D[h]=A[h]}function ue(D,$){const A=s(),h=s(),I=s(),ee=s(),ge=s(),be=s(),Ne=s(),Le=s(),Se=s();j(A,D[1],D[0]),j(Se,$[1],$[0]),H(A,A,Se),de(h,D[0],D[1]),de(Se,$[0],$[1]),H(h,h,Se),H(I,D[3],$[3]),H(I,I,p),H(ee,D[2],$[2]),de(ee,ee,ee),j(ge,h,A),j(be,ee,I),de(Ne,ee,I),de(Le,h,A),H(D[0],ge,be),H(D[1],Le,Ne),H(D[2],Ne,be),H(D[3],ge,Le)}function Ce(D,$,A){for(let h=0;h<4;h++)F(D[h],$[h],A)}function Ue(D,$){const A=s(),h=s(),I=s();ve(I,$[2]),H(A,$[0],I),H(h,$[1],I),re(D,h),D[31]^=fe(A)<<7}function m(D,$,A){L(D[0],l),L(D[1],d),L(D[2],d),L(D[3],l);for(let h=255;h>=0;--h){const I=A[h/8|0]>>(h&7)&1;Ce(D,$,I),ue($,D),ue(D,D),Ce(D,$,I)}}function P(D,$){const A=[s(),s(),s(),s()];L(A[0],b),L(A[1],T),L(A[2],d),H(A[3],b,T),m(D,A,$)}function Y(D){if(D.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const $=(0,r.hash)(D);$[0]&=248,$[31]&=127,$[31]|=64;const A=new Uint8Array(32),h=[s(),s(),s(),s()];P(h,$),Ue(A,h);const I=new Uint8Array(64);return I.set(D),I.set(A,32),{publicKey:A,secretKey:I}}o.generateKeyPairFromSeed=Y;function ce(D){const $=(0,t.randomBytes)(32,D),A=Y($);return(0,n.wipe)($),A}o.generateKeyPair=ce;function V(D){if(D.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(D.subarray(32))}o.extractPublicKeyFromSecretKey=V;const k=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function B(D,$){let A,h,I,ee;for(h=63;h>=32;--h){for(A=0,I=h-32,ee=h-12;I<ee;++I)$[I]+=A-16*$[h]*k[I-(h-32)],A=Math.floor(($[I]+128)/256),$[I]-=A*256;$[I]+=A,$[h]=0}for(A=0,I=0;I<32;I++)$[I]+=A-($[31]>>4)*k[I],A=$[I]>>8,$[I]&=255;for(I=0;I<32;I++)$[I]-=A*k[I];for(h=0;h<32;h++)$[h+1]+=$[h]>>8,D[h]=$[h]&255}function G(D){const $=new Float64Array(64);for(let A=0;A<64;A++)$[A]=D[A];for(let A=0;A<64;A++)D[A]=0;B(D,$)}function Qe(D,$){const A=new Float64Array(64),h=[s(),s(),s(),s()],I=(0,r.hash)(D.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const ee=new Uint8Array(64);ee.set(I.subarray(32),32);const ge=new r.SHA512;ge.update(ee.subarray(32)),ge.update($);const be=ge.digest();ge.clean(),G(be),P(h,be),Ue(ee,h),ge.reset(),ge.update(ee.subarray(0,32)),ge.update(D.subarray(32)),ge.update($);const Ne=ge.digest();G(Ne);for(let Le=0;Le<32;Le++)A[Le]=be[Le];for(let Le=0;Le<32;Le++)for(let Se=0;Se<32;Se++)A[Le+Se]+=Ne[Le]*I[Se];return B(ee.subarray(32),A),ee}o.sign=Qe;function Be(D,$){const A=s(),h=s(),I=s(),ee=s(),ge=s(),be=s(),Ne=s();return L(D[2],d),pe(D[1],$),W(I,D[1]),H(ee,I,_),j(I,I,D[2]),de(ee,D[2],ee),W(ge,ee),W(be,ge),H(Ne,be,ge),H(A,Ne,I),H(A,A,ee),ie(A,A),H(A,A,I),H(A,A,ee),H(A,A,ee),H(D[0],A,ee),W(h,D[0]),H(h,h,ee),le(h,I)&&H(D[0],D[0],x),W(h,D[0]),H(h,h,ee),le(h,I)?-1:(fe(D[0])===$[31]>>7&&j(D[0],l,D[0]),H(D[3],D[0],D[1]),0)}function zr(D,$,A){const h=new Uint8Array(32),I=[s(),s(),s(),s()],ee=[s(),s(),s(),s()];if(A.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(Be(ee,D))return!1;const ge=new r.SHA512;ge.update(A.subarray(0,32)),ge.update(D),ge.update($);const be=ge.digest();return G(be),m(I,ee,be),P(ee,A.subarray(32)),ue(I,ee),Ue(h,I),!he(A,h)}o.verify=zr;function Ie(D){let $=[s(),s(),s(),s()];if(Be($,D))throw new Error("Ed25519: invalid public key");let A=s(),h=s(),I=$[1];de(A,d,I),j(h,d,I),ve(h,h),H(A,A,h);let ee=new Uint8Array(32);return re(ee,A),ee}o.convertPublicKeyToX25519=Ie;function xt(D){const $=(0,r.hash)(D.subarray(0,32));$[0]&=248,$[31]&=127,$[31]|=64;const A=new Uint8Array($.subarray(0,32));return(0,n.wipe)($),A}o.convertSecretKeyToX25519=xt})(kc);const mb="EdDSA",_b="JWT",Nf=".",$f="base64url",wb="utf8",bb="utf8",Eb=":",Ib="did",xb="key",vl="base58btc",Pb="z",Sb="K36",Ob=32;function Eo(o){return So(zc(Bi(o),wb),$f)}function Lf(o){const t=zc(Sb,vl),r=Pb+So(k0([t,o]),vl);return[Ib,xb,r].join(Eb)}function Rb(o){return So(o,$f)}function Tb(o){return zc([Eo(o.header),Eo(o.payload)].join(Nf),bb)}function Ab(o){return[Eo(o.header),Eo(o.payload),Rb(o.signature)].join(Nf)}function ml(o=uf.randomBytes(Ob)){return kc.generateKeyPairFromSeed(o)}async function Cb(o,t,r,n,s=ne.fromMiliseconds(Date.now())){const c={alg:mb,typ:_b},l=Lf(n.publicKey),d=s+r,_={iss:l,sub:o,aud:t,iat:s,exp:d},p=Tb({header:c,payload:_}),b=kc.sign(n.secretKey,p);return Ab({header:c,payload:_,signature:b})}const Nb="PARSE_ERROR",$b="INVALID_REQUEST",Lb="METHOD_NOT_FOUND",Db="INVALID_PARAMS",Df="INTERNAL_ERROR",Kc="SERVER_ERROR",jb=[-32700,-32600,-32601,-32602,-32603],Yn={[Nb]:{code:-32700,message:"Parse error"},[$b]:{code:-32600,message:"Invalid Request"},[Lb]:{code:-32601,message:"Method not found"},[Db]:{code:-32602,message:"Invalid params"},[Df]:{code:-32603,message:"Internal error"},[Kc]:{code:-32e3,message:"Server error"}},jf=Kc;function qb(o){return jb.includes(o)}function _l(o){return Object.keys(Yn).includes(o)?Yn[o]:Yn[jf]}function Mb(o){const t=Object.values(Yn).find(r=>r.code===o);return t||Yn[jf]}function qf(o,t,r){return o.message.includes("getaddrinfo ENOTFOUND")||o.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):o}var Mf={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Tc=function(o,t){return Tc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Tc(o,t)};function zb(o,t){Tc(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Ac=function(){return Ac=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Ac.apply(this,arguments)};function Ub(o,t){var r={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&t.indexOf(n)<0&&(r[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(r[n[s]]=o[n[s]]);return r}function Hb(o,t,r,n){var s=arguments.length,c=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,t,r,n);else for(var d=o.length-1;d>=0;d--)(l=o[d])&&(c=(s<3?l(c):s>3?l(t,r,c):l(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c}function kb(o,t){return function(r,n){t(r,n,o)}}function Kb(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function Bb(o,t,r,n){function s(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function d(b){try{p(n.next(b))}catch(T){l(T)}}function _(b){try{p(n.throw(b))}catch(T){l(T)}}function p(b){b.done?c(b.value):s(b.value).then(d,_)}p((n=n.apply(o,t||[])).next())})}function Fb(o,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(p){return function(b){return _([p,b])}}function _(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,s=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(o,r)}catch(b){p=[6,b],s=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function Vb(o,t,r,n){n===void 0&&(n=r),o[n]=t[r]}function Gb(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Cc(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],n=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function zf(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var n=r.call(o),s,c=[],l;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(d){l={error:d}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(l)throw l.error}}return c}function Wb(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(zf(arguments[t]));return o}function Jb(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var n=Array(o),s=0,t=0;t<r;t++)for(var c=arguments[t],l=0,d=c.length;l<d;l++,s++)n[s]=c[l];return n}function ts(o){return this instanceof ts?(this.v=o,this):new ts(o)}function Qb(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(o,t||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(x){n[x]&&(s[x]=function(L){return new Promise(function(C,F){c.push([x,L,C,F])>1||d(x,L)})})}function d(x,L){try{_(n[x](L))}catch(C){T(c[0][3],C)}}function _(x){x.value instanceof ts?Promise.resolve(x.value.v).then(p,b):T(c[0][2],x)}function p(x){d("next",x)}function b(x){d("throw",x)}function T(x,L){x(L),c.shift(),c.length&&d(c[0][0],c[0][1])}}function Yb(o){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,c){t[s]=o[s]?function(l){return(r=!r)?{value:ts(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function Xb(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Cc=="function"?Cc(o):o[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=o[c]&&function(l){return new Promise(function(d,_){l=o[c](l),s(d,_,l.done,l.value)})}}function s(c,l,d,_){Promise.resolve(_).then(function(p){c({value:p,done:d})},l)}}function Zb(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function e1(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function t1(o){return o&&o.__esModule?o:{default:o}}function r1(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function i1(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const n1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ac},__asyncDelegator:Yb,__asyncGenerator:Qb,__asyncValues:Xb,__await:ts,__awaiter:Bb,__classPrivateFieldGet:r1,__classPrivateFieldSet:i1,__createBinding:Vb,__decorate:Hb,__exportStar:Gb,__extends:zb,__generator:Fb,__importDefault:t1,__importStar:e1,__makeTemplateObject:Zb,__metadata:Kb,__param:kb,__read:zf,__rest:Ub,__spread:Wb,__spreadArrays:Jb,__values:Cc},Symbol.toStringTag,{value:"Module"})),s1=Po(n1);var si={},wl;function o1(){if(wl)return si;wl=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowserCryptoAvailable=si.getSubtleCrypto=si.getBrowerCrypto=void 0;function o(){return(Mr===null||Mr===void 0?void 0:Mr.crypto)||(Mr===null||Mr===void 0?void 0:Mr.msCrypto)||{}}si.getBrowerCrypto=o;function t(){const n=o();return n.subtle||n.webkitSubtle}si.getSubtleCrypto=t;function r(){return!!o()&&!!t()}return si.isBrowserCryptoAvailable=r,si}var oi={},bl;function a1(){if(bl)return oi;bl=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.isBrowser=oi.isNode=oi.isReactNative=void 0;function o(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}oi.isReactNative=o;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}oi.isNode=t;function r(){return!o()&&!t()}return oi.isBrowser=r,oi}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=s1;t.__exportStar(o1(),o),t.__exportStar(a1(),o)})(Mf);function Bc(o=3){const t=Date.now()*Math.pow(10,o),r=Math.floor(Math.random()*Math.pow(10,o));return t+r}function Uf(o=6){return BigInt(Bc(o))}function _n(o,t,r){return{id:r||Bc(),jsonrpc:"2.0",method:o,params:t}}function Fc(o,t){return{id:o,jsonrpc:"2.0",result:t}}function To(o,t,r){return{id:o,jsonrpc:"2.0",error:c1(t,r)}}function c1(o,t){return typeof o>"u"?_l(Df):(typeof o=="string"&&(o=Object.assign(Object.assign({},_l(Kc)),{message:o})),typeof t<"u"&&(o.data=t),qb(o.code)&&(o=Mb(o.code)),o)}class u1{}class h1 extends u1{constructor(){super()}}class l1 extends h1{constructor(t){super()}}const f1="^https?:",p1="^wss?:";function d1(o){const t=o.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Hf(o,t){const r=d1(o);return typeof r>"u"?!1:new RegExp(t).test(r)}function El(o){return Hf(o,f1)}function Il(o){return Hf(o,p1)}function g1(o){return new RegExp("wss?://localhost(:d{2,5})?").test(o)}function kf(o){return typeof o=="object"&&"id"in o&&"jsonrpc"in o&&o.jsonrpc==="2.0"}function Vc(o){return kf(o)&&"method"in o}function Ao(o){return kf(o)&&(ui(o)||qr(o))}function ui(o){return"result"in o}function qr(o){return"error"in o}class hi extends l1{constructor(t){super(t),this.events=new mr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(_n(t.method,t.params||[],t.id||Uf().toString()),r)}async requestStrict(t,r){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(c){s(c)}this.events.on(`${t.id}`,c=>{qr(c)?s(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){s(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Ao(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const y1=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),v1=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",xl=o=>o.split("?")[0],Pl=10,m1=y1();class _1{constructor(t){if(this.url=t,this.events=new mr.EventEmitter,this.registering=!1,!Il(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Bi(t))}catch(n){this.onError(t.id,n)}}register(t=this.url){if(!Il(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const s=Mf.isReactNative()?void 0:{rejectUnauthorized:!g1(t)},c=new m1(t,[],s);v1()?c.onerror=l=>{const d=l;n(this.emitError(d.error))}:c.on("error",l=>{n(this.emitError(l))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?is(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),s=n.message||n.toString(),c=To(t,s);this.events.emit("payload",c)}parseError(t,r=this.url){return qf(t,xl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Pl&&this.events.setMaxListeners(Pl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${xl(this.url)}`));return this.events.emit("register_error",r),r}}var Io={exports:{}};Io.exports;(function(o,t){var r=200,n="__lodash_hash_undefined__",s=1,c=2,l=9007199254740991,d="[object Arguments]",_="[object Array]",p="[object AsyncFunction]",b="[object Boolean]",T="[object Date]",x="[object Error]",L="[object Function]",C="[object GeneratorFunction]",F="[object Map]",re="[object Number]",he="[object Null]",le="[object Object]",fe="[object Promise]",pe="[object Proxy]",de="[object RegExp]",j="[object Set]",H="[object String]",W="[object Symbol]",ve="[object Undefined]",ie="[object WeakMap]",ue="[object ArrayBuffer]",Ce="[object DataView]",Ue="[object Float32Array]",m="[object Float64Array]",P="[object Int8Array]",Y="[object Int16Array]",ce="[object Int32Array]",V="[object Uint8Array]",k="[object Uint8ClampedArray]",B="[object Uint16Array]",G="[object Uint32Array]",Qe=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,zr=/^(?:0|[1-9]\d*)$/,Ie={};Ie[Ue]=Ie[m]=Ie[P]=Ie[Y]=Ie[ce]=Ie[V]=Ie[k]=Ie[B]=Ie[G]=!0,Ie[d]=Ie[_]=Ie[ue]=Ie[b]=Ie[Ce]=Ie[T]=Ie[x]=Ie[L]=Ie[F]=Ie[re]=Ie[le]=Ie[de]=Ie[j]=Ie[H]=Ie[ie]=!1;var xt=typeof Mr=="object"&&Mr&&Mr.Object===Object&&Mr,D=typeof self=="object"&&self&&self.Object===Object&&self,$=xt||D||Function("return this")(),A=t&&!t.nodeType&&t,h=A&&!0&&o&&!o.nodeType&&o,I=h&&h.exports===A,ee=I&&xt.process,ge=function(){try{return ee&&ee.binding&&ee.binding("util")}catch{}}(),be=ge&&ge.isTypedArray;function Ne(v,S){for(var U=-1,Q=v==null?0:v.length,Ge=0,me=[];++U<Q;){var tt=v[U];S(tt,U,v)&&(me[Ge++]=tt)}return me}function Le(v,S){for(var U=-1,Q=S.length,Ge=v.length;++U<Q;)v[Ge+U]=S[U];return v}function Se(v,S){for(var U=-1,Q=v==null?0:v.length;++U<Q;)if(S(v[U],U,v))return!0;return!1}function Pt(v,S){for(var U=-1,Q=Array(v);++U<v;)Q[U]=S(U);return Q}function _t(v){return function(S){return v(S)}}function at(v,S){return v.has(S)}function je(v,S){return v==null?void 0:v[S]}function Xe(v){var S=-1,U=Array(v.size);return v.forEach(function(Q,Ge){U[++S]=[Ge,Q]}),U}function Ze(v,S){return function(U){return v(S(U))}}function ct(v){var S=-1,U=Array(v.size);return v.forEach(function(Q){U[++S]=Q}),U}var He=Array.prototype,et=Function.prototype,$e=Object.prototype,Fe=$["__core-js_shared__"],lt=et.toString,Me=$e.hasOwnProperty,St=function(){var v=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Dt=$e.toString,kt=RegExp("^"+lt.call(Me).replace(Qe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Kt=I?$.Buffer:void 0,Mt=$.Symbol,Jt=$.Uint8Array,ir=$e.propertyIsEnumerable,Ur=He.splice,Qt=Mt?Mt.toStringTag:void 0,Gr=Object.getOwnPropertySymbols,fi=Kt?Kt.isBuffer:void 0,Ri=Ze(Object.keys,Object),ft=fr($,"DataView"),it=fr($,"Map"),pt=fr($,"Promise"),dt=fr($,"Set"),ut=fr($,"WeakMap"),nt=fr(Object,"create"),Ot=Jr(ft),Rt=Jr(it),gt=Jr(pt),Tt=Jr(dt),yt=Jr(ut),wt=Mt?Mt.prototype:void 0,vt=wt?wt.valueOf:void 0;function Ye(v){var S=-1,U=v==null?0:v.length;for(this.clear();++S<U;){var Q=v[S];this.set(Q[0],Q[1])}}function At(){this.__data__=nt?nt(null):{},this.size=0}function Ct(v){var S=this.has(v)&&delete this.__data__[v];return this.size-=S?1:0,S}function $o(v){var S=this.__data__;if(nt){var U=S[v];return U===n?void 0:U}return Me.call(S,v)?S[v]:void 0}function Lo(v){var S=this.__data__;return nt?S[v]!==void 0:Me.call(S,v)}function Do(v,S){var U=this.__data__;return this.size+=this.has(v)?0:1,U[v]=nt&&S===void 0?n:S,this}Ye.prototype.clear=At,Ye.prototype.delete=Ct,Ye.prototype.get=$o,Ye.prototype.has=Lo,Ye.prototype.set=Do;function _r(v){var S=-1,U=v==null?0:v.length;for(this.clear();++S<U;){var Q=v[S];this.set(Q[0],Q[1])}}function jo(){this.__data__=[],this.size=0}function qo(v){var S=this.__data__,U=Ti(S,v);if(U<0)return!1;var Q=S.length-1;return U==Q?S.pop():Ur.call(S,U,1),--this.size,!0}function Mo(v){var S=this.__data__,U=Ti(S,v);return U<0?void 0:S[U][1]}function zo(v){return Ti(this.__data__,v)>-1}function Uo(v,S){var U=this.__data__,Q=Ti(U,v);return Q<0?(++this.size,U.push([v,S])):U[Q][1]=S,this}_r.prototype.clear=jo,_r.prototype.delete=qo,_r.prototype.get=Mo,_r.prototype.has=zo,_r.prototype.set=Uo;function Wr(v){var S=-1,U=v==null?0:v.length;for(this.clear();++S<U;){var Q=v[S];this.set(Q[0],Q[1])}}function Wi(){this.size=0,this.__data__={hash:new Ye,map:new(it||_r),string:new Ye}}function Ho(v){var S=pi(this,v).delete(v);return this.size-=S?1:0,S}function Ji(v){return pi(this,v).get(v)}function ko(v){return pi(this,v).has(v)}function Ko(v,S){var U=pi(this,v),Q=U.size;return U.set(v,S),this.size+=U.size==Q?0:1,this}Wr.prototype.clear=Wi,Wr.prototype.delete=Ho,Wr.prototype.get=Ji,Wr.prototype.has=ko,Wr.prototype.set=Ko;function Qi(v){var S=-1,U=v==null?0:v.length;for(this.__data__=new Wr;++S<U;)this.add(v[S])}function ss(v){return this.__data__.set(v,n),this}function os(v){return this.__data__.has(v)}Qi.prototype.add=Qi.prototype.push=ss,Qi.prototype.has=os;function Tr(v){var S=this.__data__=new _r(v);this.size=S.size}function Bo(){this.__data__=new _r,this.size=0}function Fo(v){var S=this.__data__,U=S.delete(v);return this.size=S.size,U}function Vo(v){return this.__data__.get(v)}function Go(v){return this.__data__.has(v)}function as(v,S){var U=this.__data__;if(U instanceof _r){var Q=U.__data__;if(!it||Q.length<r-1)return Q.push([v,S]),this.size=++U.size,this;U=this.__data__=new Wr(Q)}return U.set(v,S),this.size=U.size,this}Tr.prototype.clear=Bo,Tr.prototype.delete=Fo,Tr.prototype.get=Vo,Tr.prototype.has=Go,Tr.prototype.set=as;function cs(v,S){var U=Zi(v),Q=!U&&ws(v),Ge=!U&&!Q&&xn(v),me=!U&&!Q&&!Ge&&Is(v),tt=U||Q||Ge||me,Nt=tt?Pt(v.length,String):[],Re=Nt.length;for(var We in v)(S||Me.call(v,We))&&!(tt&&(We=="length"||Ge&&(We=="offset"||We=="parent")||me&&(We=="buffer"||We=="byteLength"||We=="byteOffset")||gs(We,Re)))&&Nt.push(We);return Nt}function Ti(v,S){for(var U=v.length;U--;)if(_s(v[U][0],S))return U;return-1}function En(v,S,U){var Q=S(v);return Zi(v)?Q:Le(Q,U(v))}function Ai(v){return v==null?v===void 0?ve:he:Qt&&Qt in Object(v)?ps(v):Qo(v)}function In(v){return Ni(v)&&Ai(v)==d}function Ci(v,S,U,Q,Ge){return v===S?!0:v==null||S==null||!Ni(v)&&!Ni(S)?v!==v&&S!==S:us(v,S,U,Q,Ci,Ge)}function us(v,S,U,Q,Ge,me){var tt=Zi(v),Nt=Zi(S),Re=tt?_:Hr(v),We=Nt?_:Hr(S);Re=Re==d?le:Re,We=We==d?le:We;var bt=Re==le,nr=We==le,$t=Re==We;if($t&&xn(v)){if(!xn(S))return!1;tt=!0,bt=!1}if($t&&!bt)return me||(me=new Tr),tt||Is(v)?Yi(v,S,U,Q,Ge,me):Jo(v,S,Re,U,Q,Ge,me);if(!(U&s)){var rt=bt&&Me.call(v,"__wrapped__"),Yt=nr&&Me.call(S,"__wrapped__");if(rt||Yt){var Ar=rt?v.value():v,wr=Yt?S.value():S;return me||(me=new Tr),Ge(Ar,wr,U,Q,me)}}return $t?(me||(me=new Tr),fs(v,S,U,Q,Ge,me)):!1}function Wo(v){if(!Es(v)||vs(v))return!1;var S=en(v)?kt:Be;return S.test(Jr(v))}function hs(v){return Ni(v)&&bs(v.length)&&!!Ie[Ai(v)]}function ls(v){if(!ms(v))return Ri(v);var S=[];for(var U in Object(v))Me.call(v,U)&&U!="constructor"&&S.push(U);return S}function Yi(v,S,U,Q,Ge,me){var tt=U&s,Nt=v.length,Re=S.length;if(Nt!=Re&&!(tt&&Re>Nt))return!1;var We=me.get(v);if(We&&me.get(S))return We==S;var bt=-1,nr=!0,$t=U&c?new Qi:void 0;for(me.set(v,S),me.set(S,v);++bt<Nt;){var rt=v[bt],Yt=S[bt];if(Q)var Ar=tt?Q(Yt,rt,bt,S,v,me):Q(rt,Yt,bt,v,S,me);if(Ar!==void 0){if(Ar)continue;nr=!1;break}if($t){if(!Se(S,function(wr,kr){if(!at($t,kr)&&(rt===wr||Ge(rt,wr,U,Q,me)))return $t.push(kr)})){nr=!1;break}}else if(!(rt===Yt||Ge(rt,Yt,U,Q,me))){nr=!1;break}}return me.delete(v),me.delete(S),nr}function Jo(v,S,U,Q,Ge,me,tt){switch(U){case Ce:if(v.byteLength!=S.byteLength||v.byteOffset!=S.byteOffset)return!1;v=v.buffer,S=S.buffer;case ue:return!(v.byteLength!=S.byteLength||!me(new Jt(v),new Jt(S)));case b:case T:case re:return _s(+v,+S);case x:return v.name==S.name&&v.message==S.message;case de:case H:return v==S+"";case F:var Nt=Xe;case j:var Re=Q&s;if(Nt||(Nt=ct),v.size!=S.size&&!Re)return!1;var We=tt.get(v);if(We)return We==S;Q|=c,tt.set(v,S);var bt=Yi(Nt(v),Nt(S),Q,Ge,me,tt);return tt.delete(v),bt;case W:if(vt)return vt.call(v)==vt.call(S)}return!1}function fs(v,S,U,Q,Ge,me){var tt=U&s,Nt=Xi(v),Re=Nt.length,We=Xi(S),bt=We.length;if(Re!=bt&&!tt)return!1;for(var nr=Re;nr--;){var $t=Nt[nr];if(!(tt?$t in S:Me.call(S,$t)))return!1}var rt=me.get(v);if(rt&&me.get(S))return rt==S;var Yt=!0;me.set(v,S),me.set(S,v);for(var Ar=tt;++nr<Re;){$t=Nt[nr];var wr=v[$t],kr=S[$t];if(Q)var Pn=tt?Q(kr,wr,$t,S,v,me):Q(wr,kr,$t,v,S,me);if(!(Pn===void 0?wr===kr||Ge(wr,kr,U,Q,me):Pn)){Yt=!1;break}Ar||(Ar=$t=="constructor")}if(Yt&&!Ar){var $i=v.constructor,zt=S.constructor;$i!=zt&&"constructor"in v&&"constructor"in S&&!(typeof $i=="function"&&$i instanceof $i&&typeof zt=="function"&&zt instanceof zt)&&(Yt=!1)}return me.delete(v),me.delete(S),Yt}function Xi(v){return En(v,Zo,ds)}function pi(v,S){var U=v.__data__;return ys(S)?U[typeof S=="string"?"string":"hash"]:U.map}function fr(v,S){var U=je(v,S);return Wo(U)?U:void 0}function ps(v){var S=Me.call(v,Qt),U=v[Qt];try{v[Qt]=void 0;var Q=!0}catch{}var Ge=Dt.call(v);return Q&&(S?v[Qt]=U:delete v[Qt]),Ge}var ds=Gr?function(v){return v==null?[]:(v=Object(v),Ne(Gr(v),function(S){return ir.call(v,S)}))}:Ve,Hr=Ai;(ft&&Hr(new ft(new ArrayBuffer(1)))!=Ce||it&&Hr(new it)!=F||pt&&Hr(pt.resolve())!=fe||dt&&Hr(new dt)!=j||ut&&Hr(new ut)!=ie)&&(Hr=function(v){var S=Ai(v),U=S==le?v.constructor:void 0,Q=U?Jr(U):"";if(Q)switch(Q){case Ot:return Ce;case Rt:return F;case gt:return fe;case Tt:return j;case yt:return ie}return S});function gs(v,S){return S=S??l,!!S&&(typeof v=="number"||zr.test(v))&&v>-1&&v%1==0&&v<S}function ys(v){var S=typeof v;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?v!=="__proto__":v===null}function vs(v){return!!St&&St in v}function ms(v){var S=v&&v.constructor,U=typeof S=="function"&&S.prototype||$e;return v===U}function Qo(v){return Dt.call(v)}function Jr(v){if(v!=null){try{return lt.call(v)}catch{}try{return v+""}catch{}}return""}function _s(v,S){return v===S||v!==v&&S!==S}var ws=In(function(){return arguments}())?In:function(v){return Ni(v)&&Me.call(v,"callee")&&!ir.call(v,"callee")},Zi=Array.isArray;function Yo(v){return v!=null&&bs(v.length)&&!en(v)}var xn=fi||ke;function Xo(v,S){return Ci(v,S)}function en(v){if(!Es(v))return!1;var S=Ai(v);return S==L||S==C||S==p||S==pe}function bs(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=l}function Es(v){var S=typeof v;return v!=null&&(S=="object"||S=="function")}function Ni(v){return v!=null&&typeof v=="object"}var Is=be?_t(be):hs;function Zo(v){return Yo(v)?cs(v):ls(v)}function Ve(){return[]}function ke(){return!1}o.exports=Xo})(Io,Io.exports);var w1=Io.exports;const b1=Mc(w1);var E1={};function I1(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<o.length;s++){var c=o.charAt(s),l=c.charCodeAt(0);if(r[l]!==255)throw new TypeError(c+" is ambiguous");r[l]=s}var d=o.length,_=o.charAt(0),p=Math.log(d)/Math.log(256),b=Math.log(256)/Math.log(d);function T(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var F=0,re=0,he=0,le=C.length;he!==le&&C[he]===0;)he++,F++;for(var fe=(le-he)*b+1>>>0,pe=new Uint8Array(fe);he!==le;){for(var de=C[he],j=0,H=fe-1;(de!==0||j<re)&&H!==-1;H--,j++)de+=256*pe[H]>>>0,pe[H]=de%d>>>0,de=de/d>>>0;if(de!==0)throw new Error("Non-zero carry");re=j,he++}for(var W=fe-re;W!==fe&&pe[W]===0;)W++;for(var ve=_.repeat(F);W<fe;++W)ve+=o.charAt(pe[W]);return ve}function x(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var F=0;if(C[F]!==" "){for(var re=0,he=0;C[F]===_;)re++,F++;for(var le=(C.length-F)*p+1>>>0,fe=new Uint8Array(le);C[F];){var pe=r[C.charCodeAt(F)];if(pe===255)return;for(var de=0,j=le-1;(pe!==0||de<he)&&j!==-1;j--,de++)pe+=d*fe[j]>>>0,fe[j]=pe%256>>>0,pe=pe/256>>>0;if(pe!==0)throw new Error("Non-zero carry");he=de,F++}if(C[F]!==" "){for(var H=le-he;H!==le&&fe[H]===0;)H++;for(var W=new Uint8Array(re+(le-H)),ve=re;H!==le;)W[ve++]=fe[H++];return W}}}function L(C){var F=x(C);if(F)return F;throw new Error(`Non-${t} character`)}return{encode:T,decodeUnsafe:x,decode:L}}var x1=I1,P1=x1;const Kf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},S1=o=>new TextEncoder().encode(o),O1=o=>new TextDecoder().decode(o);class R1{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class T1{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Bf(this,t)}}class A1{constructor(t){this.decoders=t}or(t){return Bf(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bf=(o,t)=>new A1({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class C1{constructor(t,r,n,s){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new R1(t,r,n),this.decoder=new T1(t,r,s)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Co=({name:o,prefix:t,encode:r,decode:n})=>new C1(o,t,r,n),ns=({prefix:o,name:t,alphabet:r})=>{const{encode:n,decode:s}=P1(r,t);return Co({prefix:o,name:t,encode:n,decode:c=>Kf(s(c))})},N1=(o,t,r,n)=>{const s={};for(let b=0;b<t.length;++b)s[t[b]]=b;let c=o.length;for(;o[c-1]==="=";)--c;const l=new Uint8Array(c*r/8|0);let d=0,_=0,p=0;for(let b=0;b<c;++b){const T=s[o[b]];if(T===void 0)throw new SyntaxError(`Non-${n} character`);_=_<<r|T,d+=r,d>=8&&(d-=8,l[p++]=255&_>>d)}if(d>=r||255&_<<8-d)throw new SyntaxError("Unexpected end of data");return l},$1=(o,t,r)=>{const n=t[t.length-1]==="=",s=(1<<r)-1;let c="",l=0,d=0;for(let _=0;_<o.length;++_)for(d=d<<8|o[_],l+=8;l>r;)l-=r,c+=t[s&d>>l];if(l&&(c+=t[s&d<<r-l]),n)for(;c.length*r&7;)c+="=";return c},Ft=({name:o,prefix:t,bitsPerChar:r,alphabet:n})=>Co({prefix:t,name:o,encode(s){return $1(s,n,r)},decode(s){return N1(s,n,r,o)}}),L1=Co({prefix:"\0",name:"identity",encode:o=>O1(o),decode:o=>S1(o)});var D1=Object.freeze({__proto__:null,identity:L1});const j1=Ft({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var q1=Object.freeze({__proto__:null,base2:j1});const M1=Ft({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var z1=Object.freeze({__proto__:null,base8:M1});const U1=ns({prefix:"9",name:"base10",alphabet:"0123456789"});var H1=Object.freeze({__proto__:null,base10:U1});const k1=Ft({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),K1=Ft({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var B1=Object.freeze({__proto__:null,base16:k1,base16upper:K1});const F1=Ft({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),V1=Ft({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),G1=Ft({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),W1=Ft({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),J1=Ft({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Q1=Ft({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Y1=Ft({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),X1=Ft({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Z1=Ft({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var eE=Object.freeze({__proto__:null,base32:F1,base32upper:V1,base32pad:G1,base32padupper:W1,base32hex:J1,base32hexupper:Q1,base32hexpad:Y1,base32hexpadupper:X1,base32z:Z1});const tE=ns({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rE=ns({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var iE=Object.freeze({__proto__:null,base36:tE,base36upper:rE});const nE=ns({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),sE=ns({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var oE=Object.freeze({__proto__:null,base58btc:nE,base58flickr:sE});const aE=Ft({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),cE=Ft({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uE=Ft({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hE=Ft({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var lE=Object.freeze({__proto__:null,base64:aE,base64pad:cE,base64url:uE,base64urlpad:hE});const Ff=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),fE=Ff.reduce((o,t,r)=>(o[r]=t,o),[]),pE=Ff.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function dE(o){return o.reduce((t,r)=>(t+=fE[r],t),"")}function gE(o){const t=[];for(const r of o){const n=pE[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const yE=Co({prefix:"🚀",name:"base256emoji",encode:dE,decode:gE});var vE=Object.freeze({__proto__:null,base256emoji:yE}),mE=Vf,Sl=128,_E=127,wE=~_E,bE=Math.pow(2,31);function Vf(o,t,r){t=t||[],r=r||0;for(var n=r;o>=bE;)t[r++]=o&255|Sl,o/=128;for(;o&wE;)t[r++]=o&255|Sl,o>>>=7;return t[r]=o|0,Vf.bytes=r-n+1,t}var EE=Nc,IE=128,Ol=127;function Nc(o,n){var r=0,n=n||0,s=0,c=n,l,d=o.length;do{if(c>=d)throw Nc.bytes=0,new RangeError("Could not decode varint");l=o[c++],r+=s<28?(l&Ol)<<s:(l&Ol)*Math.pow(2,s),s+=7}while(l>=IE);return Nc.bytes=c-n,r}var xE=Math.pow(2,7),PE=Math.pow(2,14),SE=Math.pow(2,21),OE=Math.pow(2,28),RE=Math.pow(2,35),TE=Math.pow(2,42),AE=Math.pow(2,49),CE=Math.pow(2,56),NE=Math.pow(2,63),$E=function(o){return o<xE?1:o<PE?2:o<SE?3:o<OE?4:o<RE?5:o<TE?6:o<AE?7:o<CE?8:o<NE?9:10},LE={encode:mE,decode:EE,encodingLength:$E},Gf=LE;const Rl=(o,t,r=0)=>(Gf.encode(o,t,r),t),Tl=o=>Gf.encodingLength(o),$c=(o,t)=>{const r=t.byteLength,n=Tl(o),s=n+Tl(r),c=new Uint8Array(s+r);return Rl(o,c,0),Rl(r,c,n),c.set(t,s),new DE(o,r,t,c)};class DE{constructor(t,r,n,s){this.code=t,this.size=r,this.digest=n,this.bytes=s}}const Wf=({name:o,code:t,encode:r})=>new jE(o,t,r);class jE{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?$c(this.code,r):r.then(n=>$c(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Jf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),qE=Wf({name:"sha2-256",code:18,encode:Jf("SHA-256")}),ME=Wf({name:"sha2-512",code:19,encode:Jf("SHA-512")});var zE=Object.freeze({__proto__:null,sha256:qE,sha512:ME});const Qf=0,UE="identity",Yf=Kf,HE=o=>$c(Qf,Yf(o)),kE={code:Qf,name:UE,encode:Yf,digest:HE};var KE=Object.freeze({__proto__:null,identity:kE});new TextEncoder,new TextDecoder;const Al={...D1,...q1,...z1,...H1,...B1,...eE,...iE,...oE,...lE,...vE};({...zE,...KE});function Xf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function BE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Zf(o,t,r,n){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:n}}}const Cl=Zf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),lc=Zf("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=BE(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),FE={utf8:Cl,"utf-8":Cl,hex:Al.base16,latin1:lc,ascii:lc,binary:lc,...Al};function VE(o,t="utf8"){const r=FE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xf(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const ep="wc",GE=2,Gc="core",Pi=`${ep}@2:${Gc}:`,WE={name:Gc,logger:"error"},JE={database:":memory:"},QE="crypto",Nl="client_ed25519_seed",YE=ne.ONE_DAY,XE="keychain",ZE="0.3",eI="messages",tI="0.3",rI=ne.SIX_HOURS,iI="publisher",tp="irn",nI="error",rp="wss://relay.walletconnect.com",$l="wss://relay.walletconnect.org",sI="relayer",Wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},oI="_subscription",ai={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},aI=ne.ONE_SECOND,cI="2.10.2",uI=1e4,hI="0.3",lI="WALLETCONNECT_CLIENT_ID",Dr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},fI="subscription",pI="0.3",dI=ne.FIVE_SECONDS*1e3,gI="pairing",yI="0.3",Kn={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Jn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Vr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},vI="history",mI="0.3",_I="expirer",Rr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},wI="0.3",fc="verify-api",bo="https://verify.walletconnect.com",Ll="https://verify.walletconnect.org";class bI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=XE,this.version=ZE,this.initialized=!1,this.storagePrefix=Pi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()},this.get=n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:c}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return s},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,pf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?df(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class EI{constructor(t,r,n){this.core=t,this.logger=r,this.name=QE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=ml(s);return Lf(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=F0();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),l=ml(c),d=wc();return await Cb(d,s,YE,l)},this.generateSharedKey=(s,c,l)=>{this.isInitialized();const d=this.getPrivateKey(s),_=V0(d,c);return this.setSymKey(_,l)},this.setSymKey=async(s,c)=>{this.isInitialized();const l=c||G0(s);return await this.keychain.set(l,s),l},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,l)=>{this.isInitialized();const d=W0(l),_=Bi(c);if(Yh(d)){const x=d.senderPublicKey,L=d.receiverPublicKey;s=await this.generateSharedKey(x,L)}const p=this.getSymKey(s),{type:b,senderPublicKey:T}=d;return J0({type:b,symKey:p,message:_,senderPublicKey:T})},this.decode=async(s,c,l)=>{this.isInitialized();const d=Q0(c,l);if(Yh(d)){const _=d.receiverPublicKey,p=d.senderPublicKey;s=await this.generateSharedKey(_,p)}try{const _=this.getSymKey(s),p=Y0({symKey:_,encoded:c});return is(p)}catch(_){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(_)}},this.getPayloadType=s=>{const c=Xh(s);return X0(c.type)},this.getPayloadSenderPublicKey=s=>{const c=Xh(s);return c.senderPublicKey?So(c.senderPublicKey,Z0):void 0},this.core=t,this.logger=Ae.generateChildLogger(r,this.name),this.keychain=n||new bI(this.core,this.logger)}get context(){return Ae.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Nl)}catch{t=wc(),await this.keychain.set(Nl,t)}return VE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class II extends ub{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=eI,this.version=tI,this.initialized=!1,this.storagePrefix=Pi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,s)=>{this.isInitialized();const c=vn(s);let l=this.messages.get(n);return typeof l>"u"&&(l={}),typeof l[c]<"u"||(l[c]=s,this.messages.set(n,l),await this.persist()),c},this.get=n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s},this.has=(n,s)=>{this.isInitialized();const c=this.get(n),l=vn(s);return typeof c[l]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ae.generateChildLogger(t,this.name),this.core=r}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,pf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?df(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class xI extends hb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new mr.EventEmitter,this.name=iI,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,s,c)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:c}});try{const d=(c==null?void 0:c.ttl)||rI,_=bc(c),p=(c==null?void 0:c.prompt)||!1,b=(c==null?void 0:c.tag)||0,T=(c==null?void 0:c.id)||Uf().toString(),x={topic:n,message:s,opts:{ttl:d,relay:_,prompt:p,tag:b,id:T}},L=setTimeout(()=>this.queue.set(T,x),this.publishTimeout);try{await await Xn(this.rpcPublish(n,s,d,_,p,b,T),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(T),this.relayer.events.emit(Wt.publish,x)}catch(C){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=c==null?void 0:c.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(T),C;return}finally{clearTimeout(L)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:c}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.relayer=t,this.logger=Ae.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ae.getLoggerContext(this.logger)}rpcPublish(t,r,n,s,c,l,d){var _,p,b,T;const x={method:yo(s.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:c,tag:l},id:d};return xi((_=x.params)==null?void 0:_.prompt)&&((p=x.params)==null||delete p.prompt),xi((b=x.params)==null?void 0:b.tag)&&((T=x.params)==null||delete T.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:x}),this.relayer.request(x)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:s}=t;await this.publish(r,n,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Wt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Wt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class PI{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const s=n.filter(c=>c!==r);if(!s.length){this.map.delete(t);return}this.map.set(t,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var SI=Object.defineProperty,OI=Object.defineProperties,RI=Object.getOwnPropertyDescriptors,Dl=Object.getOwnPropertySymbols,TI=Object.prototype.hasOwnProperty,AI=Object.prototype.propertyIsEnumerable,jl=(o,t,r)=>t in o?SI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Bn=(o,t)=>{for(var r in t||(t={}))TI.call(t,r)&&jl(o,r,t[r]);if(Dl)for(var r of Dl(t))AI.call(t,r)&&jl(o,r,t[r]);return o},pc=(o,t)=>OI(o,RI(t));class CI extends pb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new PI,this.events=new mr.EventEmitter,this.name=fI,this.version=pI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Pi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const c=bc(s),l={topic:n,relay:c};this.pending.set(n,l);const d=await this.rpcSubscribe(n,c);return this.onSubscribe(d,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}}),d}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((s,c)=>{const l=new ne.Watch;l.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(d),l.stop(this.pendingSubscriptionWatchLabel),s(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=dI&&(clearInterval(d),l.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ae.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async s=>await this.unsubscribeById(t,s,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const s=bc(n);await this.rpcUnsubscribe(t,r,s);const c=rr("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(t,r){const n={method:yo(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}return vn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:yo(r.protocol).batchSubscribe,params:{topics:t.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}}rpcUnsubscribe(t,r,n){const s={method:yo(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(t,r){this.setSubscription(t,pc(Bn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Bn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Bn({},r)),this.topicMap.set(r.topic,t),this.events.emit(Dr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(Dr.deleted,pc(Bn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Dr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);wn(r)&&this.onBatchSubscribe(r.map((n,s)=>pc(Bn({},t[s]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Wt.connect,async()=>{await this.onConnect()}),this.relayer.on(Wt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dr.created,async t=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Dr.deleted,async t=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var NI=Object.defineProperty,ql=Object.getOwnPropertySymbols,$I=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,Ml=(o,t,r)=>t in o?NI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,DI=(o,t)=>{for(var r in t||(t={}))$I.call(t,r)&&Ml(o,r,t[r]);if(ql)for(var r of ql(t))LI.call(t,r)&&Ml(o,r,t[r]);return o};class jI extends lb{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new mr.EventEmitter,this.name=sI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Wt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Wt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ai.payload,this.onPayloadHandler),this.provider.on(ai.connect,this.onConnectHandler),this.provider.on(ai.disconnect,this.onDisconnectHandler),this.provider.on(ai.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ae.generateChildLogger(t.logger,this.name):Ae.pino(Ae.getDefaultLoggerOptions({level:t.logger||nI})),this.messages=new II(this.logger,t.core),this.subscriber=new CI(this,this.logger),this.publisher=new xI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||rp,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${$l}...`),await this.restartTransport($l)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},uI)}get context(){return Ae.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let s=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(s)return s;let c;const l=d=>{d.topic===t&&(this.subscriber.off(Dr.created,l),c())};return await Promise.all([new Promise(d=>{c=d,this.subscriber.on(Dr.created,l)}),new Promise(async d=>{s=await this.subscriber.subscribe(t,r),d()})]),s}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Dr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Xn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(s){n(s);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(ai.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Zh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hi(new _1(e_({sdkVersion:cI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const s=this.messages.has(r,n);return s&&this.logger.debug(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Vc(t)){if(!t.method.endsWith(oI))return;const r=t.params,{topic:n,message:s,publishedAt:c}=r.data,l={topic:n,message:s,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(DI({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else Ao(t)&&this.events.emit(Wt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Wt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Fc(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ai.payload,this.onPayloadHandler),this.provider.off(ai.connect,this.onConnectHandler),this.provider.off(ai.disconnect,this.onDisconnectHandler),this.provider.off(ai.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Wt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Zh();t_(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Wt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ne.toMiliseconds(aI)))}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var qI=Object.defineProperty,zl=Object.getOwnPropertySymbols,MI=Object.prototype.hasOwnProperty,zI=Object.prototype.propertyIsEnumerable,Ul=(o,t,r)=>t in o?qI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Hl=(o,t)=>{for(var r in t||(t={}))MI.call(t,r)&&Ul(o,r,t[r]);if(zl)for(var r of zl(t))zI.call(t,r)&&Ul(o,r,t[r]);return o};class No extends fb{constructor(t,r,n,s=Pi,c=void 0){super(t,r,n,s),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=hI,this.cached=[],this.initialized=!1,this.storagePrefix=Pi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!xi(l)?this.map.set(this.getKey(l),l):K0(l)?this.map.set(l.id,l):B0(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,d)=>{this.isInitialized(),this.map.has(l)?await this.update(l,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:d}),this.map.set(l,d),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(d=>Object.keys(l).every(_=>b1(d[_],l[_]))):this.values),this.update=async(l,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:d});const _=Hl(Hl({},this.getData(l)),d);this.map.set(l,_),await this.persist()},this.delete=async(l,d)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:d}),this.map.delete(l),await this.persist())},this.logger=Ae.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class UI{constructor(t,r){this.core=t,this.logger=r,this.name=gI,this.version=yI,this.events=new Hc,this.initialized=!1,this.storagePrefix=Pi,this.ignoredPayloadTypes=[hf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=wc(),s=await this.core.crypto.setSymKey(n),c=jr(ne.FIVE_MINUTES),l={protocol:tp},d={topic:s,expiry:c,relay:l,active:!1},_=r_({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:l});return await this.pairings.set(s,d),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:_}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:s,symKey:c,relay:l}=i_(n.uri);let d;if(this.pairings.keys.includes(s)&&(d=this.pairings.get(s),d.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(s)||(await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:l}));const _=jr(ne.FIVE_MINUTES),p={topic:s,relay:l,expiry:_,active:!1};return await this.pairings.set(s,p),this.core.expirer.set(s,_),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Jn.create,p),p},this.activate=async({topic:n})=>{this.isInitialized();const s=jr(ne.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:s}),this.core.expirer.set(n,s)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:s}=n;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:l,resolve:d,reject:_}=gn();this.events.once(Lt("pairing_ping",c),({error:p})=>{p?_(p):d()}),await l()}},this.updateExpiry=async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})},this.updateMetadata=async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",rr("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(n,s,c)=>{const l=_n(s,c),d=await this.core.crypto.encode(n,l),_=Kn[s].req;return this.core.history.set(n,l),this.core.relayer.publish(n,d,_),l.id},this.sendResult=async(n,s,c)=>{const l=Fc(n,c),d=await this.core.crypto.encode(s,l),_=await this.core.history.get(s,n),p=Kn[_.request.method].res;await this.core.relayer.publish(s,d,p),await this.core.history.resolve(l)},this.sendError=async(n,s,c)=>{const l=To(n,c),d=await this.core.crypto.encode(s,l),_=await this.core.history.get(s,n),p=Kn[_.request.method]?Kn[_.request.method].res:Kn.unregistered_method.res;await this.core.relayer.publish(s,d,p),await this.core.history.resolve(l)},this.deletePairing=async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,rr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(s=>Ii(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=n=>{const{topic:s,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async n=>{const{topic:s,payload:c}=n,l=(await this.core.history.get(s,c.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(n,s)=>{const{id:c}=s;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Jn.ping,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onPairingPingResponse=(n,s)=>{const{id:c}=s;setTimeout(()=>{ui(s)?this.events.emit(Lt("pairing_ping",c),{}):qr(s)&&this.events.emit(Lt("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(n,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Jn.delete,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(n,s)=>{const{id:c,method:l}=s;try{if(this.registeredMethods.includes(l))return;const d=rr("WC_METHOD_UNSUPPORTED",l);await this.sendError(c,n,d),this.logger.error(d)}catch(d){await this.sendError(c,n,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(rr("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!lr(n)){const{message:s}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(s)}if(!n_(n.uri)){const{message:s}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(s)}},this.isValidPing=async n=>{if(!lr(n)){const{message:c}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:s}=n;await this.isValidPairingTopic(s)},this.isValidDisconnect=async n=>{if(!lr(n)){const{message:c}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:s}=n;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async n=>{if(!yn(n,!1)){const{message:s}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(Ii(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}},this.core=t,this.logger=Ae.generateChildLogger(r,this.name),this.pairings=new No(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ae.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Wt.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const s=await this.core.crypto.decode(r,n);try{Vc(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Ao(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Rr.expired,async t=>{const{topic:r}=lf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Jn.expire,{topic:r}))})}}class HI extends cb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new mr.EventEmitter,this.name=vI,this.version=mI,this.cached=[],this.initialized=!1,this.storagePrefix=Pi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:c}),this.records.has(s.id))return;const l={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:c,expiry:jr(ne.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(Vr.created,l)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=qr(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.events.emit(Vr.updated,s))},this.get=async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s)),this.delete=(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===n){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(Vr.deleted,c)}})},this.exists=async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1),this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:_n(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Vr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Vr.created,t=>{const r=Vr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Vr.updated,t=>{const r=Vr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Vr.deleted,t=>{const r=Vr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ne.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class kI extends db{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new mr.EventEmitter,this.name=_I,this.version=wI,this.cached=[],this.initialized=!1,this.storagePrefix=Pi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(n,s)=>{this.isInitialized();const c=this.formatTarget(n),l={target:c,expiry:s};this.expirations.set(c,l),this.checkExpiry(c,l),this.events.emit(Rr.created,{target:c,expiration:l})},this.get=n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)},this.del=n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Rr.deleted,{target:s,expiration:c})}},this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return s_(t);if(typeof t=="number")return o_(t);const{message:r}=Z("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Rr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;ne.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Rr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Rr.created,t=>{const r=Rr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Rr.expired,t=>{const r=Rr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Rr.deleted,t=>{const r=Rr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class KI extends gb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=fc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||a_()||!ff())return;const n=bo;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Ll;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const s=(n==null?void 0:n.verifyUrl)||bo;let c;try{c=await this.fetchAttestation(n.attestationId,s)}catch(l){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${s}`),this.logger.info(l),c=await this.fetchAttestation(n.attestationId,Ll)}return c},this.fetchAttestation=async(n,s)=>{this.logger.info(`resolving attestation: ${n} from url: ${s}`);const c=this.startAbortTimer(ne.ONE_SECOND*2),l=await fetch(`${s}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),l.status===200?await l.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const s=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",s),n())};await Promise.race([new Promise(c=>{if(document.getElementById(fc))return c();window.addEventListener("message",s);const l=document.createElement("iframe");l.id=fc,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,n=c}),new Promise((c,l)=>setTimeout(()=>{window.removeEventListener("message",s),l("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ae.generateChildLogger(r,this.name),this.verifyUrl=bo,this.abortController=new AbortController,this.isDevEnv=c_()&&E1.IS_VITEST}get context(){return Ae.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(t))}}var BI=Object.defineProperty,kl=Object.getOwnPropertySymbols,FI=Object.prototype.hasOwnProperty,VI=Object.prototype.propertyIsEnumerable,Kl=(o,t,r)=>t in o?BI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Bl=(o,t)=>{for(var r in t||(t={}))FI.call(t,r)&&Kl(o,r,t[r]);if(kl)for(var r of kl(t))VI.call(t,r)&&Kl(o,r,t[r]);return o};class Wc extends ab{constructor(t){super(t),this.protocol=ep,this.version=GE,this.name=Gc,this.events=new mr.EventEmitter,this.initialized=!1,this.on=(n,s)=>this.events.on(n,s),this.once=(n,s)=>this.events.once(n,s),this.off=(n,s)=>this.events.off(n,s),this.removeListener=(n,s)=>this.events.removeListener(n,s),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||rp,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||WE.logger}));this.logger=Ae.generateChildLogger(r,this.name),this.heartbeat=new bn.HeartBeat,this.crypto=new EI(this,this.logger,t==null?void 0:t.keychain),this.history=new HI(this,this.logger),this.expirer=new kI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new lw(Bl(Bl({},JE),t==null?void 0:t.storageOptions)),this.relayer=new jI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new UI(this,this.logger),this.verify=new KI(this.projectId||"",this.logger)}static async init(t){const r=new Wc(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(lI,n),r}get context(){return Ae.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const GI=Wc,ip="wc",np=2,sp="client",Jc=`${ip}@${np}:${sp}:`,dc={name:sp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Fl="WALLETCONNECT_DEEPLINK_CHOICE",WI="proposal",op="Proposal expired",JI="session",fo=ne.SEVEN_DAYS,QI="engine",Fn={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},gc={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},ci={idle:"IDLE",active:"ACTIVE"},YI="request",XI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var ZI=Object.defineProperty,ex=Object.defineProperties,tx=Object.getOwnPropertyDescriptors,Vl=Object.getOwnPropertySymbols,rx=Object.prototype.hasOwnProperty,ix=Object.prototype.propertyIsEnumerable,Gl=(o,t,r)=>t in o?ZI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,ur=(o,t)=>{for(var r in t||(t={}))rx.call(t,r)&&Gl(o,r,t[r]);if(Vl)for(var r of Vl(t))ix.call(t,r)&&Gl(o,r,t[r]);return o},Vn=(o,t)=>ex(o,tx(t));class nx extends vb{constructor(t){super(t),this.name=QI,this.events=new Hc,this.initialized=!1,this.ignoredPayloadTypes=[hf],this.requestQueue={state:ci.idle,queue:[]},this.sessionRequestQueue={state:ci.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Fn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Vn(ur({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:s,requiredNamespaces:c,optionalNamespaces:l,sessionProperties:d,relays:_}=n;let p=s,b,T=!1;if(p&&(T=this.client.core.pairing.pairings.get(p).active),!p||!T){const{topic:fe,uri:pe}=await this.client.core.pairing.create();p=fe,b=pe}const x=await this.client.core.crypto.generateKeyPair(),L=ur({requiredNamespaces:c,optionalNamespaces:l,relays:_??[{protocol:tp}],proposer:{publicKey:x,metadata:this.client.metadata}},d&&{sessionProperties:d}),{reject:C,resolve:F,done:re}=gn(ne.FIVE_MINUTES,op);if(this.events.once(Lt("session_connect"),async({error:fe,session:pe})=>{if(fe)C(fe);else if(pe){pe.self.publicKey=x;const de=Vn(ur({},pe),{requiredNamespaces:pe.requiredNamespaces,optionalNamespaces:pe.optionalNamespaces});await this.client.session.set(pe.topic,de),await this.setExpiry(pe.topic,pe.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:pe.peer.metadata}),F(de)}}),!p){const{message:fe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(fe)}const he=await this.sendRequest({topic:p,method:"wc_sessionPropose",params:L}),le=jr(ne.FIVE_MINUTES);return await this.setProposal(he,ur({id:he,expiry:le},L)),{uri:b,approval:re}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:s,namespaces:c,sessionProperties:l}=r,d=this.client.proposal.get(n);let{pairingTopic:_,proposer:p,requiredNamespaces:b,optionalNamespaces:T}=d;_=_||"",vo(b)||(b=h_(c,"approve()"));const x=await this.client.core.crypto.generateKeyPair(),L=p.publicKey,C=await this.client.core.crypto.generateSharedKey(x,L);_&&n&&(await this.client.core.pairing.updateMetadata({topic:_,metadata:p.metadata}),await this.sendResult({id:n,topic:_,result:{relay:{protocol:s??"irn"},responderPublicKey:x}}),await this.client.proposal.delete(n,rr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}));const F=ur({relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:b,optionalNamespaces:T,pairingTopic:_,controller:{publicKey:x,metadata:this.client.metadata},expiry:jr(fo)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(C),await this.sendRequest({topic:C,method:"wc_sessionSettle",params:F,throwOnFailedPublish:!0});const re=Vn(ur({},F),{topic:C,pairingTopic:_,acknowledged:!1,self:F.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:x});return await this.client.session.set(C,re),await this.setExpiry(C,jr(fo)),{topic:C,acknowledged:()=>new Promise(he=>setTimeout(()=>he(this.client.session.get(C)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:s}=r,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,s),await this.client.proposal.delete(n,rr("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:s}=r,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s}}),{done:l,resolve:d,reject:_}=gn();return this.events.once(Lt("session_update",c),({error:p})=>{p?_(p):d()}),await this.client.session.update(n,{namespaces:s}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,s=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:l,reject:d}=gn();return this.events.once(Lt("session_extend",s),({error:_})=>{_?d(_):l()}),await this.setExpiry(n,jr(fo)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:s,topic:c,expiry:l}=r,d=Bc(),{done:_,resolve:p,reject:b}=gn(l,"Request expired. Please try again.");return this.events.once(Lt("session_request",d),({error:T,result:x})=>{T?b(T):p(x)}),await Promise.all([new Promise(async T=>{await this.sendRequest({clientRpcId:d,topic:c,method:"wc_sessionRequest",params:{request:s,chainId:n},expiry:l,throwOnFailedPublish:!0}).catch(x=>b(x)),this.client.events.emit("session_request_sent",{topic:c,request:s,chainId:n,id:d}),T()}),new Promise(async T=>{const x=await this.client.core.storage.getItem(Fl);l_({id:d,topic:c,wcDeepLink:x}),T()}),_()]).then(T=>T[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:s}=r,{id:c}=s;ui(s)?await this.sendResult({id:c,topic:n,result:s.result,throwOnFailedPublish:!0}):qr(s)&&await this.sendError(c,n,s.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const s=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:l,reject:d}=gn();this.events.once(Lt("session_ping",s),({error:_})=>{_?d(_):l()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:s,chainId:c}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:rr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>f_(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(c=>{var l,d;return((l=c.peerMetadata)==null?void 0:l.url)&&((d=c.peerMetadata)==null?void 0:d.url)===r.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,rr("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Fl).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,rr("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),s&&(this.sessionRequestQueue.state=ci.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Fn.wc_sessionRequest.req.ttl,{id:s,topic:c,params:l,verifyContext:d}=r;await this.client.pendingRequest.set(s,{id:s,topic:c,params:l,verifyContext:d}),n&&this.client.core.expirer.set(s,jr(n))},this.sendRequest=async r=>{const{topic:n,method:s,params:c,expiry:l,relayRpcId:d,clientRpcId:_,throwOnFailedPublish:p}=r,b=_n(s,c,_);if(ff()&&XI.includes(s)){const L=vn(JSON.stringify(b));this.client.core.verify.register({attestationId:L})}const T=await this.client.core.crypto.encode(n,b),x=Fn[s].req;return l&&(x.ttl=l),d&&(x.id=d),this.client.core.history.set(n,b),p?(x.internal=Vn(ur({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,T,x)):this.client.core.relayer.publish(n,T,x).catch(L=>this.client.logger.error(L)),b.id},this.sendResult=async r=>{const{id:n,topic:s,result:c,throwOnFailedPublish:l}=r,d=Fc(n,c),_=await this.client.core.crypto.encode(s,d),p=await this.client.core.history.get(s,n),b=Fn[p.request.method].res;l?(b.internal=Vn(ur({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,_,b)):this.client.core.relayer.publish(s,_,b).catch(T=>this.client.logger.error(T)),await this.client.core.history.resolve(d)},this.sendError=async(r,n,s)=>{const c=To(r,s),l=await this.client.core.crypto.encode(n,c),d=await this.client.core.history.get(n,r),_=Fn[d.request.method].res;this.client.core.relayer.publish(n,l,_),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(s=>{Ii(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ii(s.expiry)&&n.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...n.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ci.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ci.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ci.idle},this.processRequest=r=>{const{topic:n,payload:s}=r,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,s);case"wc_sessionSettle":return this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return this.onSessionExtendRequest(n,s);case"wc_sessionPing":return this.onSessionPingRequest(n,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return this.onSessionRequest(n,s);case"wc_sessionEvent":return this.onSessionEventRequest(n,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:s}=r,c=(await this.client.core.history.get(n,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:s}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(r,n)=>{const{params:s,id:c}=n;try{this.isValidConnect(ur({},n.params));const l=jr(ne.FIVE_MINUTES),d=ur({id:c,pairingTopic:r,expiry:l},s);await this.setProposal(c,d);const _=vn(JSON.stringify(n)),p=await this.getVerifyContext(_,d.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:d,verifyContext:p})}catch(l){await this.sendError(c,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,n)=>{const{id:s}=n;if(ui(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const l=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const d=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const _=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const p=await this.client.core.crypto.generateSharedKey(d,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p});const b=await this.client.core.relayer.subscribe(p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:r})}else qr(n)&&(await this.client.proposal.delete(s,rr("USER_DISCONNECTED")),this.events.emit(Lt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:s,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:l,controller:d,expiry:_,namespaces:p,requiredNamespaces:b,optionalNamespaces:T,sessionProperties:x,pairingTopic:L}=n.params,C=ur({topic:r,relay:l,expiry:_,namespaces:p,acknowledged:!0,pairingTopic:L,requiredNamespaces:b,optionalNamespaces:T,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},x&&{sessionProperties:x});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Lt("session_connect"),{session:C}),this.cleanupDuplicatePairings(C)}catch(l){await this.sendError(s,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,n)=>{const{id:s}=n;ui(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Lt("session_approve",s),{})):qr(n)&&(await this.client.session.delete(r,rr("USER_DISCONNECTED")),this.events.emit(Lt("session_approve",s),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:s,id:c}=n;try{const l=`${r}_session_update`,d=uo.get(l);if(d&&this.isRequestOutOfSync(d,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(ur({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:s}),uo.set(l,c)}catch(l){await this.sendError(c,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:s}=n;ui(n)?this.events.emit(Lt("session_update",s),{}):qr(n)&&this.events.emit(Lt("session_update",s),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:s}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,jr(fo)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,n)=>{const{id:s}=n;ui(n)?this.events.emit(Lt("session_extend",s),{}):qr(n)&&this.events.emit(Lt("session_extend",s),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,n)=>{const{id:s}=n;setTimeout(()=>{ui(n)?this.events.emit(Lt("session_ping",s),{}):qr(n)&&this.events.emit(Lt("session_ping",s),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Wt.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:s,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:s,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,n)=>{const{id:s,params:c}=n;try{this.isValidRequest(ur({topic:r},c));const l=vn(JSON.stringify(_n("wc_sessionRequest",c,s))),d=this.client.session.get(r),_=await this.getVerifyContext(l,d.peer.metadata),p={id:s,topic:r,params:c,verifyContext:_};await this.setPendingSessionRequest(p),this.addSessionRequestToSessionRequestQueue(p),this.processSessionRequestQueue()}catch(l){await this.sendError(s,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,n)=>{const{id:s}=n;ui(n)?this.events.emit(Lt("session_request",s),{result:n.result}):qr(n)&&this.events.emit(Lt("session_request",s),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:s,params:c}=n;try{const l=`${r}_session_event_${c.event.name}`,d=uo.get(l);if(d&&this.isRequestOutOfSync(d,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ur({topic:r},c)),this.client.events.emit("session_event",{id:s,topic:r,params:c}),uo.set(l,s)}catch(l){await this.sendError(s,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ci.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ci.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ci.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,_n("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async r=>{if(!lr(r)){const{message:_}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(_)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:c,sessionProperties:l,relays:d}=r;if(xi(n)||await this.isValidPairingTopic(n),!p_(d,!0)){const{message:_}=Z("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(_)}!xi(s)&&vo(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!xi(c)&&vo(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),xi(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,n)=>{const s=d_(r,"connect()",n);if(s)throw new Error(s.message)},this.isValidApprove=async r=>{if(!lr(r))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:s,relayProtocol:c,sessionProperties:l}=r;await this.isValidProposalId(n);const d=this.client.proposal.get(n),_=ic(s,"approve()");if(_)throw new Error(_.message);const p=el(d.requiredNamespaces,s,"approve()");if(p)throw new Error(p.message);if(!yn(c,!0)){const{message:b}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(b)}xi(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!lr(r)){const{message:c}=Z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:n,reason:s}=r;if(await this.isValidProposalId(n),!g_(s)){const{message:c}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!lr(r)){const{message:p}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(p)}const{relay:n,controller:s,namespaces:c,expiry:l}=r;if(!y_(n)){const{message:p}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(p)}const d=v_(s,"onSessionSettleRequest()");if(d)throw new Error(d.message);const _=ic(c,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(Ii(l)){const{message:p}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(p)}},this.isValidUpdate=async r=>{if(!lr(r)){const{message:_}=Z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(_)}const{topic:n,namespaces:s}=r;await this.isValidSessionTopic(n);const c=this.client.session.get(n),l=ic(s,"update()");if(l)throw new Error(l.message);const d=el(c.requiredNamespaces,s,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async r=>{if(!lr(r)){const{message:s}=Z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!lr(r)){const{message:_}=Z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(_)}const{topic:n,request:s,chainId:c,expiry:l}=r;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!tl(d,c)){const{message:_}=Z("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(_)}if(!m_(s)){const{message:_}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(_)}if(!__(d,c,s.method)){const{message:_}=Z("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(_)}if(l&&!w_(l,gc)){const{message:_}=Z("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${gc.min} and ${gc.max}`);throw new Error(_)}},this.isValidRespond=async r=>{if(!lr(r)){const{message:c}=Z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:n,response:s}=r;if(await this.isValidSessionTopic(n),!b_(s)){const{message:c}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!lr(r)){const{message:s}=Z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!lr(r)){const{message:d}=Z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(d)}const{topic:n,event:s,chainId:c}=r;await this.isValidSessionTopic(n);const{namespaces:l}=this.client.session.get(n);if(!tl(l,c)){const{message:d}=Z("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(d)}if(!E_(s)){const{message:d}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(d)}if(!I_(l,c,s.name)){const{message:d}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(d)}},this.isValidDisconnect=async r=>{if(!lr(r)){const{message:s}=Z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const s={verified:{verifyUrl:n.verifyUrl||bo,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});c&&(s.verified.origin=c.origin,s.verified.isScam=c.isScam,s.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(s=>{if(!yn(s,!1)){const{message:c}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Wt.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const s=await this.client.core.crypto.decode(r,n);try{Vc(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Ao(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.client.core.history.delete(r,s.id)):this.onRelayEventUnknownPayload({topic:r,payload:s})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Rr.expired,async t=>{const{topic:r,id:n}=lf(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Jn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!yn(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ii(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=Z("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!yn(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ii(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=Z("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(yn(t,!1)){const{message:r}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!x_(t)){const{message:r}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ii(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=Z("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class sx extends No{constructor(t,r){super(t,r,WI,Jc),this.core=t,this.logger=r}}class ox extends No{constructor(t,r){super(t,r,JI,Jc),this.core=t,this.logger=r}}class ax extends No{constructor(t,r){super(t,r,YI,Jc,n=>n.id),this.core=t,this.logger=r}}let cx=class ap extends yb{constructor(t){super(t),this.protocol=ip,this.version=np,this.name=dc.name,this.events=new mr.EventEmitter,this.on=(n,s)=>this.events.on(n,s),this.once=(n,s)=>this.events.once(n,s),this.off=(n,s)=>this.events.off(n,s),this.removeListener=(n,s)=>this.events.removeListener(n,s),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}},this.update=async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}},this.request=async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}},this.find=n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||dc.name,this.metadata=(t==null?void 0:t.metadata)||u_();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||dc.logger}));this.core=(t==null?void 0:t.core)||new GI(t),this.logger=Ae.generateChildLogger(r,this.name),this.session=new ox(this.core,this.logger),this.proposal=new sx(this.core,this.logger),this.pendingRequest=new ax(this.core,this.logger),this.engine=new nx(this)}static async init(t){const r=new ap(t);return await r.initialize(),r}get context(){return Ae.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var Lc={exports:{}};(function(o,t){var r=typeof self<"u"?self:Mr,n=function(){function c(){this.fetch=!1,this.DOMException=r.DOMException}return c.prototype=r,new c}();(function(c){(function(l){var d={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function _(m){return m&&DataView.prototype.isPrototypeOf(m)}if(d.arrayBuffer)var p=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=ArrayBuffer.isView||function(m){return m&&p.indexOf(Object.prototype.toString.call(m))>-1};function T(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(m))throw new TypeError("Invalid character in header field name");return m.toLowerCase()}function x(m){return typeof m!="string"&&(m=String(m)),m}function L(m){var P={next:function(){var Y=m.shift();return{done:Y===void 0,value:Y}}};return d.iterable&&(P[Symbol.iterator]=function(){return P}),P}function C(m){this.map={},m instanceof C?m.forEach(function(P,Y){this.append(Y,P)},this):Array.isArray(m)?m.forEach(function(P){this.append(P[0],P[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(P){this.append(P,m[P])},this)}C.prototype.append=function(m,P){m=T(m),P=x(P);var Y=this.map[m];this.map[m]=Y?Y+", "+P:P},C.prototype.delete=function(m){delete this.map[T(m)]},C.prototype.get=function(m){return m=T(m),this.has(m)?this.map[m]:null},C.prototype.has=function(m){return this.map.hasOwnProperty(T(m))},C.prototype.set=function(m,P){this.map[T(m)]=x(P)},C.prototype.forEach=function(m,P){for(var Y in this.map)this.map.hasOwnProperty(Y)&&m.call(P,this.map[Y],Y,this)},C.prototype.keys=function(){var m=[];return this.forEach(function(P,Y){m.push(Y)}),L(m)},C.prototype.values=function(){var m=[];return this.forEach(function(P){m.push(P)}),L(m)},C.prototype.entries=function(){var m=[];return this.forEach(function(P,Y){m.push([Y,P])}),L(m)},d.iterable&&(C.prototype[Symbol.iterator]=C.prototype.entries);function F(m){if(m.bodyUsed)return Promise.reject(new TypeError("Already read"));m.bodyUsed=!0}function re(m){return new Promise(function(P,Y){m.onload=function(){P(m.result)},m.onerror=function(){Y(m.error)}})}function he(m){var P=new FileReader,Y=re(P);return P.readAsArrayBuffer(m),Y}function le(m){var P=new FileReader,Y=re(P);return P.readAsText(m),Y}function fe(m){for(var P=new Uint8Array(m),Y=new Array(P.length),ce=0;ce<P.length;ce++)Y[ce]=String.fromCharCode(P[ce]);return Y.join("")}function pe(m){if(m.slice)return m.slice(0);var P=new Uint8Array(m.byteLength);return P.set(new Uint8Array(m)),P.buffer}function de(){return this.bodyUsed=!1,this._initBody=function(m){this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:d.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:d.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:d.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():d.arrayBuffer&&d.blob&&_(m)?(this._bodyArrayBuffer=pe(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):d.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||b(m))?this._bodyArrayBuffer=pe(m):this._bodyText=m=Object.prototype.toString.call(m):this._bodyText="",this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):d.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},d.blob&&(this.blob=function(){var m=F(this);if(m)return m;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?F(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(he)}),this.text=function(){var m=F(this);if(m)return m;if(this._bodyBlob)return le(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(fe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},d.formData&&(this.formData=function(){return this.text().then(ve)}),this.json=function(){return this.text().then(JSON.parse)},this}var j=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function H(m){var P=m.toUpperCase();return j.indexOf(P)>-1?P:m}function W(m,P){P=P||{};var Y=P.body;if(m instanceof W){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,P.headers||(this.headers=new C(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!Y&&m._bodyInit!=null&&(Y=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=P.credentials||this.credentials||"same-origin",(P.headers||!this.headers)&&(this.headers=new C(P.headers)),this.method=H(P.method||this.method||"GET"),this.mode=P.mode||this.mode||null,this.signal=P.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Y)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Y)}W.prototype.clone=function(){return new W(this,{body:this._bodyInit})};function ve(m){var P=new FormData;return m.trim().split("&").forEach(function(Y){if(Y){var ce=Y.split("="),V=ce.shift().replace(/\+/g," "),k=ce.join("=").replace(/\+/g," ");P.append(decodeURIComponent(V),decodeURIComponent(k))}}),P}function ie(m){var P=new C,Y=m.replace(/\r?\n[\t ]+/g," ");return Y.split(/\r?\n/).forEach(function(ce){var V=ce.split(":"),k=V.shift().trim();if(k){var B=V.join(":").trim();P.append(k,B)}}),P}de.call(W.prototype);function ue(m,P){P||(P={}),this.type="default",this.status=P.status===void 0?200:P.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in P?P.statusText:"OK",this.headers=new C(P.headers),this.url=P.url||"",this._initBody(m)}de.call(ue.prototype),ue.prototype.clone=function(){return new ue(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new C(this.headers),url:this.url})},ue.error=function(){var m=new ue(null,{status:0,statusText:""});return m.type="error",m};var Ce=[301,302,303,307,308];ue.redirect=function(m,P){if(Ce.indexOf(P)===-1)throw new RangeError("Invalid status code");return new ue(null,{status:P,headers:{location:m}})},l.DOMException=c.DOMException;try{new l.DOMException}catch{l.DOMException=function(P,Y){this.message=P,this.name=Y;var ce=Error(P);this.stack=ce.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function Ue(m,P){return new Promise(function(Y,ce){var V=new W(m,P);if(V.signal&&V.signal.aborted)return ce(new l.DOMException("Aborted","AbortError"));var k=new XMLHttpRequest;function B(){k.abort()}k.onload=function(){var G={status:k.status,statusText:k.statusText,headers:ie(k.getAllResponseHeaders()||"")};G.url="responseURL"in k?k.responseURL:G.headers.get("X-Request-URL");var Qe="response"in k?k.response:k.responseText;Y(new ue(Qe,G))},k.onerror=function(){ce(new TypeError("Network request failed"))},k.ontimeout=function(){ce(new TypeError("Network request failed"))},k.onabort=function(){ce(new l.DOMException("Aborted","AbortError"))},k.open(V.method,V.url,!0),V.credentials==="include"?k.withCredentials=!0:V.credentials==="omit"&&(k.withCredentials=!1),"responseType"in k&&d.blob&&(k.responseType="blob"),V.headers.forEach(function(G,Qe){k.setRequestHeader(Qe,G)}),V.signal&&(V.signal.addEventListener("abort",B),k.onreadystatechange=function(){k.readyState===4&&V.signal.removeEventListener("abort",B)}),k.send(typeof V._bodyInit>"u"?null:V._bodyInit)})}return Ue.polyfill=!0,c.fetch||(c.fetch=Ue,c.Headers=C,c.Request=W,c.Response=ue),l.Headers=C,l.Request=W,l.Response=ue,l.fetch=Ue,Object.defineProperty(l,"__esModule",{value:!0}),l})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=n;t=s.fetch,t.default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,o.exports=t})(Lc,Lc.exports);var ux=Lc.exports;const Wl=Mc(ux),hx={Accept:"application/json","Content-Type":"application/json"},lx="POST",Jl={headers:hx,method:lx},Ql=10;class Oi{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new mr.EventEmitter,this.isAvailable=!1,this.registering=!1,!El(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const n=Bi(t),c=await(await Wl(this.url,Object.assign(Object.assign({},Jl),{body:n}))).json();this.onPayload({data:c})}catch(n){this.onError(t.id,n)}}async register(t=this.url){if(!El(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Bi({id:1,jsonrpc:"2.0",method:"test",params:[]});await Wl(t,Object.assign(Object.assign({},Jl),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?is(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),s=n.message||n.toString(),c=To(t,s);this.events.emit("payload",c)}parseError(t,r=this.url){return qf(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ql&&this.events.setMaxListeners(Ql)}}const Yl="error",fx="wss://relay.walletconnect.com",px="wc",dx="universal_provider",Xl=`${px}@2:${dx}:`,gx="https://rpc.walletconnect.com/v1/",li={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Dc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,n="4.17.21",s=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",d="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",p=500,b="__lodash_placeholder__",T=1,x=2,L=4,C=1,F=2,re=1,he=2,le=4,fe=8,pe=16,de=32,j=64,H=128,W=256,ve=512,ie=30,ue="...",Ce=800,Ue=16,m=1,P=2,Y=3,ce=1/0,V=9007199254740991,k=17976931348623157e292,B=NaN,G=4294967295,Qe=G-1,Be=G>>>1,zr=[["ary",H],["bind",re],["bindKey",he],["curry",fe],["curryRight",pe],["flip",ve],["partial",de],["partialRight",j],["rearg",W]],Ie="[object Arguments]",xt="[object Array]",D="[object AsyncFunction]",$="[object Boolean]",A="[object Date]",h="[object DOMException]",I="[object Error]",ee="[object Function]",ge="[object GeneratorFunction]",be="[object Map]",Ne="[object Number]",Le="[object Null]",Se="[object Object]",Pt="[object Promise]",_t="[object Proxy]",at="[object RegExp]",je="[object Set]",Xe="[object String]",Ze="[object Symbol]",ct="[object Undefined]",He="[object WeakMap]",et="[object WeakSet]",$e="[object ArrayBuffer]",Fe="[object DataView]",lt="[object Float32Array]",Me="[object Float64Array]",St="[object Int8Array]",Dt="[object Int16Array]",kt="[object Int32Array]",Kt="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Jt="[object Uint16Array]",ir="[object Uint32Array]",Ur=/\b__p \+= '';/g,Qt=/\b(__p \+=) '' \+/g,Gr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,fi=/&(?:amp|lt|gt|quot|#39);/g,Ri=/[&<>"']/g,ft=RegExp(fi.source),it=RegExp(Ri.source),pt=/<%-([\s\S]+?)%>/g,dt=/<%([\s\S]+?)%>/g,ut=/<%=([\s\S]+?)%>/g,nt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,Tt=RegExp(gt.source),yt=/^\s+/,wt=/\s/,vt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ye=/\{\n\/\* \[wrapped with (.+)\] \*/,At=/,? & /,Ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$o=/[()=,{}\[\]\/\s]/,Lo=/\\(\\)?/g,Do=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_r=/\w*$/,jo=/^[-+]0x[0-9a-f]+$/i,qo=/^0b[01]+$/i,Mo=/^\[object .+?Constructor\]$/,zo=/^0o[0-7]+$/i,Uo=/^(?:0|[1-9]\d*)$/,Wr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Wi=/($^)/,Ho=/['\n\r\u2028\u2029\\]/g,Ji="\\ud800-\\udfff",ko="\\u0300-\\u036f",Ko="\\ufe20-\\ufe2f",Qi="\\u20d0-\\u20ff",ss=ko+Ko+Qi,os="\\u2700-\\u27bf",Tr="a-z\\xdf-\\xf6\\xf8-\\xff",Bo="\\xac\\xb1\\xd7\\xf7",Fo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Vo="\\u2000-\\u206f",Go=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",as="A-Z\\xc0-\\xd6\\xd8-\\xde",cs="\\ufe0e\\ufe0f",Ti=Bo+Fo+Vo+Go,En="['’]",Ai="["+Ji+"]",In="["+Ti+"]",Ci="["+ss+"]",us="\\d+",Wo="["+os+"]",hs="["+Tr+"]",ls="[^"+Ji+Ti+us+os+Tr+as+"]",Yi="\\ud83c[\\udffb-\\udfff]",Jo="(?:"+Ci+"|"+Yi+")",fs="[^"+Ji+"]",Xi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",fr="["+as+"]",ps="\\u200d",ds="(?:"+hs+"|"+ls+")",Hr="(?:"+fr+"|"+ls+")",gs="(?:"+En+"(?:d|ll|m|re|s|t|ve))?",ys="(?:"+En+"(?:D|LL|M|RE|S|T|VE))?",vs=Jo+"?",ms="["+cs+"]?",Qo="(?:"+ps+"(?:"+[fs,Xi,pi].join("|")+")"+ms+vs+")*",Jr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_s="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ws=ms+vs+Qo,Zi="(?:"+[Wo,Xi,pi].join("|")+")"+ws,Yo="(?:"+[fs+Ci+"?",Ci,Xi,pi,Ai].join("|")+")",xn=RegExp(En,"g"),Xo=RegExp(Ci,"g"),en=RegExp(Yi+"(?="+Yi+")|"+Yo+ws,"g"),bs=RegExp([fr+"?"+hs+"+"+gs+"(?="+[In,fr,"$"].join("|")+")",Hr+"+"+ys+"(?="+[In,fr+ds,"$"].join("|")+")",fr+"?"+ds+"+"+gs,fr+"+"+ys,_s,Jr,us,Zi].join("|"),"g"),Es=RegExp("["+ps+Ji+ss+cs+"]"),Ni=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Is=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Zo=-1,Ve={};Ve[lt]=Ve[Me]=Ve[St]=Ve[Dt]=Ve[kt]=Ve[Kt]=Ve[Mt]=Ve[Jt]=Ve[ir]=!0,Ve[Ie]=Ve[xt]=Ve[$e]=Ve[$]=Ve[Fe]=Ve[A]=Ve[I]=Ve[ee]=Ve[be]=Ve[Ne]=Ve[Se]=Ve[at]=Ve[je]=Ve[Xe]=Ve[He]=!1;var ke={};ke[Ie]=ke[xt]=ke[$e]=ke[Fe]=ke[$]=ke[A]=ke[lt]=ke[Me]=ke[St]=ke[Dt]=ke[kt]=ke[be]=ke[Ne]=ke[Se]=ke[at]=ke[je]=ke[Xe]=ke[Ze]=ke[Kt]=ke[Mt]=ke[Jt]=ke[ir]=!0,ke[I]=ke[ee]=ke[He]=!1;var v={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},U={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ge=parseFloat,me=parseInt,tt=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Re=tt||Nt||Function("return this")(),We=t&&!t.nodeType&&t,bt=We&&!0&&o&&!o.nodeType&&o,nr=bt&&bt.exports===We,$t=nr&&tt.process,rt=function(){try{var O=bt&&bt.require&&bt.require("util").types;return O||$t&&$t.binding&&$t.binding("util")}catch{}}(),Yt=rt&&rt.isArrayBuffer,Ar=rt&&rt.isDate,wr=rt&&rt.isMap,kr=rt&&rt.isRegExp,Pn=rt&&rt.isSet,$i=rt&&rt.isTypedArray;function zt(O,q,N){switch(N.length){case 0:return O.call(q);case 1:return O.call(q,N[0]);case 2:return O.call(q,N[0],N[1]);case 3:return O.call(q,N[0],N[1],N[2])}return O.apply(q,N)}function hp(O,q,N,X){for(var ye=-1,De=O==null?0:O.length;++ye<De;){var jt=O[ye];q(X,jt,N(jt),O)}return X}function br(O,q){for(var N=-1,X=O==null?0:O.length;++N<X&&q(O[N],N,O)!==!1;);return O}function lp(O,q){for(var N=O==null?0:O.length;N--&&q(O[N],N,O)!==!1;);return O}function Xc(O,q){for(var N=-1,X=O==null?0:O.length;++N<X;)if(!q(O[N],N,O))return!1;return!0}function di(O,q){for(var N=-1,X=O==null?0:O.length,ye=0,De=[];++N<X;){var jt=O[N];q(jt,N,O)&&(De[ye++]=jt)}return De}function xs(O,q){var N=O==null?0:O.length;return!!N&&tn(O,q,0)>-1}function ea(O,q,N){for(var X=-1,ye=O==null?0:O.length;++X<ye;)if(N(q,O[X]))return!0;return!1}function st(O,q){for(var N=-1,X=O==null?0:O.length,ye=Array(X);++N<X;)ye[N]=q(O[N],N,O);return ye}function gi(O,q){for(var N=-1,X=q.length,ye=O.length;++N<X;)O[ye+N]=q[N];return O}function ta(O,q,N,X){var ye=-1,De=O==null?0:O.length;for(X&&De&&(N=O[++ye]);++ye<De;)N=q(N,O[ye],ye,O);return N}function fp(O,q,N,X){var ye=O==null?0:O.length;for(X&&ye&&(N=O[--ye]);ye--;)N=q(N,O[ye],ye,O);return N}function ra(O,q){for(var N=-1,X=O==null?0:O.length;++N<X;)if(q(O[N],N,O))return!0;return!1}var pp=ia("length");function dp(O){return O.split("")}function gp(O){return O.match(Ct)||[]}function Zc(O,q,N){var X;return N(O,function(ye,De,jt){if(q(ye,De,jt))return X=De,!1}),X}function Ps(O,q,N,X){for(var ye=O.length,De=N+(X?1:-1);X?De--:++De<ye;)if(q(O[De],De,O))return De;return-1}function tn(O,q,N){return q===q?Op(O,q,N):Ps(O,eu,N)}function yp(O,q,N,X){for(var ye=N-1,De=O.length;++ye<De;)if(X(O[ye],q))return ye;return-1}function eu(O){return O!==O}function tu(O,q){var N=O==null?0:O.length;return N?sa(O,q)/N:B}function ia(O){return function(q){return q==null?r:q[O]}}function na(O){return function(q){return O==null?r:O[q]}}function ru(O,q,N,X,ye){return ye(O,function(De,jt,Je){N=X?(X=!1,De):q(N,De,jt,Je)}),N}function vp(O,q){var N=O.length;for(O.sort(q);N--;)O[N]=O[N].value;return O}function sa(O,q){for(var N,X=-1,ye=O.length;++X<ye;){var De=q(O[X]);De!==r&&(N=N===r?De:N+De)}return N}function oa(O,q){for(var N=-1,X=Array(O);++N<O;)X[N]=q(N);return X}function mp(O,q){return st(q,function(N){return[N,O[N]]})}function iu(O){return O&&O.slice(0,au(O)+1).replace(yt,"")}function pr(O){return function(q){return O(q)}}function aa(O,q){return st(q,function(N){return O[N]})}function Sn(O,q){return O.has(q)}function nu(O,q){for(var N=-1,X=O.length;++N<X&&tn(q,O[N],0)>-1;);return N}function su(O,q){for(var N=O.length;N--&&tn(q,O[N],0)>-1;);return N}function _p(O,q){for(var N=O.length,X=0;N--;)O[N]===q&&++X;return X}var wp=na(v),bp=na(S);function Ep(O){return"\\"+Q[O]}function Ip(O,q){return O==null?r:O[q]}function rn(O){return Es.test(O)}function xp(O){return Ni.test(O)}function Pp(O){for(var q,N=[];!(q=O.next()).done;)N.push(q.value);return N}function ca(O){var q=-1,N=Array(O.size);return O.forEach(function(X,ye){N[++q]=[ye,X]}),N}function ou(O,q){return function(N){return O(q(N))}}function yi(O,q){for(var N=-1,X=O.length,ye=0,De=[];++N<X;){var jt=O[N];(jt===q||jt===b)&&(O[N]=b,De[ye++]=N)}return De}function Ss(O){var q=-1,N=Array(O.size);return O.forEach(function(X){N[++q]=X}),N}function Sp(O){var q=-1,N=Array(O.size);return O.forEach(function(X){N[++q]=[X,X]}),N}function Op(O,q,N){for(var X=N-1,ye=O.length;++X<ye;)if(O[X]===q)return X;return-1}function Rp(O,q,N){for(var X=N+1;X--;)if(O[X]===q)return X;return X}function nn(O){return rn(O)?Ap(O):pp(O)}function Cr(O){return rn(O)?Cp(O):dp(O)}function au(O){for(var q=O.length;q--&&wt.test(O.charAt(q)););return q}var Tp=na(U);function Ap(O){for(var q=en.lastIndex=0;en.test(O);)++q;return q}function Cp(O){return O.match(en)||[]}function Np(O){return O.match(bs)||[]}var $p=function O(q){q=q==null?Re:sn.defaults(Re.Object(),q,sn.pick(Re,Is));var N=q.Array,X=q.Date,ye=q.Error,De=q.Function,jt=q.Math,Je=q.Object,ua=q.RegExp,Lp=q.String,Er=q.TypeError,Os=N.prototype,Dp=De.prototype,on=Je.prototype,Rs=q["__core-js_shared__"],Ts=Dp.toString,ze=on.hasOwnProperty,jp=0,cu=function(){var e=/[^.]+$/.exec(Rs&&Rs.keys&&Rs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),As=on.toString,qp=Ts.call(Je),Mp=Re._,zp=ua("^"+Ts.call(ze).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Cs=nr?q.Buffer:r,vi=q.Symbol,Ns=q.Uint8Array,uu=Cs?Cs.allocUnsafe:r,$s=ou(Je.getPrototypeOf,Je),hu=Je.create,lu=on.propertyIsEnumerable,Ls=Os.splice,fu=vi?vi.isConcatSpreadable:r,On=vi?vi.iterator:r,Li=vi?vi.toStringTag:r,Ds=function(){try{var e=zi(Je,"defineProperty");return e({},"",{}),e}catch{}}(),Up=q.clearTimeout!==Re.clearTimeout&&q.clearTimeout,Hp=X&&X.now!==Re.Date.now&&X.now,kp=q.setTimeout!==Re.setTimeout&&q.setTimeout,js=jt.ceil,qs=jt.floor,ha=Je.getOwnPropertySymbols,Kp=Cs?Cs.isBuffer:r,pu=q.isFinite,Bp=Os.join,Fp=ou(Je.keys,Je),qt=jt.max,Vt=jt.min,Vp=X.now,Gp=q.parseInt,du=jt.random,Wp=Os.reverse,la=zi(q,"DataView"),Rn=zi(q,"Map"),fa=zi(q,"Promise"),an=zi(q,"Set"),Tn=zi(q,"WeakMap"),An=zi(Je,"create"),Ms=Tn&&new Tn,cn={},Jp=Ui(la),Qp=Ui(Rn),Yp=Ui(fa),Xp=Ui(an),Zp=Ui(Tn),zs=vi?vi.prototype:r,Cn=zs?zs.valueOf:r,gu=zs?zs.toString:r;function g(e){if(mt(e)&&!_e(e)&&!(e instanceof Oe)){if(e instanceof Ir)return e;if(ze.call(e,"__wrapped__"))return yh(e)}return new Ir(e)}var un=function(){function e(){}return function(i){if(!ht(i))return{};if(hu)return hu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Us(){}function Ir(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}g.templateSettings={escape:pt,evaluate:dt,interpolate:ut,variable:"",imports:{_:g}},g.prototype=Us.prototype,g.prototype.constructor=g,Ir.prototype=un(Us.prototype),Ir.prototype.constructor=Ir;function Oe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=G,this.__views__=[]}function ed(){var e=new Oe(this.__wrapped__);return e.__actions__=sr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=sr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=sr(this.__views__),e}function td(){if(this.__filtered__){var e=new Oe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function rd(){var e=this.__wrapped__.value(),i=this.__dir__,a=_e(e),u=i<0,f=a?e.length:0,y=dg(0,f,this.__views__),w=y.start,E=y.end,R=E-w,M=u?E:w-1,z=this.__iteratees__,K=z.length,J=0,te=Vt(R,this.__takeCount__);if(!a||!u&&f==R&&te==R)return zu(e,this.__actions__);var oe=[];e:for(;R--&&J<te;){M+=i;for(var Ee=-1,ae=e[M];++Ee<K;){var Pe=z[Ee],Te=Pe.iteratee,yr=Pe.type,er=Te(ae);if(yr==P)ae=er;else if(!er){if(yr==m)continue e;break e}}oe[J++]=ae}return oe}Oe.prototype=un(Us.prototype),Oe.prototype.constructor=Oe;function Di(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function id(){this.__data__=An?An(null):{},this.size=0}function nd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function sd(e){var i=this.__data__;if(An){var a=i[e];return a===_?r:a}return ze.call(i,e)?i[e]:r}function od(e){var i=this.__data__;return An?i[e]!==r:ze.call(i,e)}function ad(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=An&&i===r?_:i,this}Di.prototype.clear=id,Di.prototype.delete=nd,Di.prototype.get=sd,Di.prototype.has=od,Di.prototype.set=ad;function Qr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function cd(){this.__data__=[],this.size=0}function ud(e){var i=this.__data__,a=Hs(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Ls.call(i,a,1),--this.size,!0}function hd(e){var i=this.__data__,a=Hs(i,e);return a<0?r:i[a][1]}function ld(e){return Hs(this.__data__,e)>-1}function fd(e,i){var a=this.__data__,u=Hs(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}Qr.prototype.clear=cd,Qr.prototype.delete=ud,Qr.prototype.get=hd,Qr.prototype.has=ld,Qr.prototype.set=fd;function Yr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function pd(){this.size=0,this.__data__={hash:new Di,map:new(Rn||Qr),string:new Di}}function dd(e){var i=Zs(this,e).delete(e);return this.size-=i?1:0,i}function gd(e){return Zs(this,e).get(e)}function yd(e){return Zs(this,e).has(e)}function vd(e,i){var a=Zs(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}Yr.prototype.clear=pd,Yr.prototype.delete=dd,Yr.prototype.get=gd,Yr.prototype.has=yd,Yr.prototype.set=vd;function ji(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new Yr;++i<a;)this.add(e[i])}function md(e){return this.__data__.set(e,_),this}function _d(e){return this.__data__.has(e)}ji.prototype.add=ji.prototype.push=md,ji.prototype.has=_d;function Nr(e){var i=this.__data__=new Qr(e);this.size=i.size}function wd(){this.__data__=new Qr,this.size=0}function bd(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function Ed(e){return this.__data__.get(e)}function Id(e){return this.__data__.has(e)}function xd(e,i){var a=this.__data__;if(a instanceof Qr){var u=a.__data__;if(!Rn||u.length<s-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new Yr(u)}return a.set(e,i),this.size=a.size,this}Nr.prototype.clear=wd,Nr.prototype.delete=bd,Nr.prototype.get=Ed,Nr.prototype.has=Id,Nr.prototype.set=xd;function yu(e,i){var a=_e(e),u=!a&&Hi(e),f=!a&&!u&&Ei(e),y=!a&&!u&&!f&&pn(e),w=a||u||f||y,E=w?oa(e.length,Lp):[],R=E.length;for(var M in e)(i||ze.call(e,M))&&!(w&&(M=="length"||f&&(M=="offset"||M=="parent")||y&&(M=="buffer"||M=="byteLength"||M=="byteOffset")||ti(M,R)))&&E.push(M);return E}function vu(e){var i=e.length;return i?e[Ia(0,i-1)]:r}function Pd(e,i){return eo(sr(e),qi(i,0,e.length))}function Sd(e){return eo(sr(e))}function pa(e,i,a){(a!==r&&!$r(e[i],a)||a===r&&!(i in e))&&Xr(e,i,a)}function Nn(e,i,a){var u=e[i];(!(ze.call(e,i)&&$r(u,a))||a===r&&!(i in e))&&Xr(e,i,a)}function Hs(e,i){for(var a=e.length;a--;)if($r(e[a][0],i))return a;return-1}function Od(e,i,a,u){return mi(e,function(f,y,w){i(u,f,a(f),w)}),u}function mu(e,i){return e&&Br(i,Ut(i),e)}function Rd(e,i){return e&&Br(i,ar(i),e)}function Xr(e,i,a){i=="__proto__"&&Ds?Ds(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function da(e,i){for(var a=-1,u=i.length,f=N(u),y=e==null;++a<u;)f[a]=y?r:Wa(e,i[a]);return f}function qi(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function xr(e,i,a,u,f,y){var w,E=i&T,R=i&x,M=i&L;if(a&&(w=f?a(e,u,f,y):a(e)),w!==r)return w;if(!ht(e))return e;var z=_e(e);if(z){if(w=yg(e),!E)return sr(e,w)}else{var K=Gt(e),J=K==ee||K==ge;if(Ei(e))return ku(e,E);if(K==Se||K==Ie||J&&!f){if(w=R||J?{}:ah(e),!E)return R?sg(e,Rd(w,e)):ng(e,mu(w,e))}else{if(!ke[K])return f?e:{};w=vg(e,K,E)}}y||(y=new Nr);var te=y.get(e);if(te)return te;y.set(e,w),jh(e)?e.forEach(function(ae){w.add(xr(ae,i,a,ae,e,y))}):Lh(e)&&e.forEach(function(ae,Pe){w.set(Pe,xr(ae,i,a,Pe,e,y))});var oe=M?R?La:$a:R?ar:Ut,Ee=z?r:oe(e);return br(Ee||e,function(ae,Pe){Ee&&(Pe=ae,ae=e[Pe]),Nn(w,Pe,xr(ae,i,a,Pe,e,y))}),w}function Td(e){var i=Ut(e);return function(a){return _u(a,e,i)}}function _u(e,i,a){var u=a.length;if(e==null)return!u;for(e=Je(e);u--;){var f=a[u],y=i[f],w=e[f];if(w===r&&!(f in e)||!y(w))return!1}return!0}function wu(e,i,a){if(typeof e!="function")throw new Er(l);return zn(function(){e.apply(r,a)},i)}function $n(e,i,a,u){var f=-1,y=xs,w=!0,E=e.length,R=[],M=i.length;if(!E)return R;a&&(i=st(i,pr(a))),u?(y=ea,w=!1):i.length>=s&&(y=Sn,w=!1,i=new ji(i));e:for(;++f<E;){var z=e[f],K=a==null?z:a(z);if(z=u||z!==0?z:0,w&&K===K){for(var J=M;J--;)if(i[J]===K)continue e;R.push(z)}else y(i,K,u)||R.push(z)}return R}var mi=Gu(Kr),bu=Gu(ya,!0);function Ad(e,i){var a=!0;return mi(e,function(u,f,y){return a=!!i(u,f,y),a}),a}function ks(e,i,a){for(var u=-1,f=e.length;++u<f;){var y=e[u],w=i(y);if(w!=null&&(E===r?w===w&&!gr(w):a(w,E)))var E=w,R=y}return R}function Cd(e,i,a,u){var f=e.length;for(a=we(a),a<0&&(a=-a>f?0:f+a),u=u===r||u>f?f:we(u),u<0&&(u+=f),u=a>u?0:Mh(u);a<u;)e[a++]=i;return e}function Eu(e,i){var a=[];return mi(e,function(u,f,y){i(u,f,y)&&a.push(u)}),a}function Bt(e,i,a,u,f){var y=-1,w=e.length;for(a||(a=_g),f||(f=[]);++y<w;){var E=e[y];i>0&&a(E)?i>1?Bt(E,i-1,a,u,f):gi(f,E):u||(f[f.length]=E)}return f}var ga=Wu(),Iu=Wu(!0);function Kr(e,i){return e&&ga(e,i,Ut)}function ya(e,i){return e&&Iu(e,i,Ut)}function Ks(e,i){return di(i,function(a){return ri(e[a])})}function Mi(e,i){i=wi(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[Fr(i[a++])];return a&&a==u?e:r}function xu(e,i,a){var u=i(e);return _e(e)?u:gi(u,a(e))}function Xt(e){return e==null?e===r?ct:Le:Li&&Li in Je(e)?pg(e):Sg(e)}function va(e,i){return e>i}function Nd(e,i){return e!=null&&ze.call(e,i)}function $d(e,i){return e!=null&&i in Je(e)}function Ld(e,i,a){return e>=Vt(i,a)&&e<qt(i,a)}function ma(e,i,a){for(var u=a?ea:xs,f=e[0].length,y=e.length,w=y,E=N(y),R=1/0,M=[];w--;){var z=e[w];w&&i&&(z=st(z,pr(i))),R=Vt(z.length,R),E[w]=!a&&(i||f>=120&&z.length>=120)?new ji(w&&z):r}z=e[0];var K=-1,J=E[0];e:for(;++K<f&&M.length<R;){var te=z[K],oe=i?i(te):te;if(te=a||te!==0?te:0,!(J?Sn(J,oe):u(M,oe,a))){for(w=y;--w;){var Ee=E[w];if(!(Ee?Sn(Ee,oe):u(e[w],oe,a)))continue e}J&&J.push(oe),M.push(te)}}return M}function Dd(e,i,a,u){return Kr(e,function(f,y,w){i(u,a(f),y,w)}),u}function Ln(e,i,a){i=wi(i,e),e=lh(e,i);var u=e==null?e:e[Fr(Sr(i))];return u==null?r:zt(u,e,a)}function Pu(e){return mt(e)&&Xt(e)==Ie}function jd(e){return mt(e)&&Xt(e)==$e}function qd(e){return mt(e)&&Xt(e)==A}function Dn(e,i,a,u,f){return e===i?!0:e==null||i==null||!mt(e)&&!mt(i)?e!==e&&i!==i:Md(e,i,a,u,Dn,f)}function Md(e,i,a,u,f,y){var w=_e(e),E=_e(i),R=w?xt:Gt(e),M=E?xt:Gt(i);R=R==Ie?Se:R,M=M==Ie?Se:M;var z=R==Se,K=M==Se,J=R==M;if(J&&Ei(e)){if(!Ei(i))return!1;w=!0,z=!1}if(J&&!z)return y||(y=new Nr),w||pn(e)?nh(e,i,a,u,f,y):lg(e,i,R,a,u,f,y);if(!(a&C)){var te=z&&ze.call(e,"__wrapped__"),oe=K&&ze.call(i,"__wrapped__");if(te||oe){var Ee=te?e.value():e,ae=oe?i.value():i;return y||(y=new Nr),f(Ee,ae,a,u,y)}}return J?(y||(y=new Nr),fg(e,i,a,u,f,y)):!1}function zd(e){return mt(e)&&Gt(e)==be}function _a(e,i,a,u){var f=a.length,y=f,w=!u;if(e==null)return!y;for(e=Je(e);f--;){var E=a[f];if(w&&E[2]?E[1]!==e[E[0]]:!(E[0]in e))return!1}for(;++f<y;){E=a[f];var R=E[0],M=e[R],z=E[1];if(w&&E[2]){if(M===r&&!(R in e))return!1}else{var K=new Nr;if(u)var J=u(M,z,R,e,i,K);if(!(J===r?Dn(z,M,C|F,u,K):J))return!1}}return!0}function Su(e){if(!ht(e)||bg(e))return!1;var i=ri(e)?zp:Mo;return i.test(Ui(e))}function Ud(e){return mt(e)&&Xt(e)==at}function Hd(e){return mt(e)&&Gt(e)==je}function kd(e){return mt(e)&&oo(e.length)&&!!Ve[Xt(e)]}function Ou(e){return typeof e=="function"?e:e==null?cr:typeof e=="object"?_e(e)?Au(e[0],e[1]):Tu(e):Jh(e)}function wa(e){if(!Mn(e))return Fp(e);var i=[];for(var a in Je(e))ze.call(e,a)&&a!="constructor"&&i.push(a);return i}function Kd(e){if(!ht(e))return Pg(e);var i=Mn(e),a=[];for(var u in e)u=="constructor"&&(i||!ze.call(e,u))||a.push(u);return a}function ba(e,i){return e<i}function Ru(e,i){var a=-1,u=or(e)?N(e.length):[];return mi(e,function(f,y,w){u[++a]=i(f,y,w)}),u}function Tu(e){var i=ja(e);return i.length==1&&i[0][2]?uh(i[0][0],i[0][1]):function(a){return a===e||_a(a,e,i)}}function Au(e,i){return Ma(e)&&ch(i)?uh(Fr(e),i):function(a){var u=Wa(a,e);return u===r&&u===i?Ja(a,e):Dn(i,u,C|F)}}function Bs(e,i,a,u,f){e!==i&&ga(i,function(y,w){if(f||(f=new Nr),ht(y))Bd(e,i,w,a,Bs,u,f);else{var E=u?u(Ua(e,w),y,w+"",e,i,f):r;E===r&&(E=y),pa(e,w,E)}},ar)}function Bd(e,i,a,u,f,y,w){var E=Ua(e,a),R=Ua(i,a),M=w.get(R);if(M){pa(e,a,M);return}var z=y?y(E,R,a+"",e,i,w):r,K=z===r;if(K){var J=_e(R),te=!J&&Ei(R),oe=!J&&!te&&pn(R);z=R,J||te||oe?_e(E)?z=E:Et(E)?z=sr(E):te?(K=!1,z=ku(R,!0)):oe?(K=!1,z=Ku(R,!0)):z=[]:Un(R)||Hi(R)?(z=E,Hi(E)?z=zh(E):(!ht(E)||ri(E))&&(z=ah(R))):K=!1}K&&(w.set(R,z),f(z,R,u,y,w),w.delete(R)),pa(e,a,z)}function Cu(e,i){var a=e.length;if(a)return i+=i<0?a:0,ti(i,a)?e[i]:r}function Nu(e,i,a){i.length?i=st(i,function(y){return _e(y)?function(w){return Mi(w,y.length===1?y[0]:y)}:y}):i=[cr];var u=-1;i=st(i,pr(se()));var f=Ru(e,function(y,w,E){var R=st(i,function(M){return M(y)});return{criteria:R,index:++u,value:y}});return vp(f,function(y,w){return ig(y,w,a)})}function Fd(e,i){return $u(e,i,function(a,u){return Ja(e,u)})}function $u(e,i,a){for(var u=-1,f=i.length,y={};++u<f;){var w=i[u],E=Mi(e,w);a(E,w)&&jn(y,wi(w,e),E)}return y}function Vd(e){return function(i){return Mi(i,e)}}function Ea(e,i,a,u){var f=u?yp:tn,y=-1,w=i.length,E=e;for(e===i&&(i=sr(i)),a&&(E=st(e,pr(a)));++y<w;)for(var R=0,M=i[y],z=a?a(M):M;(R=f(E,z,R,u))>-1;)E!==e&&Ls.call(E,R,1),Ls.call(e,R,1);return e}function Lu(e,i){for(var a=e?i.length:0,u=a-1;a--;){var f=i[a];if(a==u||f!==y){var y=f;ti(f)?Ls.call(e,f,1):Sa(e,f)}}return e}function Ia(e,i){return e+qs(du()*(i-e+1))}function Gd(e,i,a,u){for(var f=-1,y=qt(js((i-e)/(a||1)),0),w=N(y);y--;)w[u?y:++f]=e,e+=a;return w}function xa(e,i){var a="";if(!e||i<1||i>V)return a;do i%2&&(a+=e),i=qs(i/2),i&&(e+=e);while(i);return a}function xe(e,i){return Ha(hh(e,i,cr),e+"")}function Wd(e){return vu(dn(e))}function Jd(e,i){var a=dn(e);return eo(a,qi(i,0,a.length))}function jn(e,i,a,u){if(!ht(e))return e;i=wi(i,e);for(var f=-1,y=i.length,w=y-1,E=e;E!=null&&++f<y;){var R=Fr(i[f]),M=a;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(f!=w){var z=E[R];M=u?u(z,R,E):r,M===r&&(M=ht(z)?z:ti(i[f+1])?[]:{})}Nn(E,R,M),E=E[R]}return e}var Du=Ms?function(e,i){return Ms.set(e,i),e}:cr,Qd=Ds?function(e,i){return Ds(e,"toString",{configurable:!0,enumerable:!1,value:Ya(i),writable:!0})}:cr;function Yd(e){return eo(dn(e))}function Pr(e,i,a){var u=-1,f=e.length;i<0&&(i=-i>f?0:f+i),a=a>f?f:a,a<0&&(a+=f),f=i>a?0:a-i>>>0,i>>>=0;for(var y=N(f);++u<f;)y[u]=e[u+i];return y}function Xd(e,i){var a;return mi(e,function(u,f,y){return a=i(u,f,y),!a}),!!a}function Fs(e,i,a){var u=0,f=e==null?u:e.length;if(typeof i=="number"&&i===i&&f<=Be){for(;u<f;){var y=u+f>>>1,w=e[y];w!==null&&!gr(w)&&(a?w<=i:w<i)?u=y+1:f=y}return f}return Pa(e,i,cr,a)}function Pa(e,i,a,u){var f=0,y=e==null?0:e.length;if(y===0)return 0;i=a(i);for(var w=i!==i,E=i===null,R=gr(i),M=i===r;f<y;){var z=qs((f+y)/2),K=a(e[z]),J=K!==r,te=K===null,oe=K===K,Ee=gr(K);if(w)var ae=u||oe;else M?ae=oe&&(u||J):E?ae=oe&&J&&(u||!te):R?ae=oe&&J&&!te&&(u||!Ee):te||Ee?ae=!1:ae=u?K<=i:K<i;ae?f=z+1:y=z}return Vt(y,Qe)}function ju(e,i){for(var a=-1,u=e.length,f=0,y=[];++a<u;){var w=e[a],E=i?i(w):w;if(!a||!$r(E,R)){var R=E;y[f++]=w===0?0:w}}return y}function qu(e){return typeof e=="number"?e:gr(e)?B:+e}function dr(e){if(typeof e=="string")return e;if(_e(e))return st(e,dr)+"";if(gr(e))return gu?gu.call(e):"";var i=e+"";return i=="0"&&1/e==-ce?"-0":i}function _i(e,i,a){var u=-1,f=xs,y=e.length,w=!0,E=[],R=E;if(a)w=!1,f=ea;else if(y>=s){var M=i?null:ug(e);if(M)return Ss(M);w=!1,f=Sn,R=new ji}else R=i?[]:E;e:for(;++u<y;){var z=e[u],K=i?i(z):z;if(z=a||z!==0?z:0,w&&K===K){for(var J=R.length;J--;)if(R[J]===K)continue e;i&&R.push(K),E.push(z)}else f(R,K,a)||(R!==E&&R.push(K),E.push(z))}return E}function Sa(e,i){return i=wi(i,e),e=lh(e,i),e==null||delete e[Fr(Sr(i))]}function Mu(e,i,a,u){return jn(e,i,a(Mi(e,i)),u)}function Vs(e,i,a,u){for(var f=e.length,y=u?f:-1;(u?y--:++y<f)&&i(e[y],y,e););return a?Pr(e,u?0:y,u?y+1:f):Pr(e,u?y+1:0,u?f:y)}function zu(e,i){var a=e;return a instanceof Oe&&(a=a.value()),ta(i,function(u,f){return f.func.apply(f.thisArg,gi([u],f.args))},a)}function Oa(e,i,a){var u=e.length;if(u<2)return u?_i(e[0]):[];for(var f=-1,y=N(u);++f<u;)for(var w=e[f],E=-1;++E<u;)E!=f&&(y[f]=$n(y[f]||w,e[E],i,a));return _i(Bt(y,1),i,a)}function Uu(e,i,a){for(var u=-1,f=e.length,y=i.length,w={};++u<f;){var E=u<y?i[u]:r;a(w,e[u],E)}return w}function Ra(e){return Et(e)?e:[]}function Ta(e){return typeof e=="function"?e:cr}function wi(e,i){return _e(e)?e:Ma(e,i)?[e]:gh(qe(e))}var Zd=xe;function bi(e,i,a){var u=e.length;return a=a===r?u:a,!i&&a>=u?e:Pr(e,i,a)}var Hu=Up||function(e){return Re.clearTimeout(e)};function ku(e,i){if(i)return e.slice();var a=e.length,u=uu?uu(a):new e.constructor(a);return e.copy(u),u}function Aa(e){var i=new e.constructor(e.byteLength);return new Ns(i).set(new Ns(e)),i}function eg(e,i){var a=i?Aa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function tg(e){var i=new e.constructor(e.source,_r.exec(e));return i.lastIndex=e.lastIndex,i}function rg(e){return Cn?Je(Cn.call(e)):{}}function Ku(e,i){var a=i?Aa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function Bu(e,i){if(e!==i){var a=e!==r,u=e===null,f=e===e,y=gr(e),w=i!==r,E=i===null,R=i===i,M=gr(i);if(!E&&!M&&!y&&e>i||y&&w&&R&&!E&&!M||u&&w&&R||!a&&R||!f)return 1;if(!u&&!y&&!M&&e<i||M&&a&&f&&!u&&!y||E&&a&&f||!w&&f||!R)return-1}return 0}function ig(e,i,a){for(var u=-1,f=e.criteria,y=i.criteria,w=f.length,E=a.length;++u<w;){var R=Bu(f[u],y[u]);if(R){if(u>=E)return R;var M=a[u];return R*(M=="desc"?-1:1)}}return e.index-i.index}function Fu(e,i,a,u){for(var f=-1,y=e.length,w=a.length,E=-1,R=i.length,M=qt(y-w,0),z=N(R+M),K=!u;++E<R;)z[E]=i[E];for(;++f<w;)(K||f<y)&&(z[a[f]]=e[f]);for(;M--;)z[E++]=e[f++];return z}function Vu(e,i,a,u){for(var f=-1,y=e.length,w=-1,E=a.length,R=-1,M=i.length,z=qt(y-E,0),K=N(z+M),J=!u;++f<z;)K[f]=e[f];for(var te=f;++R<M;)K[te+R]=i[R];for(;++w<E;)(J||f<y)&&(K[te+a[w]]=e[f++]);return K}function sr(e,i){var a=-1,u=e.length;for(i||(i=N(u));++a<u;)i[a]=e[a];return i}function Br(e,i,a,u){var f=!a;a||(a={});for(var y=-1,w=i.length;++y<w;){var E=i[y],R=u?u(a[E],e[E],E,a,e):r;R===r&&(R=e[E]),f?Xr(a,E,R):Nn(a,E,R)}return a}function ng(e,i){return Br(e,qa(e),i)}function sg(e,i){return Br(e,sh(e),i)}function Gs(e,i){return function(a,u){var f=_e(a)?hp:Od,y=i?i():{};return f(a,e,se(u,2),y)}}function hn(e){return xe(function(i,a){var u=-1,f=a.length,y=f>1?a[f-1]:r,w=f>2?a[2]:r;for(y=e.length>3&&typeof y=="function"?(f--,y):r,w&&Zt(a[0],a[1],w)&&(y=f<3?r:y,f=1),i=Je(i);++u<f;){var E=a[u];E&&e(i,E,u,y)}return i})}function Gu(e,i){return function(a,u){if(a==null)return a;if(!or(a))return e(a,u);for(var f=a.length,y=i?f:-1,w=Je(a);(i?y--:++y<f)&&u(w[y],y,w)!==!1;);return a}}function Wu(e){return function(i,a,u){for(var f=-1,y=Je(i),w=u(i),E=w.length;E--;){var R=w[e?E:++f];if(a(y[R],R,y)===!1)break}return i}}function og(e,i,a){var u=i&re,f=qn(e);function y(){var w=this&&this!==Re&&this instanceof y?f:e;return w.apply(u?a:this,arguments)}return y}function Ju(e){return function(i){i=qe(i);var a=rn(i)?Cr(i):r,u=a?a[0]:i.charAt(0),f=a?bi(a,1).join(""):i.slice(1);return u[e]()+f}}function ln(e){return function(i){return ta(Gh(Vh(i).replace(xn,"")),e,"")}}function qn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=un(e.prototype),u=e.apply(a,i);return ht(u)?u:a}}function ag(e,i,a){var u=qn(e);function f(){for(var y=arguments.length,w=N(y),E=y,R=fn(f);E--;)w[E]=arguments[E];var M=y<3&&w[0]!==R&&w[y-1]!==R?[]:yi(w,R);if(y-=M.length,y<a)return eh(e,i,Ws,f.placeholder,r,w,M,r,r,a-y);var z=this&&this!==Re&&this instanceof f?u:e;return zt(z,this,w)}return f}function Qu(e){return function(i,a,u){var f=Je(i);if(!or(i)){var y=se(a,3);i=Ut(i),a=function(E){return y(f[E],E,f)}}var w=e(i,a,u);return w>-1?f[y?i[w]:w]:r}}function Yu(e){return ei(function(i){var a=i.length,u=a,f=Ir.prototype.thru;for(e&&i.reverse();u--;){var y=i[u];if(typeof y!="function")throw new Er(l);if(f&&!w&&Xs(y)=="wrapper")var w=new Ir([],!0)}for(u=w?u:a;++u<a;){y=i[u];var E=Xs(y),R=E=="wrapper"?Da(y):r;R&&za(R[0])&&R[1]==(H|fe|de|W)&&!R[4].length&&R[9]==1?w=w[Xs(R[0])].apply(w,R[3]):w=y.length==1&&za(y)?w[E]():w.thru(y)}return function(){var M=arguments,z=M[0];if(w&&M.length==1&&_e(z))return w.plant(z).value();for(var K=0,J=a?i[K].apply(this,M):z;++K<a;)J=i[K].call(this,J);return J}})}function Ws(e,i,a,u,f,y,w,E,R,M){var z=i&H,K=i&re,J=i&he,te=i&(fe|pe),oe=i&ve,Ee=J?r:qn(e);function ae(){for(var Pe=arguments.length,Te=N(Pe),yr=Pe;yr--;)Te[yr]=arguments[yr];if(te)var er=fn(ae),vr=_p(Te,er);if(u&&(Te=Fu(Te,u,f,te)),y&&(Te=Vu(Te,y,w,te)),Pe-=vr,te&&Pe<M){var It=yi(Te,er);return eh(e,i,Ws,ae.placeholder,a,Te,It,E,R,M-Pe)}var Lr=K?a:this,ni=J?Lr[e]:e;return Pe=Te.length,E?Te=Og(Te,E):oe&&Pe>1&&Te.reverse(),z&&R<Pe&&(Te.length=R),this&&this!==Re&&this instanceof ae&&(ni=Ee||qn(ni)),ni.apply(Lr,Te)}return ae}function Xu(e,i){return function(a,u){return Dd(a,e,i(u),{})}}function Js(e,i){return function(a,u){var f;if(a===r&&u===r)return i;if(a!==r&&(f=a),u!==r){if(f===r)return u;typeof a=="string"||typeof u=="string"?(a=dr(a),u=dr(u)):(a=qu(a),u=qu(u)),f=e(a,u)}return f}}function Ca(e){return ei(function(i){return i=st(i,pr(se())),xe(function(a){var u=this;return e(i,function(f){return zt(f,u,a)})})})}function Qs(e,i){i=i===r?" ":dr(i);var a=i.length;if(a<2)return a?xa(i,e):i;var u=xa(i,js(e/nn(i)));return rn(i)?bi(Cr(u),0,e).join(""):u.slice(0,e)}function cg(e,i,a,u){var f=i&re,y=qn(e);function w(){for(var E=-1,R=arguments.length,M=-1,z=u.length,K=N(z+R),J=this&&this!==Re&&this instanceof w?y:e;++M<z;)K[M]=u[M];for(;R--;)K[M++]=arguments[++E];return zt(J,f?a:this,K)}return w}function Zu(e){return function(i,a,u){return u&&typeof u!="number"&&Zt(i,a,u)&&(a=u=r),i=ii(i),a===r?(a=i,i=0):a=ii(a),u=u===r?i<a?1:-1:ii(u),Gd(i,a,u,e)}}function Ys(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Or(i),a=Or(a)),e(i,a)}}function eh(e,i,a,u,f,y,w,E,R,M){var z=i&fe,K=z?w:r,J=z?r:w,te=z?y:r,oe=z?r:y;i|=z?de:j,i&=~(z?j:de),i&le||(i&=~(re|he));var Ee=[e,i,f,te,K,oe,J,E,R,M],ae=a.apply(r,Ee);return za(e)&&fh(ae,Ee),ae.placeholder=u,ph(ae,e,i)}function Na(e){var i=jt[e];return function(a,u){if(a=Or(a),u=u==null?0:Vt(we(u),292),u&&pu(a)){var f=(qe(a)+"e").split("e"),y=i(f[0]+"e"+(+f[1]+u));return f=(qe(y)+"e").split("e"),+(f[0]+"e"+(+f[1]-u))}return i(a)}}var ug=an&&1/Ss(new an([,-0]))[1]==ce?function(e){return new an(e)}:ec;function th(e){return function(i){var a=Gt(i);return a==be?ca(i):a==je?Sp(i):mp(i,e(i))}}function Zr(e,i,a,u,f,y,w,E){var R=i&he;if(!R&&typeof e!="function")throw new Er(l);var M=u?u.length:0;if(M||(i&=~(de|j),u=f=r),w=w===r?w:qt(we(w),0),E=E===r?E:we(E),M-=f?f.length:0,i&j){var z=u,K=f;u=f=r}var J=R?r:Da(e),te=[e,i,a,u,f,z,K,y,w,E];if(J&&xg(te,J),e=te[0],i=te[1],a=te[2],u=te[3],f=te[4],E=te[9]=te[9]===r?R?0:e.length:qt(te[9]-M,0),!E&&i&(fe|pe)&&(i&=~(fe|pe)),!i||i==re)var oe=og(e,i,a);else i==fe||i==pe?oe=ag(e,i,E):(i==de||i==(re|de))&&!f.length?oe=cg(e,i,a,u):oe=Ws.apply(r,te);var Ee=J?Du:fh;return ph(Ee(oe,te),e,i)}function rh(e,i,a,u){return e===r||$r(e,on[a])&&!ze.call(u,a)?i:e}function ih(e,i,a,u,f,y){return ht(e)&&ht(i)&&(y.set(i,e),Bs(e,i,r,ih,y),y.delete(i)),e}function hg(e){return Un(e)?r:e}function nh(e,i,a,u,f,y){var w=a&C,E=e.length,R=i.length;if(E!=R&&!(w&&R>E))return!1;var M=y.get(e),z=y.get(i);if(M&&z)return M==i&&z==e;var K=-1,J=!0,te=a&F?new ji:r;for(y.set(e,i),y.set(i,e);++K<E;){var oe=e[K],Ee=i[K];if(u)var ae=w?u(Ee,oe,K,i,e,y):u(oe,Ee,K,e,i,y);if(ae!==r){if(ae)continue;J=!1;break}if(te){if(!ra(i,function(Pe,Te){if(!Sn(te,Te)&&(oe===Pe||f(oe,Pe,a,u,y)))return te.push(Te)})){J=!1;break}}else if(!(oe===Ee||f(oe,Ee,a,u,y))){J=!1;break}}return y.delete(e),y.delete(i),J}function lg(e,i,a,u,f,y,w){switch(a){case Fe:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case $e:return!(e.byteLength!=i.byteLength||!y(new Ns(e),new Ns(i)));case $:case A:case Ne:return $r(+e,+i);case I:return e.name==i.name&&e.message==i.message;case at:case Xe:return e==i+"";case be:var E=ca;case je:var R=u&C;if(E||(E=Ss),e.size!=i.size&&!R)return!1;var M=w.get(e);if(M)return M==i;u|=F,w.set(e,i);var z=nh(E(e),E(i),u,f,y,w);return w.delete(e),z;case Ze:if(Cn)return Cn.call(e)==Cn.call(i)}return!1}function fg(e,i,a,u,f,y){var w=a&C,E=$a(e),R=E.length,M=$a(i),z=M.length;if(R!=z&&!w)return!1;for(var K=R;K--;){var J=E[K];if(!(w?J in i:ze.call(i,J)))return!1}var te=y.get(e),oe=y.get(i);if(te&&oe)return te==i&&oe==e;var Ee=!0;y.set(e,i),y.set(i,e);for(var ae=w;++K<R;){J=E[K];var Pe=e[J],Te=i[J];if(u)var yr=w?u(Te,Pe,J,i,e,y):u(Pe,Te,J,e,i,y);if(!(yr===r?Pe===Te||f(Pe,Te,a,u,y):yr)){Ee=!1;break}ae||(ae=J=="constructor")}if(Ee&&!ae){var er=e.constructor,vr=i.constructor;er!=vr&&"constructor"in e&&"constructor"in i&&!(typeof er=="function"&&er instanceof er&&typeof vr=="function"&&vr instanceof vr)&&(Ee=!1)}return y.delete(e),y.delete(i),Ee}function ei(e){return Ha(hh(e,r,_h),e+"")}function $a(e){return xu(e,Ut,qa)}function La(e){return xu(e,ar,sh)}var Da=Ms?function(e){return Ms.get(e)}:ec;function Xs(e){for(var i=e.name+"",a=cn[i],u=ze.call(cn,i)?a.length:0;u--;){var f=a[u],y=f.func;if(y==null||y==e)return f.name}return i}function fn(e){var i=ze.call(g,"placeholder")?g:e;return i.placeholder}function se(){var e=g.iteratee||Xa;return e=e===Xa?Ou:e,arguments.length?e(arguments[0],arguments[1]):e}function Zs(e,i){var a=e.__data__;return wg(i)?a[typeof i=="string"?"string":"hash"]:a.map}function ja(e){for(var i=Ut(e),a=i.length;a--;){var u=i[a],f=e[u];i[a]=[u,f,ch(f)]}return i}function zi(e,i){var a=Ip(e,i);return Su(a)?a:r}function pg(e){var i=ze.call(e,Li),a=e[Li];try{e[Li]=r;var u=!0}catch{}var f=As.call(e);return u&&(i?e[Li]=a:delete e[Li]),f}var qa=ha?function(e){return e==null?[]:(e=Je(e),di(ha(e),function(i){return lu.call(e,i)}))}:tc,sh=ha?function(e){for(var i=[];e;)gi(i,qa(e)),e=$s(e);return i}:tc,Gt=Xt;(la&&Gt(new la(new ArrayBuffer(1)))!=Fe||Rn&&Gt(new Rn)!=be||fa&&Gt(fa.resolve())!=Pt||an&&Gt(new an)!=je||Tn&&Gt(new Tn)!=He)&&(Gt=function(e){var i=Xt(e),a=i==Se?e.constructor:r,u=a?Ui(a):"";if(u)switch(u){case Jp:return Fe;case Qp:return be;case Yp:return Pt;case Xp:return je;case Zp:return He}return i});function dg(e,i,a){for(var u=-1,f=a.length;++u<f;){var y=a[u],w=y.size;switch(y.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Vt(i,e+w);break;case"takeRight":e=qt(e,i-w);break}}return{start:e,end:i}}function gg(e){var i=e.match(Ye);return i?i[1].split(At):[]}function oh(e,i,a){i=wi(i,e);for(var u=-1,f=i.length,y=!1;++u<f;){var w=Fr(i[u]);if(!(y=e!=null&&a(e,w)))break;e=e[w]}return y||++u!=f?y:(f=e==null?0:e.length,!!f&&oo(f)&&ti(w,f)&&(_e(e)||Hi(e)))}function yg(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&ze.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function ah(e){return typeof e.constructor=="function"&&!Mn(e)?un($s(e)):{}}function vg(e,i,a){var u=e.constructor;switch(i){case $e:return Aa(e);case $:case A:return new u(+e);case Fe:return eg(e,a);case lt:case Me:case St:case Dt:case kt:case Kt:case Mt:case Jt:case ir:return Ku(e,a);case be:return new u;case Ne:case Xe:return new u(e);case at:return tg(e);case je:return new u;case Ze:return rg(e)}}function mg(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(vt,`{
/* [wrapped with `+i+`] */
`)}function _g(e){return _e(e)||Hi(e)||!!(fu&&e&&e[fu])}function ti(e,i){var a=typeof e;return i=i??V,!!i&&(a=="number"||a!="symbol"&&Uo.test(e))&&e>-1&&e%1==0&&e<i}function Zt(e,i,a){if(!ht(a))return!1;var u=typeof i;return(u=="number"?or(a)&&ti(i,a.length):u=="string"&&i in a)?$r(a[i],e):!1}function Ma(e,i){if(_e(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||gr(e)?!0:Ot.test(e)||!nt.test(e)||i!=null&&e in Je(i)}function wg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function za(e){var i=Xs(e),a=g[i];if(typeof a!="function"||!(i in Oe.prototype))return!1;if(e===a)return!0;var u=Da(a);return!!u&&e===u[0]}function bg(e){return!!cu&&cu in e}var Eg=Rs?ri:rc;function Mn(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||on;return e===a}function ch(e){return e===e&&!ht(e)}function uh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in Je(a))}}function Ig(e){var i=no(e,function(u){return a.size===p&&a.clear(),u}),a=i.cache;return i}function xg(e,i){var a=e[1],u=i[1],f=a|u,y=f<(re|he|H),w=u==H&&a==fe||u==H&&a==W&&e[7].length<=i[8]||u==(H|W)&&i[7].length<=i[8]&&a==fe;if(!(y||w))return e;u&re&&(e[2]=i[2],f|=a&re?0:le);var E=i[3];if(E){var R=e[3];e[3]=R?Fu(R,E,i[4]):E,e[4]=R?yi(e[3],b):i[4]}return E=i[5],E&&(R=e[5],e[5]=R?Vu(R,E,i[6]):E,e[6]=R?yi(e[5],b):i[6]),E=i[7],E&&(e[7]=E),u&H&&(e[8]=e[8]==null?i[8]:Vt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function Pg(e){var i=[];if(e!=null)for(var a in Je(e))i.push(a);return i}function Sg(e){return As.call(e)}function hh(e,i,a){return i=qt(i===r?e.length-1:i,0),function(){for(var u=arguments,f=-1,y=qt(u.length-i,0),w=N(y);++f<y;)w[f]=u[i+f];f=-1;for(var E=N(i+1);++f<i;)E[f]=u[f];return E[i]=a(w),zt(e,this,E)}}function lh(e,i){return i.length<2?e:Mi(e,Pr(i,0,-1))}function Og(e,i){for(var a=e.length,u=Vt(i.length,a),f=sr(e);u--;){var y=i[u];e[u]=ti(y,a)?f[y]:r}return e}function Ua(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var fh=dh(Du),zn=kp||function(e,i){return Re.setTimeout(e,i)},Ha=dh(Qd);function ph(e,i,a){var u=i+"";return Ha(e,mg(u,Rg(gg(u),a)))}function dh(e){var i=0,a=0;return function(){var u=Vp(),f=Ue-(u-a);if(a=u,f>0){if(++i>=Ce)return arguments[0]}else i=0;return e.apply(r,arguments)}}function eo(e,i){var a=-1,u=e.length,f=u-1;for(i=i===r?u:i;++a<i;){var y=Ia(a,f),w=e[y];e[y]=e[a],e[a]=w}return e.length=i,e}var gh=Ig(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Rt,function(a,u,f,y){i.push(f?y.replace(Lo,"$1"):u||a)}),i});function Fr(e){if(typeof e=="string"||gr(e))return e;var i=e+"";return i=="0"&&1/e==-ce?"-0":i}function Ui(e){if(e!=null){try{return Ts.call(e)}catch{}try{return e+""}catch{}}return""}function Rg(e,i){return br(zr,function(a){var u="_."+a[0];i&a[1]&&!xs(e,u)&&e.push(u)}),e.sort()}function yh(e){if(e instanceof Oe)return e.clone();var i=new Ir(e.__wrapped__,e.__chain__);return i.__actions__=sr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Tg(e,i,a){(a?Zt(e,i,a):i===r)?i=1:i=qt(we(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var f=0,y=0,w=N(js(u/i));f<u;)w[y++]=Pr(e,f,f+=i);return w}function Ag(e){for(var i=-1,a=e==null?0:e.length,u=0,f=[];++i<a;){var y=e[i];y&&(f[u++]=y)}return f}function Cg(){var e=arguments.length;if(!e)return[];for(var i=N(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return gi(_e(a)?sr(a):[a],Bt(i,1))}var Ng=xe(function(e,i){return Et(e)?$n(e,Bt(i,1,Et,!0)):[]}),$g=xe(function(e,i){var a=Sr(i);return Et(a)&&(a=r),Et(e)?$n(e,Bt(i,1,Et,!0),se(a,2)):[]}),Lg=xe(function(e,i){var a=Sr(i);return Et(a)&&(a=r),Et(e)?$n(e,Bt(i,1,Et,!0),r,a):[]});function Dg(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:we(i),Pr(e,i<0?0:i,u)):[]}function jg(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:we(i),i=u-i,Pr(e,0,i<0?0:i)):[]}function qg(e,i){return e&&e.length?Vs(e,se(i,3),!0,!0):[]}function Mg(e,i){return e&&e.length?Vs(e,se(i,3),!0):[]}function zg(e,i,a,u){var f=e==null?0:e.length;return f?(a&&typeof a!="number"&&Zt(e,i,a)&&(a=0,u=f),Cd(e,i,a,u)):[]}function vh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:we(a);return f<0&&(f=qt(u+f,0)),Ps(e,se(i,3),f)}function mh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u-1;return a!==r&&(f=we(a),f=a<0?qt(u+f,0):Vt(f,u-1)),Ps(e,se(i,3),f,!0)}function _h(e){var i=e==null?0:e.length;return i?Bt(e,1):[]}function Ug(e){var i=e==null?0:e.length;return i?Bt(e,ce):[]}function Hg(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:we(i),Bt(e,i)):[]}function kg(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var f=e[i];u[f[0]]=f[1]}return u}function wh(e){return e&&e.length?e[0]:r}function Kg(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:we(a);return f<0&&(f=qt(u+f,0)),tn(e,i,f)}function Bg(e){var i=e==null?0:e.length;return i?Pr(e,0,-1):[]}var Fg=xe(function(e){var i=st(e,Ra);return i.length&&i[0]===e[0]?ma(i):[]}),Vg=xe(function(e){var i=Sr(e),a=st(e,Ra);return i===Sr(a)?i=r:a.pop(),a.length&&a[0]===e[0]?ma(a,se(i,2)):[]}),Gg=xe(function(e){var i=Sr(e),a=st(e,Ra);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?ma(a,r,i):[]});function Wg(e,i){return e==null?"":Bp.call(e,i)}function Sr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Jg(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u;return a!==r&&(f=we(a),f=f<0?qt(u+f,0):Vt(f,u-1)),i===i?Rp(e,i,f):Ps(e,eu,f,!0)}function Qg(e,i){return e&&e.length?Cu(e,we(i)):r}var Yg=xe(bh);function bh(e,i){return e&&e.length&&i&&i.length?Ea(e,i):e}function Xg(e,i,a){return e&&e.length&&i&&i.length?Ea(e,i,se(a,2)):e}function Zg(e,i,a){return e&&e.length&&i&&i.length?Ea(e,i,r,a):e}var ey=ei(function(e,i){var a=e==null?0:e.length,u=da(e,i);return Lu(e,st(i,function(f){return ti(f,a)?+f:f}).sort(Bu)),u});function ty(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,f=[],y=e.length;for(i=se(i,3);++u<y;){var w=e[u];i(w,u,e)&&(a.push(w),f.push(u))}return Lu(e,f),a}function ka(e){return e==null?e:Wp.call(e)}function ry(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&Zt(e,i,a)?(i=0,a=u):(i=i==null?0:we(i),a=a===r?u:we(a)),Pr(e,i,a)):[]}function iy(e,i){return Fs(e,i)}function ny(e,i,a){return Pa(e,i,se(a,2))}function sy(e,i){var a=e==null?0:e.length;if(a){var u=Fs(e,i);if(u<a&&$r(e[u],i))return u}return-1}function oy(e,i){return Fs(e,i,!0)}function ay(e,i,a){return Pa(e,i,se(a,2),!0)}function cy(e,i){var a=e==null?0:e.length;if(a){var u=Fs(e,i,!0)-1;if($r(e[u],i))return u}return-1}function uy(e){return e&&e.length?ju(e):[]}function hy(e,i){return e&&e.length?ju(e,se(i,2)):[]}function ly(e){var i=e==null?0:e.length;return i?Pr(e,1,i):[]}function fy(e,i,a){return e&&e.length?(i=a||i===r?1:we(i),Pr(e,0,i<0?0:i)):[]}function py(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:we(i),i=u-i,Pr(e,i<0?0:i,u)):[]}function dy(e,i){return e&&e.length?Vs(e,se(i,3),!1,!0):[]}function gy(e,i){return e&&e.length?Vs(e,se(i,3)):[]}var yy=xe(function(e){return _i(Bt(e,1,Et,!0))}),vy=xe(function(e){var i=Sr(e);return Et(i)&&(i=r),_i(Bt(e,1,Et,!0),se(i,2))}),my=xe(function(e){var i=Sr(e);return i=typeof i=="function"?i:r,_i(Bt(e,1,Et,!0),r,i)});function _y(e){return e&&e.length?_i(e):[]}function wy(e,i){return e&&e.length?_i(e,se(i,2)):[]}function by(e,i){return i=typeof i=="function"?i:r,e&&e.length?_i(e,r,i):[]}function Ka(e){if(!(e&&e.length))return[];var i=0;return e=di(e,function(a){if(Et(a))return i=qt(a.length,i),!0}),oa(i,function(a){return st(e,ia(a))})}function Eh(e,i){if(!(e&&e.length))return[];var a=Ka(e);return i==null?a:st(a,function(u){return zt(i,r,u)})}var Ey=xe(function(e,i){return Et(e)?$n(e,i):[]}),Iy=xe(function(e){return Oa(di(e,Et))}),xy=xe(function(e){var i=Sr(e);return Et(i)&&(i=r),Oa(di(e,Et),se(i,2))}),Py=xe(function(e){var i=Sr(e);return i=typeof i=="function"?i:r,Oa(di(e,Et),r,i)}),Sy=xe(Ka);function Oy(e,i){return Uu(e||[],i||[],Nn)}function Ry(e,i){return Uu(e||[],i||[],jn)}var Ty=xe(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,Eh(e,a)});function Ih(e){var i=g(e);return i.__chain__=!0,i}function Ay(e,i){return i(e),e}function to(e,i){return i(e)}var Cy=ei(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,f=function(y){return da(y,e)};return i>1||this.__actions__.length||!(u instanceof Oe)||!ti(a)?this.thru(f):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:to,args:[f],thisArg:r}),new Ir(u,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function Ny(){return Ih(this)}function $y(){return new Ir(this.value(),this.__chain__)}function Ly(){this.__values__===r&&(this.__values__=qh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Dy(){return this}function jy(e){for(var i,a=this;a instanceof Us;){var u=yh(a);u.__index__=0,u.__values__=r,i?f.__wrapped__=u:i=u;var f=u;a=a.__wrapped__}return f.__wrapped__=e,i}function qy(){var e=this.__wrapped__;if(e instanceof Oe){var i=e;return this.__actions__.length&&(i=new Oe(this)),i=i.reverse(),i.__actions__.push({func:to,args:[ka],thisArg:r}),new Ir(i,this.__chain__)}return this.thru(ka)}function My(){return zu(this.__wrapped__,this.__actions__)}var zy=Gs(function(e,i,a){ze.call(e,a)?++e[a]:Xr(e,a,1)});function Uy(e,i,a){var u=_e(e)?Xc:Ad;return a&&Zt(e,i,a)&&(i=r),u(e,se(i,3))}function Hy(e,i){var a=_e(e)?di:Eu;return a(e,se(i,3))}var ky=Qu(vh),Ky=Qu(mh);function By(e,i){return Bt(ro(e,i),1)}function Fy(e,i){return Bt(ro(e,i),ce)}function Vy(e,i,a){return a=a===r?1:we(a),Bt(ro(e,i),a)}function xh(e,i){var a=_e(e)?br:mi;return a(e,se(i,3))}function Ph(e,i){var a=_e(e)?lp:bu;return a(e,se(i,3))}var Gy=Gs(function(e,i,a){ze.call(e,a)?e[a].push(i):Xr(e,a,[i])});function Wy(e,i,a,u){e=or(e)?e:dn(e),a=a&&!u?we(a):0;var f=e.length;return a<0&&(a=qt(f+a,0)),ao(e)?a<=f&&e.indexOf(i,a)>-1:!!f&&tn(e,i,a)>-1}var Jy=xe(function(e,i,a){var u=-1,f=typeof i=="function",y=or(e)?N(e.length):[];return mi(e,function(w){y[++u]=f?zt(i,w,a):Ln(w,i,a)}),y}),Qy=Gs(function(e,i,a){Xr(e,a,i)});function ro(e,i){var a=_e(e)?st:Ru;return a(e,se(i,3))}function Yy(e,i,a,u){return e==null?[]:(_e(i)||(i=i==null?[]:[i]),a=u?r:a,_e(a)||(a=a==null?[]:[a]),Nu(e,i,a))}var Xy=Gs(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function Zy(e,i,a){var u=_e(e)?ta:ru,f=arguments.length<3;return u(e,se(i,4),a,f,mi)}function ev(e,i,a){var u=_e(e)?fp:ru,f=arguments.length<3;return u(e,se(i,4),a,f,bu)}function tv(e,i){var a=_e(e)?di:Eu;return a(e,so(se(i,3)))}function rv(e){var i=_e(e)?vu:Wd;return i(e)}function iv(e,i,a){(a?Zt(e,i,a):i===r)?i=1:i=we(i);var u=_e(e)?Pd:Jd;return u(e,i)}function nv(e){var i=_e(e)?Sd:Yd;return i(e)}function sv(e){if(e==null)return 0;if(or(e))return ao(e)?nn(e):e.length;var i=Gt(e);return i==be||i==je?e.size:wa(e).length}function ov(e,i,a){var u=_e(e)?ra:Xd;return a&&Zt(e,i,a)&&(i=r),u(e,se(i,3))}var av=xe(function(e,i){if(e==null)return[];var a=i.length;return a>1&&Zt(e,i[0],i[1])?i=[]:a>2&&Zt(i[0],i[1],i[2])&&(i=[i[0]]),Nu(e,Bt(i,1),[])}),io=Hp||function(){return Re.Date.now()};function cv(e,i){if(typeof i!="function")throw new Er(l);return e=we(e),function(){if(--e<1)return i.apply(this,arguments)}}function Sh(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,Zr(e,H,r,r,r,r,i)}function Oh(e,i){var a;if(typeof i!="function")throw new Er(l);return e=we(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var Ba=xe(function(e,i,a){var u=re;if(a.length){var f=yi(a,fn(Ba));u|=de}return Zr(e,u,i,a,f)}),Rh=xe(function(e,i,a){var u=re|he;if(a.length){var f=yi(a,fn(Rh));u|=de}return Zr(i,u,e,a,f)});function Th(e,i,a){i=a?r:i;var u=Zr(e,fe,r,r,r,r,r,i);return u.placeholder=Th.placeholder,u}function Ah(e,i,a){i=a?r:i;var u=Zr(e,pe,r,r,r,r,r,i);return u.placeholder=Ah.placeholder,u}function Ch(e,i,a){var u,f,y,w,E,R,M=0,z=!1,K=!1,J=!0;if(typeof e!="function")throw new Er(l);i=Or(i)||0,ht(a)&&(z=!!a.leading,K="maxWait"in a,y=K?qt(Or(a.maxWait)||0,i):y,J="trailing"in a?!!a.trailing:J);function te(It){var Lr=u,ni=f;return u=f=r,M=It,w=e.apply(ni,Lr),w}function oe(It){return M=It,E=zn(Pe,i),z?te(It):w}function Ee(It){var Lr=It-R,ni=It-M,Qh=i-Lr;return K?Vt(Qh,y-ni):Qh}function ae(It){var Lr=It-R,ni=It-M;return R===r||Lr>=i||Lr<0||K&&ni>=y}function Pe(){var It=io();if(ae(It))return Te(It);E=zn(Pe,Ee(It))}function Te(It){return E=r,J&&u?te(It):(u=f=r,w)}function yr(){E!==r&&Hu(E),M=0,u=R=f=E=r}function er(){return E===r?w:Te(io())}function vr(){var It=io(),Lr=ae(It);if(u=arguments,f=this,R=It,Lr){if(E===r)return oe(R);if(K)return Hu(E),E=zn(Pe,i),te(R)}return E===r&&(E=zn(Pe,i)),w}return vr.cancel=yr,vr.flush=er,vr}var uv=xe(function(e,i){return wu(e,1,i)}),hv=xe(function(e,i,a){return wu(e,Or(i)||0,a)});function lv(e){return Zr(e,ve)}function no(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Er(l);var a=function(){var u=arguments,f=i?i.apply(this,u):u[0],y=a.cache;if(y.has(f))return y.get(f);var w=e.apply(this,u);return a.cache=y.set(f,w)||y,w};return a.cache=new(no.Cache||Yr),a}no.Cache=Yr;function so(e){if(typeof e!="function")throw new Er(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function fv(e){return Oh(2,e)}var pv=Zd(function(e,i){i=i.length==1&&_e(i[0])?st(i[0],pr(se())):st(Bt(i,1),pr(se()));var a=i.length;return xe(function(u){for(var f=-1,y=Vt(u.length,a);++f<y;)u[f]=i[f].call(this,u[f]);return zt(e,this,u)})}),Fa=xe(function(e,i){var a=yi(i,fn(Fa));return Zr(e,de,r,i,a)}),Nh=xe(function(e,i){var a=yi(i,fn(Nh));return Zr(e,j,r,i,a)}),dv=ei(function(e,i){return Zr(e,W,r,r,r,i)});function gv(e,i){if(typeof e!="function")throw new Er(l);return i=i===r?i:we(i),xe(e,i)}function yv(e,i){if(typeof e!="function")throw new Er(l);return i=i==null?0:qt(we(i),0),xe(function(a){var u=a[i],f=bi(a,0,i);return u&&gi(f,u),zt(e,this,f)})}function vv(e,i,a){var u=!0,f=!0;if(typeof e!="function")throw new Er(l);return ht(a)&&(u="leading"in a?!!a.leading:u,f="trailing"in a?!!a.trailing:f),Ch(e,i,{leading:u,maxWait:i,trailing:f})}function mv(e){return Sh(e,1)}function _v(e,i){return Fa(Ta(i),e)}function wv(){if(!arguments.length)return[];var e=arguments[0];return _e(e)?e:[e]}function bv(e){return xr(e,L)}function Ev(e,i){return i=typeof i=="function"?i:r,xr(e,L,i)}function Iv(e){return xr(e,T|L)}function xv(e,i){return i=typeof i=="function"?i:r,xr(e,T|L,i)}function Pv(e,i){return i==null||_u(e,i,Ut(i))}function $r(e,i){return e===i||e!==e&&i!==i}var Sv=Ys(va),Ov=Ys(function(e,i){return e>=i}),Hi=Pu(function(){return arguments}())?Pu:function(e){return mt(e)&&ze.call(e,"callee")&&!lu.call(e,"callee")},_e=N.isArray,Rv=Yt?pr(Yt):jd;function or(e){return e!=null&&oo(e.length)&&!ri(e)}function Et(e){return mt(e)&&or(e)}function Tv(e){return e===!0||e===!1||mt(e)&&Xt(e)==$}var Ei=Kp||rc,Av=Ar?pr(Ar):qd;function Cv(e){return mt(e)&&e.nodeType===1&&!Un(e)}function Nv(e){if(e==null)return!0;if(or(e)&&(_e(e)||typeof e=="string"||typeof e.splice=="function"||Ei(e)||pn(e)||Hi(e)))return!e.length;var i=Gt(e);if(i==be||i==je)return!e.size;if(Mn(e))return!wa(e).length;for(var a in e)if(ze.call(e,a))return!1;return!0}function $v(e,i){return Dn(e,i)}function Lv(e,i,a){a=typeof a=="function"?a:r;var u=a?a(e,i):r;return u===r?Dn(e,i,r,a):!!u}function Va(e){if(!mt(e))return!1;var i=Xt(e);return i==I||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Un(e)}function Dv(e){return typeof e=="number"&&pu(e)}function ri(e){if(!ht(e))return!1;var i=Xt(e);return i==ee||i==ge||i==D||i==_t}function $h(e){return typeof e=="number"&&e==we(e)}function oo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=V}function ht(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function mt(e){return e!=null&&typeof e=="object"}var Lh=wr?pr(wr):zd;function jv(e,i){return e===i||_a(e,i,ja(i))}function qv(e,i,a){return a=typeof a=="function"?a:r,_a(e,i,ja(i),a)}function Mv(e){return Dh(e)&&e!=+e}function zv(e){if(Eg(e))throw new ye(c);return Su(e)}function Uv(e){return e===null}function Hv(e){return e==null}function Dh(e){return typeof e=="number"||mt(e)&&Xt(e)==Ne}function Un(e){if(!mt(e)||Xt(e)!=Se)return!1;var i=$s(e);if(i===null)return!0;var a=ze.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&Ts.call(a)==qp}var Ga=kr?pr(kr):Ud;function kv(e){return $h(e)&&e>=-V&&e<=V}var jh=Pn?pr(Pn):Hd;function ao(e){return typeof e=="string"||!_e(e)&&mt(e)&&Xt(e)==Xe}function gr(e){return typeof e=="symbol"||mt(e)&&Xt(e)==Ze}var pn=$i?pr($i):kd;function Kv(e){return e===r}function Bv(e){return mt(e)&&Gt(e)==He}function Fv(e){return mt(e)&&Xt(e)==et}var Vv=Ys(ba),Gv=Ys(function(e,i){return e<=i});function qh(e){if(!e)return[];if(or(e))return ao(e)?Cr(e):sr(e);if(On&&e[On])return Pp(e[On]());var i=Gt(e),a=i==be?ca:i==je?Ss:dn;return a(e)}function ii(e){if(!e)return e===0?e:0;if(e=Or(e),e===ce||e===-ce){var i=e<0?-1:1;return i*k}return e===e?e:0}function we(e){var i=ii(e),a=i%1;return i===i?a?i-a:i:0}function Mh(e){return e?qi(we(e),0,G):0}function Or(e){if(typeof e=="number")return e;if(gr(e))return B;if(ht(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ht(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=iu(e);var a=qo.test(e);return a||zo.test(e)?me(e.slice(2),a?2:8):jo.test(e)?B:+e}function zh(e){return Br(e,ar(e))}function Wv(e){return e?qi(we(e),-V,V):e===0?e:0}function qe(e){return e==null?"":dr(e)}var Jv=hn(function(e,i){if(Mn(i)||or(i)){Br(i,Ut(i),e);return}for(var a in i)ze.call(i,a)&&Nn(e,a,i[a])}),Uh=hn(function(e,i){Br(i,ar(i),e)}),co=hn(function(e,i,a,u){Br(i,ar(i),e,u)}),Qv=hn(function(e,i,a,u){Br(i,Ut(i),e,u)}),Yv=ei(da);function Xv(e,i){var a=un(e);return i==null?a:mu(a,i)}var Zv=xe(function(e,i){e=Je(e);var a=-1,u=i.length,f=u>2?i[2]:r;for(f&&Zt(i[0],i[1],f)&&(u=1);++a<u;)for(var y=i[a],w=ar(y),E=-1,R=w.length;++E<R;){var M=w[E],z=e[M];(z===r||$r(z,on[M])&&!ze.call(e,M))&&(e[M]=y[M])}return e}),em=xe(function(e){return e.push(r,ih),zt(Hh,r,e)});function tm(e,i){return Zc(e,se(i,3),Kr)}function rm(e,i){return Zc(e,se(i,3),ya)}function im(e,i){return e==null?e:ga(e,se(i,3),ar)}function nm(e,i){return e==null?e:Iu(e,se(i,3),ar)}function sm(e,i){return e&&Kr(e,se(i,3))}function om(e,i){return e&&ya(e,se(i,3))}function am(e){return e==null?[]:Ks(e,Ut(e))}function cm(e){return e==null?[]:Ks(e,ar(e))}function Wa(e,i,a){var u=e==null?r:Mi(e,i);return u===r?a:u}function um(e,i){return e!=null&&oh(e,i,Nd)}function Ja(e,i){return e!=null&&oh(e,i,$d)}var hm=Xu(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=As.call(i)),e[i]=a},Ya(cr)),lm=Xu(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=As.call(i)),ze.call(e,i)?e[i].push(a):e[i]=[a]},se),fm=xe(Ln);function Ut(e){return or(e)?yu(e):wa(e)}function ar(e){return or(e)?yu(e,!0):Kd(e)}function pm(e,i){var a={};return i=se(i,3),Kr(e,function(u,f,y){Xr(a,i(u,f,y),u)}),a}function dm(e,i){var a={};return i=se(i,3),Kr(e,function(u,f,y){Xr(a,f,i(u,f,y))}),a}var gm=hn(function(e,i,a){Bs(e,i,a)}),Hh=hn(function(e,i,a,u){Bs(e,i,a,u)}),ym=ei(function(e,i){var a={};if(e==null)return a;var u=!1;i=st(i,function(y){return y=wi(y,e),u||(u=y.length>1),y}),Br(e,La(e),a),u&&(a=xr(a,T|x|L,hg));for(var f=i.length;f--;)Sa(a,i[f]);return a});function vm(e,i){return kh(e,so(se(i)))}var mm=ei(function(e,i){return e==null?{}:Fd(e,i)});function kh(e,i){if(e==null)return{};var a=st(La(e),function(u){return[u]});return i=se(i),$u(e,a,function(u,f){return i(u,f[0])})}function _m(e,i,a){i=wi(i,e);var u=-1,f=i.length;for(f||(f=1,e=r);++u<f;){var y=e==null?r:e[Fr(i[u])];y===r&&(u=f,y=a),e=ri(y)?y.call(e):y}return e}function wm(e,i,a){return e==null?e:jn(e,i,a)}function bm(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:jn(e,i,a,u)}var Kh=th(Ut),Bh=th(ar);function Em(e,i,a){var u=_e(e),f=u||Ei(e)||pn(e);if(i=se(i,4),a==null){var y=e&&e.constructor;f?a=u?new y:[]:ht(e)?a=ri(y)?un($s(e)):{}:a={}}return(f?br:Kr)(e,function(w,E,R){return i(a,w,E,R)}),a}function Im(e,i){return e==null?!0:Sa(e,i)}function xm(e,i,a){return e==null?e:Mu(e,i,Ta(a))}function Pm(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:Mu(e,i,Ta(a),u)}function dn(e){return e==null?[]:aa(e,Ut(e))}function Sm(e){return e==null?[]:aa(e,ar(e))}function Om(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Or(a),a=a===a?a:0),i!==r&&(i=Or(i),i=i===i?i:0),qi(Or(e),i,a)}function Rm(e,i,a){return i=ii(i),a===r?(a=i,i=0):a=ii(a),e=Or(e),Ld(e,i,a)}function Tm(e,i,a){if(a&&typeof a!="boolean"&&Zt(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ii(e),i===r?(i=e,e=0):i=ii(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var f=du();return Vt(e+f*(i-e+Ge("1e-"+((f+"").length-1))),i)}return Ia(e,i)}var Am=ln(function(e,i,a){return i=i.toLowerCase(),e+(a?Fh(i):i)});function Fh(e){return Qa(qe(e).toLowerCase())}function Vh(e){return e=qe(e),e&&e.replace(Wr,wp).replace(Xo,"")}function Cm(e,i,a){e=qe(e),i=dr(i);var u=e.length;a=a===r?u:qi(we(a),0,u);var f=a;return a-=i.length,a>=0&&e.slice(a,f)==i}function Nm(e){return e=qe(e),e&&it.test(e)?e.replace(Ri,bp):e}function $m(e){return e=qe(e),e&&Tt.test(e)?e.replace(gt,"\\$&"):e}var Lm=ln(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),Dm=ln(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),jm=Ju("toLowerCase");function qm(e,i,a){e=qe(e),i=we(i);var u=i?nn(e):0;if(!i||u>=i)return e;var f=(i-u)/2;return Qs(qs(f),a)+e+Qs(js(f),a)}function Mm(e,i,a){e=qe(e),i=we(i);var u=i?nn(e):0;return i&&u<i?e+Qs(i-u,a):e}function zm(e,i,a){e=qe(e),i=we(i);var u=i?nn(e):0;return i&&u<i?Qs(i-u,a)+e:e}function Um(e,i,a){return a||i==null?i=0:i&&(i=+i),Gp(qe(e).replace(yt,""),i||0)}function Hm(e,i,a){return(a?Zt(e,i,a):i===r)?i=1:i=we(i),xa(qe(e),i)}function km(){var e=arguments,i=qe(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Km=ln(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function Bm(e,i,a){return a&&typeof a!="number"&&Zt(e,i,a)&&(i=a=r),a=a===r?G:a>>>0,a?(e=qe(e),e&&(typeof i=="string"||i!=null&&!Ga(i))&&(i=dr(i),!i&&rn(e))?bi(Cr(e),0,a):e.split(i,a)):[]}var Fm=ln(function(e,i,a){return e+(a?" ":"")+Qa(i)});function Vm(e,i,a){return e=qe(e),a=a==null?0:qi(we(a),0,e.length),i=dr(i),e.slice(a,a+i.length)==i}function Gm(e,i,a){var u=g.templateSettings;a&&Zt(e,i,a)&&(i=r),e=qe(e),i=co({},i,u,rh);var f=co({},i.imports,u.imports,rh),y=Ut(f),w=aa(f,y),E,R,M=0,z=i.interpolate||Wi,K="__p += '",J=ua((i.escape||Wi).source+"|"+z.source+"|"+(z===ut?Do:Wi).source+"|"+(i.evaluate||Wi).source+"|$","g"),te="//# sourceURL="+(ze.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Zo+"]")+`
`;e.replace(J,function(ae,Pe,Te,yr,er,vr){return Te||(Te=yr),K+=e.slice(M,vr).replace(Ho,Ep),Pe&&(E=!0,K+=`' +
__e(`+Pe+`) +
'`),er&&(R=!0,K+=`';
`+er+`;
__p += '`),Te&&(K+=`' +
((__t = (`+Te+`)) == null ? '' : __t) +
'`),M=vr+ae.length,ae}),K+=`';
`;var oe=ze.call(i,"variable")&&i.variable;if(!oe)K=`with (obj) {
`+K+`
}
`;else if($o.test(oe))throw new ye(d);K=(R?K.replace(Ur,""):K).replace(Qt,"$1").replace(Gr,"$1;"),K="function("+(oe||"obj")+`) {
`+(oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(E?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+K+`return __p
}`;var Ee=Wh(function(){return De(y,te+"return "+K).apply(r,w)});if(Ee.source=K,Va(Ee))throw Ee;return Ee}function Wm(e){return qe(e).toLowerCase()}function Jm(e){return qe(e).toUpperCase()}function Qm(e,i,a){if(e=qe(e),e&&(a||i===r))return iu(e);if(!e||!(i=dr(i)))return e;var u=Cr(e),f=Cr(i),y=nu(u,f),w=su(u,f)+1;return bi(u,y,w).join("")}function Ym(e,i,a){if(e=qe(e),e&&(a||i===r))return e.slice(0,au(e)+1);if(!e||!(i=dr(i)))return e;var u=Cr(e),f=su(u,Cr(i))+1;return bi(u,0,f).join("")}function Xm(e,i,a){if(e=qe(e),e&&(a||i===r))return e.replace(yt,"");if(!e||!(i=dr(i)))return e;var u=Cr(e),f=nu(u,Cr(i));return bi(u,f).join("")}function Zm(e,i){var a=ie,u=ue;if(ht(i)){var f="separator"in i?i.separator:f;a="length"in i?we(i.length):a,u="omission"in i?dr(i.omission):u}e=qe(e);var y=e.length;if(rn(e)){var w=Cr(e);y=w.length}if(a>=y)return e;var E=a-nn(u);if(E<1)return u;var R=w?bi(w,0,E).join(""):e.slice(0,E);if(f===r)return R+u;if(w&&(E+=R.length-E),Ga(f)){if(e.slice(E).search(f)){var M,z=R;for(f.global||(f=ua(f.source,qe(_r.exec(f))+"g")),f.lastIndex=0;M=f.exec(z);)var K=M.index;R=R.slice(0,K===r?E:K)}}else if(e.indexOf(dr(f),E)!=E){var J=R.lastIndexOf(f);J>-1&&(R=R.slice(0,J))}return R+u}function e0(e){return e=qe(e),e&&ft.test(e)?e.replace(fi,Tp):e}var t0=ln(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),Qa=Ju("toUpperCase");function Gh(e,i,a){return e=qe(e),i=a?r:i,i===r?xp(e)?Np(e):gp(e):e.match(i)||[]}var Wh=xe(function(e,i){try{return zt(e,r,i)}catch(a){return Va(a)?a:new ye(a)}}),r0=ei(function(e,i){return br(i,function(a){a=Fr(a),Xr(e,a,Ba(e[a],e))}),e});function i0(e){var i=e==null?0:e.length,a=se();return e=i?st(e,function(u){if(typeof u[1]!="function")throw new Er(l);return[a(u[0]),u[1]]}):[],xe(function(u){for(var f=-1;++f<i;){var y=e[f];if(zt(y[0],this,u))return zt(y[1],this,u)}})}function n0(e){return Td(xr(e,T))}function Ya(e){return function(){return e}}function s0(e,i){return e==null||e!==e?i:e}var o0=Yu(),a0=Yu(!0);function cr(e){return e}function Xa(e){return Ou(typeof e=="function"?e:xr(e,T))}function c0(e){return Tu(xr(e,T))}function u0(e,i){return Au(e,xr(i,T))}var h0=xe(function(e,i){return function(a){return Ln(a,e,i)}}),l0=xe(function(e,i){return function(a){return Ln(e,a,i)}});function Za(e,i,a){var u=Ut(i),f=Ks(i,u);a==null&&!(ht(i)&&(f.length||!u.length))&&(a=i,i=e,e=this,f=Ks(i,Ut(i)));var y=!(ht(a)&&"chain"in a)||!!a.chain,w=ri(e);return br(f,function(E){var R=i[E];e[E]=R,w&&(e.prototype[E]=function(){var M=this.__chain__;if(y||M){var z=e(this.__wrapped__),K=z.__actions__=sr(this.__actions__);return K.push({func:R,args:arguments,thisArg:e}),z.__chain__=M,z}return R.apply(e,gi([this.value()],arguments))})}),e}function f0(){return Re._===this&&(Re._=Mp),this}function ec(){}function p0(e){return e=we(e),xe(function(i){return Cu(i,e)})}var d0=Ca(st),g0=Ca(Xc),y0=Ca(ra);function Jh(e){return Ma(e)?ia(Fr(e)):Vd(e)}function v0(e){return function(i){return e==null?r:Mi(e,i)}}var m0=Zu(),_0=Zu(!0);function tc(){return[]}function rc(){return!1}function w0(){return{}}function b0(){return""}function E0(){return!0}function I0(e,i){if(e=we(e),e<1||e>V)return[];var a=G,u=Vt(e,G);i=se(i),e-=G;for(var f=oa(u,i);++a<e;)i(a);return f}function x0(e){return _e(e)?st(e,Fr):gr(e)?[e]:sr(gh(qe(e)))}function P0(e){var i=++jp;return qe(e)+i}var S0=Js(function(e,i){return e+i},0),O0=Na("ceil"),R0=Js(function(e,i){return e/i},1),T0=Na("floor");function A0(e){return e&&e.length?ks(e,cr,va):r}function C0(e,i){return e&&e.length?ks(e,se(i,2),va):r}function N0(e){return tu(e,cr)}function $0(e,i){return tu(e,se(i,2))}function L0(e){return e&&e.length?ks(e,cr,ba):r}function D0(e,i){return e&&e.length?ks(e,se(i,2),ba):r}var j0=Js(function(e,i){return e*i},1),q0=Na("round"),M0=Js(function(e,i){return e-i},0);function z0(e){return e&&e.length?sa(e,cr):0}function U0(e,i){return e&&e.length?sa(e,se(i,2)):0}return g.after=cv,g.ary=Sh,g.assign=Jv,g.assignIn=Uh,g.assignInWith=co,g.assignWith=Qv,g.at=Yv,g.before=Oh,g.bind=Ba,g.bindAll=r0,g.bindKey=Rh,g.castArray=wv,g.chain=Ih,g.chunk=Tg,g.compact=Ag,g.concat=Cg,g.cond=i0,g.conforms=n0,g.constant=Ya,g.countBy=zy,g.create=Xv,g.curry=Th,g.curryRight=Ah,g.debounce=Ch,g.defaults=Zv,g.defaultsDeep=em,g.defer=uv,g.delay=hv,g.difference=Ng,g.differenceBy=$g,g.differenceWith=Lg,g.drop=Dg,g.dropRight=jg,g.dropRightWhile=qg,g.dropWhile=Mg,g.fill=zg,g.filter=Hy,g.flatMap=By,g.flatMapDeep=Fy,g.flatMapDepth=Vy,g.flatten=_h,g.flattenDeep=Ug,g.flattenDepth=Hg,g.flip=lv,g.flow=o0,g.flowRight=a0,g.fromPairs=kg,g.functions=am,g.functionsIn=cm,g.groupBy=Gy,g.initial=Bg,g.intersection=Fg,g.intersectionBy=Vg,g.intersectionWith=Gg,g.invert=hm,g.invertBy=lm,g.invokeMap=Jy,g.iteratee=Xa,g.keyBy=Qy,g.keys=Ut,g.keysIn=ar,g.map=ro,g.mapKeys=pm,g.mapValues=dm,g.matches=c0,g.matchesProperty=u0,g.memoize=no,g.merge=gm,g.mergeWith=Hh,g.method=h0,g.methodOf=l0,g.mixin=Za,g.negate=so,g.nthArg=p0,g.omit=ym,g.omitBy=vm,g.once=fv,g.orderBy=Yy,g.over=d0,g.overArgs=pv,g.overEvery=g0,g.overSome=y0,g.partial=Fa,g.partialRight=Nh,g.partition=Xy,g.pick=mm,g.pickBy=kh,g.property=Jh,g.propertyOf=v0,g.pull=Yg,g.pullAll=bh,g.pullAllBy=Xg,g.pullAllWith=Zg,g.pullAt=ey,g.range=m0,g.rangeRight=_0,g.rearg=dv,g.reject=tv,g.remove=ty,g.rest=gv,g.reverse=ka,g.sampleSize=iv,g.set=wm,g.setWith=bm,g.shuffle=nv,g.slice=ry,g.sortBy=av,g.sortedUniq=uy,g.sortedUniqBy=hy,g.split=Bm,g.spread=yv,g.tail=ly,g.take=fy,g.takeRight=py,g.takeRightWhile=dy,g.takeWhile=gy,g.tap=Ay,g.throttle=vv,g.thru=to,g.toArray=qh,g.toPairs=Kh,g.toPairsIn=Bh,g.toPath=x0,g.toPlainObject=zh,g.transform=Em,g.unary=mv,g.union=yy,g.unionBy=vy,g.unionWith=my,g.uniq=_y,g.uniqBy=wy,g.uniqWith=by,g.unset=Im,g.unzip=Ka,g.unzipWith=Eh,g.update=xm,g.updateWith=Pm,g.values=dn,g.valuesIn=Sm,g.without=Ey,g.words=Gh,g.wrap=_v,g.xor=Iy,g.xorBy=xy,g.xorWith=Py,g.zip=Sy,g.zipObject=Oy,g.zipObjectDeep=Ry,g.zipWith=Ty,g.entries=Kh,g.entriesIn=Bh,g.extend=Uh,g.extendWith=co,Za(g,g),g.add=S0,g.attempt=Wh,g.camelCase=Am,g.capitalize=Fh,g.ceil=O0,g.clamp=Om,g.clone=bv,g.cloneDeep=Iv,g.cloneDeepWith=xv,g.cloneWith=Ev,g.conformsTo=Pv,g.deburr=Vh,g.defaultTo=s0,g.divide=R0,g.endsWith=Cm,g.eq=$r,g.escape=Nm,g.escapeRegExp=$m,g.every=Uy,g.find=ky,g.findIndex=vh,g.findKey=tm,g.findLast=Ky,g.findLastIndex=mh,g.findLastKey=rm,g.floor=T0,g.forEach=xh,g.forEachRight=Ph,g.forIn=im,g.forInRight=nm,g.forOwn=sm,g.forOwnRight=om,g.get=Wa,g.gt=Sv,g.gte=Ov,g.has=um,g.hasIn=Ja,g.head=wh,g.identity=cr,g.includes=Wy,g.indexOf=Kg,g.inRange=Rm,g.invoke=fm,g.isArguments=Hi,g.isArray=_e,g.isArrayBuffer=Rv,g.isArrayLike=or,g.isArrayLikeObject=Et,g.isBoolean=Tv,g.isBuffer=Ei,g.isDate=Av,g.isElement=Cv,g.isEmpty=Nv,g.isEqual=$v,g.isEqualWith=Lv,g.isError=Va,g.isFinite=Dv,g.isFunction=ri,g.isInteger=$h,g.isLength=oo,g.isMap=Lh,g.isMatch=jv,g.isMatchWith=qv,g.isNaN=Mv,g.isNative=zv,g.isNil=Hv,g.isNull=Uv,g.isNumber=Dh,g.isObject=ht,g.isObjectLike=mt,g.isPlainObject=Un,g.isRegExp=Ga,g.isSafeInteger=kv,g.isSet=jh,g.isString=ao,g.isSymbol=gr,g.isTypedArray=pn,g.isUndefined=Kv,g.isWeakMap=Bv,g.isWeakSet=Fv,g.join=Wg,g.kebabCase=Lm,g.last=Sr,g.lastIndexOf=Jg,g.lowerCase=Dm,g.lowerFirst=jm,g.lt=Vv,g.lte=Gv,g.max=A0,g.maxBy=C0,g.mean=N0,g.meanBy=$0,g.min=L0,g.minBy=D0,g.stubArray=tc,g.stubFalse=rc,g.stubObject=w0,g.stubString=b0,g.stubTrue=E0,g.multiply=j0,g.nth=Qg,g.noConflict=f0,g.noop=ec,g.now=io,g.pad=qm,g.padEnd=Mm,g.padStart=zm,g.parseInt=Um,g.random=Tm,g.reduce=Zy,g.reduceRight=ev,g.repeat=Hm,g.replace=km,g.result=_m,g.round=q0,g.runInContext=O,g.sample=rv,g.size=sv,g.snakeCase=Km,g.some=ov,g.sortedIndex=iy,g.sortedIndexBy=ny,g.sortedIndexOf=sy,g.sortedLastIndex=oy,g.sortedLastIndexBy=ay,g.sortedLastIndexOf=cy,g.startCase=Fm,g.startsWith=Vm,g.subtract=M0,g.sum=z0,g.sumBy=U0,g.template=Gm,g.times=I0,g.toFinite=ii,g.toInteger=we,g.toLength=Mh,g.toLower=Wm,g.toNumber=Or,g.toSafeInteger=Wv,g.toString=qe,g.toUpper=Jm,g.trim=Qm,g.trimEnd=Ym,g.trimStart=Xm,g.truncate=Zm,g.unescape=e0,g.uniqueId=P0,g.upperCase=t0,g.upperFirst=Qa,g.each=xh,g.eachRight=Ph,g.first=wh,Za(g,function(){var e={};return Kr(g,function(i,a){ze.call(g.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),g.VERSION=n,br(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){g[e].placeholder=g}),br(["drop","take"],function(e,i){Oe.prototype[e]=function(a){a=a===r?1:qt(we(a),0);var u=this.__filtered__&&!i?new Oe(this):this.clone();return u.__filtered__?u.__takeCount__=Vt(a,u.__takeCount__):u.__views__.push({size:Vt(a,G),type:e+(u.__dir__<0?"Right":"")}),u},Oe.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),br(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==m||a==Y;Oe.prototype[e]=function(f){var y=this.clone();return y.__iteratees__.push({iteratee:se(f,3),type:a}),y.__filtered__=y.__filtered__||u,y}}),br(["head","last"],function(e,i){var a="take"+(i?"Right":"");Oe.prototype[e]=function(){return this[a](1).value()[0]}}),br(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");Oe.prototype[e]=function(){return this.__filtered__?new Oe(this):this[a](1)}}),Oe.prototype.compact=function(){return this.filter(cr)},Oe.prototype.find=function(e){return this.filter(e).head()},Oe.prototype.findLast=function(e){return this.reverse().find(e)},Oe.prototype.invokeMap=xe(function(e,i){return typeof e=="function"?new Oe(this):this.map(function(a){return Ln(a,e,i)})}),Oe.prototype.reject=function(e){return this.filter(so(se(e)))},Oe.prototype.slice=function(e,i){e=we(e);var a=this;return a.__filtered__&&(e>0||i<0)?new Oe(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=we(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},Oe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Oe.prototype.toArray=function(){return this.take(G)},Kr(Oe.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),f=g[u?"take"+(i=="last"?"Right":""):i],y=u||/^find/.test(i);f&&(g.prototype[i]=function(){var w=this.__wrapped__,E=u?[1]:arguments,R=w instanceof Oe,M=E[0],z=R||_e(w),K=function(Pe){var Te=f.apply(g,gi([Pe],E));return u&&J?Te[0]:Te};z&&a&&typeof M=="function"&&M.length!=1&&(R=z=!1);var J=this.__chain__,te=!!this.__actions__.length,oe=y&&!J,Ee=R&&!te;if(!y&&z){w=Ee?w:new Oe(this);var ae=e.apply(w,E);return ae.__actions__.push({func:to,args:[K],thisArg:r}),new Ir(ae,J)}return oe&&Ee?e.apply(this,E):(ae=this.thru(K),oe?u?ae.value()[0]:ae.value():ae)})}),br(["pop","push","shift","sort","splice","unshift"],function(e){var i=Os[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);g.prototype[e]=function(){var f=arguments;if(u&&!this.__chain__){var y=this.value();return i.apply(_e(y)?y:[],f)}return this[a](function(w){return i.apply(_e(w)?w:[],f)})}}),Kr(Oe.prototype,function(e,i){var a=g[i];if(a){var u=a.name+"";ze.call(cn,u)||(cn[u]=[]),cn[u].push({name:i,func:a})}}),cn[Ws(r,he).name]=[{name:"wrapper",func:r}],Oe.prototype.clone=ed,Oe.prototype.reverse=td,Oe.prototype.value=rd,g.prototype.at=Cy,g.prototype.chain=Ny,g.prototype.commit=$y,g.prototype.next=Ly,g.prototype.plant=jy,g.prototype.reverse=qy,g.prototype.toJSON=g.prototype.valueOf=g.prototype.value=My,g.prototype.first=g.prototype.head,On&&(g.prototype[On]=Dy),g},sn=$p();bt?((bt.exports=sn)._=sn,We._=sn):Re._=sn}).call(Gn)})(Dc,Dc.exports);var yx=Object.defineProperty,vx=Object.defineProperties,mx=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,_x=Object.prototype.hasOwnProperty,wx=Object.prototype.propertyIsEnumerable,ef=(o,t,r)=>t in o?yx(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,po=(o,t)=>{for(var r in t||(t={}))_x.call(t,r)&&ef(o,r,t[r]);if(Zl)for(var r of Zl(t))wx.call(t,r)&&ef(o,r,t[r]);return o},bx=(o,t)=>vx(o,mx(t));function Si(o,t,r){var n;const s=P_(o);return((n=t.rpcMap)==null?void 0:n[s.reference])||`${gx}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function Gi(o){return o.includes(":")?o.split(":")[1]:o}function cp(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function Ex(o,t){const r=Object.keys(t.namespaces).filter(s=>s.includes(o));if(!r.length)return[];const n=[];return r.forEach(s=>{const c=t.namespaces[s].accounts;n.push(...c)}),n}function Ix(o={},t={}){const r=tf(o),n=tf(t);return Dc.exports.merge(r,n)}function tf(o){var t,r,n,s;const c={};if(!vo(o))return c;for(const[l,d]of Object.entries(o)){const _=gf(l)?[l]:d.chains,p=d.methods||[],b=d.events||[],T=d.rpcMap||{},x=Wn(l);c[x]=bx(po(po({},c[x]),d),{chains:nc(_,(t=c[x])==null?void 0:t.chains),methods:nc(p,(r=c[x])==null?void 0:r.methods),events:nc(b,(n=c[x])==null?void 0:n.events),rpcMap:po(po({},T),(s=c[x])==null?void 0:s.rpcMap)})}return c}function xx(o){return o.includes(":")?o.split(":")[2]:o}function Px(o){const t={};for(const[r,n]of Object.entries(o)){const s=n.methods||[],c=n.events||[],l=n.accounts||[],d=gf(r)?[r]:n.chains?n.chains:cp(n.accounts);t[r]={chains:d,methods:s,events:c,accounts:l}}return t}function yc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const up={},ot=o=>up[o],vc=(o,t)=>{up[o]=t};class Sx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Gi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}}class Ox{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||Si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=parseInt(Gi(r));t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let s=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const c=parseInt(s,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class Rx{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Gi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}}class Tx{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Gi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}}class Ax{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),s=Gi(r);t[s]=this.createHttpProvider(s,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}}class Cx{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Gi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}}class Nx{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Gi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(n,ot("disableProviderPing")))}}class $x{constructor(t){this.name="near",this.namespace=t.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||Si(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace);return typeof n>"u"?void 0:new hi(new Oi(n,ot("disableProviderPing")))}}var Lx=Object.defineProperty,Dx=Object.defineProperties,jx=Object.getOwnPropertyDescriptors,rf=Object.getOwnPropertySymbols,qx=Object.prototype.hasOwnProperty,Mx=Object.prototype.propertyIsEnumerable,nf=(o,t,r)=>t in o?Lx(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,go=(o,t)=>{for(var r in t||(t={}))qx.call(t,r)&&nf(o,r,t[r]);if(rf)for(var r of rf(t))Mx.call(t,r)&&nf(o,r,t[r]);return o},mc=(o,t)=>Dx(o,jx(t));class Qc{constructor(t){this.events=new Hc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Yl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Qc(t);return await r.initialize(),r}async request(t,r){const[n,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:go({},t),chainId:`${n}:${s}`,topic:this.session.topic})}sendAsync(t,r,n){this.request(t,n).then(s=>r(null,s)).catch(s=>r(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:rr("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:s}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await s().then(c=>{this.session=c,this.namespaces||(this.namespaces=Px(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==op)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,s]=this.validateChain(t);this.getProvider(n).setDefaultChain(s,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(wn(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await cx.init({logger:this.providerOpts.logger||Yl,relayUrl:this.providerOpts.relayUrl||fx,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Wn(r)))];vc("client",this.client),vc("events",this.events),vc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=Ex(r,this.session),s=cp(n),c=Ix(this.namespaces,this.optionalNamespaces),l=mc(go({},c[r]),{accounts:n,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new Ox({namespace:l});break;case"solana":this.rpcProviders[r]=new Rx({namespace:l});break;case"cosmos":this.rpcProviders[r]=new Tx({namespace:l});break;case"polkadot":this.rpcProviders[r]=new Sx({namespace:l});break;case"cip34":this.rpcProviders[r]=new Ax({namespace:l});break;case"elrond":this.rpcProviders[r]=new Cx({namespace:l});break;case"multiversx":this.rpcProviders[r]=new Nx({namespace:l});break;case"near":this.rpcProviders[r]=new $x({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const s=n.data;s&&wn(s)&&this.events.emit("accountsChanged",s.map(xx))}else if(n.name==="chainChanged"){const s=r.chainId,c=r.event.data,l=Wn(s),d=yc(s)!==yc(c)?`${l}:${yc(c)}`:s;this.onChainChanged(d)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:s}=r,c=(n=this.client)==null?void 0:n.session.get(t);this.session=mc(go({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",mc(go({},rr("USER_DISCONNECTED")),{data:t.topic}))}),this.on(li.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:s}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=s,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(l=>Wn(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const s=Wn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[s].getDefaultChain();return[s,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[s,c]=this.validateChain(t);r||this.getProvider(s).setDefaultChain(c),((n=this.namespaces[s])!=null?n:this.namespaces[`${s}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Xl}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Xl}/${t}`)}}const zx=Qc,Ux="wc",Hx="ethereum_provider",kx=`${Ux}@2:${Hx}:`,Kx="https://rpc.walletconnect.com/v1/",jc=["eth_sendTransaction","personal_sign"],Bx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],qc=["chainChanged","accountsChanged"],Fx=["chainChanged","accountsChanged","message","disconnect","connect"];var Vx=Object.defineProperty,Gx=Object.defineProperties,Wx=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,Jx=Object.prototype.hasOwnProperty,Qx=Object.prototype.propertyIsEnumerable,of=(o,t,r)=>t in o?Vx(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Qn=(o,t)=>{for(var r in t||(t={}))Jx.call(t,r)&&of(o,r,t[r]);if(sf)for(var r of sf(t))Qx.call(t,r)&&of(o,r,t[r]);return o},af=(o,t)=>Gx(o,Wx(t));function xo(o){return Number(o[0].split(":")[1])}function _c(o){return`0x${o.toString(16)}`}function Yx(o){const{chains:t,optionalChains:r,methods:n,optionalMethods:s,events:c,optionalEvents:l,rpcMap:d}=o;if(!wn(t))throw new Error("Invalid chains");const _={chains:t,methods:n||jc,events:c||qc,rpcMap:Qn({},t.length?{[xo(t)]:d[xo(t)]}:{})},p=c==null?void 0:c.filter(L=>!qc.includes(L)),b=n==null?void 0:n.filter(L=>!jc.includes(L));if(!r&&!l&&!s&&!(p!=null&&p.length)&&!(b!=null&&b.length))return{required:t.length?_:void 0};const T=(p==null?void 0:p.length)&&(b==null?void 0:b.length)||!r,x={chains:[...new Set(T?_.chains.concat(r||[]):r)],methods:[...new Set(_.methods.concat(s!=null&&s.length?s:Bx))],events:[...new Set(_.events.concat(l!=null&&l.length?l:Fx))],rpcMap:d};return{required:t.length?_:void 0,optional:r.length?x:void 0}}class Yc{constructor(){this.events=new mr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=kx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Yc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=Yx(this.rpc);try{const s=await new Promise(async(l,d)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(p=>{!p.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(af(Qn({namespaces:Qn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(p=>{l(p)}).catch(p=>{d(new Error(p.message))})});if(!s)return;const c=S_(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:_c(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",_c(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",af(Qn({},rr("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",_c(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,s]=t.split(":");return{chainId:`${r}:${n}`,address:s}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const s=(r=t==null?void 0:t.chains)!=null?r:[],c=(n=t==null?void 0:t.optionalChains)!=null?n:[],l=s.concat(c);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const d=s.length?(t==null?void 0:t.methods)||jc:[],_=s.length?(t==null?void 0:t.events)||qc:[],p=(t==null?void 0:t.optionalMethods)||[],b=(t==null?void 0:t.optionalEvents)||[],T=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),x=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(L=>this.formatChainId(L)),optionalChains:c.map(L=>this.formatChainId(L)),methods:d,events:_,optionalMethods:p,optionalEvents:b,rpcMap:T,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:x,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(s=>{n[s]=this.getRpcUrl(s,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?xo(this.rpc.chains):xo(this.rpc.optionalChains),this.signer=await zx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await O_(()=>import("./index-yF2SKWB8.js").then(s=>s.i),__vite__mapDeps([0,1,2]));r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Qn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:s}=t;r&&wn(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)})),n&&wn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${Kx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const hP=Yc;export{hP as EthereumProvider,Fx as OPTIONAL_EVENTS,Bx as OPTIONAL_METHODS,qc as REQUIRED_EVENTS,jc as REQUIRED_METHODS,Yc as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-yF2SKWB8.js","assets/index-NjjTOskW.js","assets/index-aV6Logrn.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}